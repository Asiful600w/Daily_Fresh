[{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\merchant.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\notifications.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\orders.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\products.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\register.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":25,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":25,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\r\n\r\nimport * as z from \"zod\"\r\nimport { RegisterSchema } from \"@/schemas\"\r\nimport { supabaseAdmin } from \"@/lib/supabaseAdmin\"\r\n\r\nexport const register = async (values: z.infer<typeof RegisterSchema>) => {\r\n    const validatedFields = RegisterSchema.safeParse(values)\r\n\r\n    if (!validatedFields.success) {\r\n        return { error: \"Invalid fields!\" }\r\n    }\r\n\r\n    const { email, password, name } = validatedFields.data\r\n\r\n    // Check for existing user in auth.users\r\n    const { data: existingAuthUser } = await supabaseAdmin.auth.admin.listUsers()\r\n    const userExists = existingAuthUser.users.some(u => u.email === email)\r\n\r\n    if (userExists) {\r\n        return { error: \"Email already in use!\" }\r\n    }\r\n\r\n    // Create user with Supabase Auth (this will trigger handle_new_user)\r\n    const { data, error } = await supabaseAdmin.auth.admin.createUser({\r\n        email,\r\n        password,\r\n        email_confirm: true, // Auto-confirm for admin-created users\r\n        user_metadata: {\r\n            full_name: name,\r\n            role: 'MERCHANT'\r\n        }\r\n    })\r\n\r\n    if (error) {\r\n        console.error('Registration error:', error)\r\n        return { error: error.message || \"Failed to create user\" }\r\n    }\r\n\r\n    return { success: \"Merchant account created successfully!\" }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\reviews.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\actions\\update-credentials.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'UpdateCredentialsSchema' is assigned a value but only used as a type.","line":9,"column":7,"nodeType":"Identifier","messageId":"usedOnlyAsType","endLine":9,"endColumn":30},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'values' is defined but never used.","line":24,"column":51,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":57}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use server\"\r\n\r\nimport * as z from \"zod\"\r\n\r\n// TODO: Refactor for Supabase Auth\r\n// import { supabaseAdmin } from \"@/lib/supabaseAdmin\"\r\n// import { createClient } from \"@/lib/supabase/server\"\r\n\r\nconst UpdateCredentialsSchema = z.object({\r\n    currentPassword: z.string().min(1, \"Current password is required\"),\r\n    newEmail: z.string().email().optional(),\r\n    newPassword: z.string().min(6, \"Password must be at least 6 characters\").optional(),\r\n    confirmPassword: z.string().optional(),\r\n}).refine((data) => {\r\n    if (data.newPassword && data.newPassword !== data.confirmPassword) {\r\n        return false\r\n    }\r\n    return true\r\n}, {\r\n    message: \"Passwords do not match\",\r\n    path: [\"confirmPassword\"]\r\n})\r\n\r\nexport const updateSuperadminCredentials = async (values: z.infer<typeof UpdateCredentialsSchema>) => {\r\n    // const supabase = await createClient()\r\n    // const { data: { user } } = await supabase.auth.getUser()\r\n\r\n    // if (!user) {\r\n    //     return { error: \"Not authenticated\" }\r\n    // }\r\n\r\n    return {\r\n        error: \"Password updates are temporarily disabled during Supabase migration. Please use the Forgot Password flow or contact support.\",\r\n        success: undefined\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\403\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\categories\\CategoryForm.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":193,"column":29,"nodeType":"JSXOpeningElement","endLine":193,"endColumn":114},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":225,"column":29,"nodeType":"JSXOpeningElement","endLine":225,"endColumn":115}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { useRouter } from 'next/navigation';\r\nimport { createCategory, updateCategory, getCategoryById, uploadCategoryImage } from '@/lib/api';\r\n\r\ninterface CategoryFormProps {\r\n    id?: string; // If ID is provided, it's edit mode\r\n}\r\n\r\nexport default function CategoryForm({ id }: CategoryFormProps) {\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [fetching, setFetching] = useState(!!id);\r\n\r\n    const [formData, setFormData] = useState({\r\n        name: '',\r\n        slug: '',\r\n        image_url: '',\r\n        banner_url: '',\r\n        subcategories: [] as { id?: string; name: string }[]\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            fetchCategory(id);\r\n        }\r\n    }, [id]);\r\n\r\n    const fetchCategory = async (catId: string) => {\r\n        try {\r\n            const data = await getCategoryById(catId);\r\n            if (data) {\r\n                setFormData({\r\n                    name: data.name,\r\n                    slug: data.slug,\r\n                    image_url: data.img || '',\r\n                    banner_url: data.banner || '',\r\n                    subcategories: data.subcategories.map(s => ({ id: s.id, name: s.name }))\r\n                });\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to fetch category', error);\r\n        } finally {\r\n            setFetching(false);\r\n        }\r\n    };\r\n\r\n    const handleSubcategoryChange = (index: number, value: string) => {\r\n        const newSubs = [...formData.subcategories];\r\n        newSubs[index].name = value;\r\n        setFormData({ ...formData, subcategories: newSubs });\r\n    };\r\n\r\n    const addSubcategory = () => {\r\n        setFormData({\r\n            ...formData,\r\n            subcategories: [...formData.subcategories, { name: '' }]\r\n        });\r\n    };\r\n\r\n    const removeSubcategory = (index: number) => {\r\n        const newSubs = formData.subcategories.filter((_, i) => i !== index);\r\n        setFormData({ ...formData, subcategories: newSubs });\r\n    };\r\n\r\n    const generateSlug = (name: string) => {\r\n        return name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');\r\n    };\r\n\r\n    const handleNameChange = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const name = e.target.value;\r\n        if (!id && !formData.slug) {\r\n            // Auto-generate slug on creating new\r\n            setFormData({ ...formData, name, slug: generateSlug(name) });\r\n        } else {\r\n            setFormData({ ...formData, name });\r\n        }\r\n    };\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>, type: 'icon' | 'banner') => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        if (!formData.slug) {\r\n            alert('Please enter a Category Name first to generate a slug.');\r\n            e.target.value = ''; // Reset input\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setLoading(true);\r\n            const publicUrl = await uploadCategoryImage(file, formData.slug, type);\r\n\r\n            if (type === 'icon') {\r\n                setFormData(prev => ({ ...prev, image_url: publicUrl }));\r\n            } else {\r\n                setFormData(prev => ({ ...prev, banner_url: publicUrl }));\r\n            }\r\n        } catch (error) {\r\n            console.error('Upload failed:', error);\r\n            alert('Failed to upload image.');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        try {\r\n            if (id) {\r\n                await updateCategory(id, formData);\r\n            } else {\r\n                await createCategory({\r\n                    ...formData,\r\n                    subcategories: formData.subcategories.map(s => s.name) // Create only needs names\r\n                });\r\n            }\r\n            router.push('/admin/categories');\r\n            router.refresh();\r\n        } catch (error) {\r\n            console.error('Failed to save category', error);\r\n            alert('Failed to save category');\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (fetching) return <div className=\"p-8 text-center text-text-muted\">Loading category details...</div>;\r\n\r\n    return (\r\n        <div className=\"max-w-2xl mx-auto\">\r\n            <div className=\"flex items-center gap-4 mb-6\">\r\n                <Link href=\"/admin/categories\" className=\"p-2 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-full transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-text-muted\">arrow_back</span>\r\n                </Link>\r\n                <h1 className=\"text-2xl font-bold text-text-main\">{id ? 'Edit Category' : 'Add New Category'}</h1>\r\n            </div>\r\n\r\n            <form onSubmit={handleSubmit} className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-border-subtle shadow-sm space-y-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-text-muted\">Category Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.name}\r\n                            onChange={handleNameChange}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-border-subtle bg-transparent text-text-main focus:ring-primary focus:border-primary\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-text-muted\">Slug (URL)</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.slug}\r\n                            onChange={(e) => setFormData({ ...formData, slug: e.target.value })}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-border-subtle bg-transparent text-text-main focus:ring-primary focus:border-primary\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-bold text-text-muted\">Icon / Slider Image</label>\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        <label className=\"flex items-center gap-2 cursor-pointer w-fit px-4 py-2 bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors text-primary font-bold text-xs\">\r\n                            <span className=\"material-symbols-outlined text-sm\">cloud_upload</span>\r\n                            Upload Icon\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleImageUpload(e, 'icon')}\r\n                                className=\"hidden\"\r\n                                disabled={loading}\r\n                            />\r\n                        </label>\r\n                        <p className=\"text-[10px] text-slate-400 px-1\">\r\n                            Supported formats: JPG, PNG, WebP. We recommend <span className=\"font-semibold text-slate-500\">WebP</span> for superior performance.\r\n                        </p>\r\n                        <input\r\n                            type=\"url\"\r\n                            value={formData.image_url || ''}\r\n                            onChange={(e) => setFormData({ ...formData, image_url: e.target.value })}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-border-subtle bg-transparent text-text-main focus:ring-primary focus:border-primary\"\r\n                            placeholder=\"https://...\"\r\n                            required\r\n                        />\r\n                    </div>\r\n                    {formData.image_url && (\r\n                        <div className=\"mt-2 w-16 h-16 rounded-lg overflow-hidden border border-border-subtle\">\r\n                            <img src={formData.image_url} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-bold text-text-muted\">Hero Banner Image</label>\r\n                    <div className=\"flex flex-col gap-2\">\r\n                        <label className=\"flex items-center gap-2 cursor-pointer w-fit px-4 py-2 bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors text-primary font-bold text-xs\">\r\n                            <span className=\"material-symbols-outlined text-sm\">cloud_upload</span>\r\n                            Upload Banner\r\n                            <input\r\n                                type=\"file\"\r\n                                accept=\"image/*\"\r\n                                onChange={(e) => handleImageUpload(e, 'banner')}\r\n                                className=\"hidden\"\r\n                                disabled={loading}\r\n                            />\r\n                        </label>\r\n                        <p className=\"text-[10px] text-slate-400 px-1\">\r\n                            Supported formats: JPG, PNG, WebP. We recommend <span className=\"font-semibold text-slate-500\">WebP</span> for superior performance.\r\n                        </p>\r\n                        <input\r\n                            type=\"url\"\r\n                            value={formData.banner_url}\r\n                            onChange={(e) => setFormData({ ...formData, banner_url: e.target.value })}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-border-subtle bg-transparent text-text-main focus:ring-primary focus:border-primary\"\r\n                            placeholder=\"https://...\"\r\n                        />\r\n                    </div>\r\n                    {formData.banner_url && (\r\n                        <div className=\"mt-2 w-full h-32 rounded-lg overflow-hidden border border-border-subtle\">\r\n                            <img src={formData.banner_url} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"space-y-4 pt-4 border-t border-border-subtle\">\r\n                    <div className=\"flex justify-between items-center\">\r\n                        <label className=\"text-sm font-bold text-text-main\">Subcategories</label>\r\n                        <button type=\"button\" onClick={addSubcategory} className=\"text-sm text-primary font-bold hover:underline\">\r\n                            + Add Subcategory\r\n                        </button>\r\n                    </div>\r\n\r\n                    {formData.subcategories.map((sub, index) => (\r\n                        <div key={index} className=\"flex gap-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                value={sub.name}\r\n                                onChange={(e) => handleSubcategoryChange(index, e.target.value)}\r\n                                className=\"flex-1 px-4 py-2 rounded-lg border border-border-subtle bg-transparent text-text-main focus:ring-primary focus:border-primary\"\r\n                                placeholder=\"Subcategory Name\"\r\n                                required\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => removeSubcategory(index)}\r\n                                className=\"p-2 text-red-500 hover:bg-red-50 rounded-lg transition-colors\"\r\n                            >\r\n                                <span className=\"material-symbols-outlined\">delete</span>\r\n                            </button>\r\n                        </div>\r\n                    ))}\r\n                    {formData.subcategories.length === 0 && (\r\n                        <p className=\"text-sm text-text-muted italic\">No subcategories added.</p>\r\n                    )}\r\n                </div>\r\n\r\n                <div className=\"flex justify-end gap-4 pt-4 border-t border-border-subtle\">\r\n                    <Link href=\"/admin/categories\" className=\"px-6 py-2 rounded-lg font-bold border border-border-subtle text-text-muted hover:bg-gray-50 transition-colors\">\r\n                        Cancel\r\n                    </Link>\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading}\r\n                        className=\"px-6 py-2 rounded-lg font-bold bg-primary text-white hover:bg-primary/90 transition-colors disabled:opacity-50\"\r\n                    >\r\n                        {loading ? 'Saving...' : id ? 'Update Category' : 'Create Category'}\r\n                    </button>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\categories\\[id]\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\categories\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\categories\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":119,"column":49,"nodeType":"JSXOpeningElement","endLine":119,"endColumn":124},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":192,"column":65,"nodeType":"JSXOpeningElement","endLine":192,"endColumn":208}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getCategories, deleteCategory, getCategoryProducts, deleteProduct } from '@/lib/api';\r\n\r\nexport default function AdminCategoriesPage() {\r\n    const [categories, setCategories] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    // Conflict Modal State\r\n    const [conflictModalOpen, setConflictModalOpen] = useState(false);\r\n    const [conflictingProducts, setConflictingProducts] = useState<any[]>([]);\r\n    const [targetCategoryId, setTargetCategoryId] = useState<string | null>(null);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const data = await getCategories();\r\n            setCategories(data);\r\n        } catch (error: any) {\r\n            console.error('Failed to fetch categories', error);\r\n            // Alert the user to the error for debugging\r\n            alert(`Debug Error: ${error.message || JSON.stringify(error)}`);\r\n            setCategories([]);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = async (id: string) => {\r\n        // Check for conflicts first\r\n        const products = await getCategoryProducts(id);\r\n        if (products.length > 0) {\r\n            setConflictingProducts(products);\r\n            setTargetCategoryId(id);\r\n            setConflictModalOpen(true);\r\n        } else {\r\n            if (confirm('Are you sure you want to delete this category?')) {\r\n                performDelete(id);\r\n            }\r\n        }\r\n    };\r\n\r\n    const performDelete = async (id: string) => {\r\n        try {\r\n            await deleteCategory(id);\r\n            setConflictModalOpen(false);\r\n            setTargetCategoryId(null);\r\n            fetchData(); // Refresh\r\n        } catch (error: any) {\r\n            console.error('Failed to delete category', error);\r\n            alert(error.message || 'Failed to delete category');\r\n        }\r\n    };\r\n\r\n    const handleProductDelete = async (productId: string) => {\r\n        if (!confirm('Delete this product?')) return;\r\n        try {\r\n            await deleteProduct(productId);\r\n            // Update local state\r\n            const updated = conflictingProducts.filter(p => p.id !== productId);\r\n            setConflictingProducts(updated);\r\n            if (updated.length === 0) {\r\n                // If no products left, user can now delete category\r\n                // Optionally auto-delete or just let them click delete again.\r\n                // Let's keep modal open but show \"Safe to delete now\" or just close and let them click delete?\r\n                // Better: Auto-close and maybe prompt to delete category?\r\n                // Simplest: Just refresh list.\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to delete product', error);\r\n            alert('Failed to delete product');\r\n        }\r\n    };\r\n\r\n    const getTargetCategoryName = () => {\r\n        return categories.find(c => c.id === targetCategoryId)?.name || 'Category';\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <h1 className=\"text-2xl font-bold text-text-main\">Categories</h1>\r\n                <Link href=\"/admin/categories/new\" className=\"px-4 py-2 bg-primary text-white rounded-lg font-bold hover:bg-primary/90 transition-colors flex items-center gap-2\">\r\n                    <span className=\"material-symbols-outlined text-[20px]\">add</span>\r\n                    Add Category\r\n                </Link>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-gray-50 dark:bg-slate-700 text-text-muted text-[11px] uppercase tracking-wider font-bold border-b border-border-subtle\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4\">Image</th>\r\n                                <th className=\"px-6 py-4\">Name</th>\r\n                                <th className=\"px-6 py-4\">Slug</th>\r\n                                <th className=\"px-6 py-4\">Subcategories</th>\r\n                                <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border-subtle\">\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-8 text-center text-text-muted\">Loading...</td>\r\n                                </tr>\r\n                            ) : categories.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-8 text-center text-text-muted\">No categories found.</td>\r\n                                </tr>\r\n                            ) : (\r\n                                categories.map((cat) => (\r\n                                    <tr key={cat.id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"w-12 h-12 bg-gray-100 rounded-lg overflow-hidden border border-border-subtle\">\r\n                                                <img src={cat.img} alt={cat.name} className=\"w-full h-full object-cover\" />\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-text-main\">{cat.name}</td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">{cat.slug}</td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">\r\n                                            {cat.subcategories?.length || 0} items\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            <div className=\"flex items-center justify-end gap-2\">\r\n                                                <Link href={`/admin/categories/${cat.id}`} className=\"p-2 hover:bg-blue-50 text-blue-600 rounded-lg transition-colors\">\r\n                                                    <span className=\"material-symbols-outlined text-[20px]\">edit</span>\r\n                                                </Link>\r\n                                                <button\r\n                                                    onClick={() => handleDeleteClick(cat.id)}\r\n                                                    className=\"p-2 hover:bg-red-50 text-red-600 rounded-lg transition-colors\"\r\n                                                >\r\n                                                    <span className=\"material-symbols-outlined text-[20px]\">delete</span>\r\n                                                </button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Conflict Modal */}\r\n            {conflictModalOpen && (\r\n                <div className=\"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col\">\r\n                        <div className=\"p-6 border-b border-border-subtle\">\r\n                            <h3 className=\"text-xl font-bold text-red-600 flex items-center gap-2\">\r\n                                <span className=\"material-symbols-outlined\">warning</span>\r\n                                Cannot Delete \"{getTargetCategoryName()}\"\r\n                            </h3>\r\n                            <p className=\"text-text-muted mt-2\">\r\n                                This category contains <strong>{conflictingProducts.length}</strong> products. You must perform an action on them before deleting the category.\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"flex-1 overflow-y-auto p-0\">\r\n                            {conflictingProducts.length === 0 ? (\r\n                                <div className=\"p-8 text-center\">\r\n                                    <div className=\"w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mx-auto mb-4\">\r\n                                        <span className=\"material-symbols-outlined\">check</span>\r\n                                    </div>\r\n                                    <p className=\"text-text-main font-bold\">All products removed!</p>\r\n                                    <p className=\"text-sm text-text-muted mb-4\">You can now delete this category.</p>\r\n                                    <button\r\n                                        onClick={() => targetCategoryId && performDelete(targetCategoryId)}\r\n                                        className=\"px-6 py-2 bg-red-600 text-white rounded-lg font-bold hover:bg-red-700 transition-colors\"\r\n                                    >\r\n                                        Delete Category Now\r\n                                    </button>\r\n                                </div>\r\n                            ) : (\r\n                                <table className=\"w-full text-left\">\r\n                                    <thead className=\"bg-gray-50 dark:bg-slate-700/50 text-xs font-bold text-text-muted uppercase\">\r\n                                        <tr>\r\n                                            <th className=\"px-6 py-3\">Product</th>\r\n                                            <th className=\"px-6 py-3 text-right\">Actions</th>\r\n                                        </tr>\r\n                                    </thead>\r\n                                    <tbody className=\"divide-y divide-border-subtle\">\r\n                                        {conflictingProducts.map(product => (\r\n                                            <tr key={product.id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/30\">\r\n                                                <td className=\"px-6 py-3\">\r\n                                                    <div className=\"flex items-center gap-3\">\r\n                                                        <div className=\"w-10 h-10 rounded-lg overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                                                            {product.image ? (\r\n                                                                <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" onError={(e) => (e.currentTarget.style.display = 'none')} />\r\n                                                            ) : (\r\n                                                                <span className=\"material-symbols-outlined text-gray-400 text-sm\">image</span>\r\n                                                            )}\r\n                                                        </div>\r\n                                                        <span className=\"font-medium text-text-main\">{product.name}</span>\r\n                                                    </div>\r\n                                                </td>\r\n                                                <td className=\"px-6 py-3 text-right\">\r\n                                                    <div className=\"flex items-center justify-end gap-2\">\r\n                                                        <Link\r\n                                                            href={`/admin/products/${product.id}`}\r\n                                                            target=\"_blank\"\r\n                                                            className=\"px-3 py-1.5 text-xs font-bold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-md transition-colors\"\r\n                                                        >\r\n                                                            Update\r\n                                                        </Link>\r\n                                                        <button\r\n                                                            onClick={() => handleProductDelete(product.id)}\r\n                                                            className=\"px-3 py-1.5 text-xs font-bold text-red-600 bg-red-50 hover:bg-red-100 rounded-md transition-colors\"\r\n                                                        >\r\n                                                            Remove\r\n                                                        </button>\r\n                                                    </div>\r\n                                                </td>\r\n                                            </tr>\r\n                                        ))}\r\n                                    </tbody>\r\n                                </table>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div className=\"p-4 border-t border-border-subtle flex justify-end\">\r\n                            <button\r\n                                onClick={() => setConflictModalOpen(false)}\r\n                                className=\"px-4 py-2 text-text-muted font-bold hover:bg-gray-100 dark:hover:bg-slate-700 rounded-lg transition-colors\"\r\n                            >\r\n                                Close\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\customers\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRouter' is defined but never used.","line":6,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":19,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useRouter"},"fix":{"range":[198,242],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":60,"column":25,"nodeType":"JSXOpeningElement","endLine":60,"endColumn":180}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getCustomerById, getUserOrders } from '@/lib/api';\r\nimport { formatPrice } from '@/lib/format';\r\nimport { useRouter } from 'next/navigation';\r\n\r\ninterface Props {\r\n    params: Promise<{ id: string }>;\r\n}\r\n\r\nexport default function CustomerDetailsPage({ params }: Props) {\r\n    const [id, setId] = useState<string>('');\r\n    useEffect(() => {\r\n        params.then(p => setId(p.id));\r\n    }, [params]);\r\n\r\n    const [customer, setCustomer] = useState<any>(null);\r\n    const [orders, setOrders] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (id) {\r\n            fetchData(id);\r\n        }\r\n    }, [id]);\r\n\r\n    const fetchData = async (userId: string) => {\r\n        try {\r\n            const [custData, ordersData] = await Promise.all([\r\n                getCustomerById(userId),\r\n                getUserOrders(userId)\r\n            ]);\r\n            setCustomer(custData);\r\n            setOrders(ordersData);\r\n        } catch (error) {\r\n            console.error('Failed to fetch customer details', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (loading) return <div className=\"p-8 text-center text-text-muted\">Loading details...</div>;\r\n    if (!customer) return <div className=\"p-8 text-center text-text-muted\">Customer not found.</div>;\r\n\r\n    return (\r\n        <div className=\"space-y-8 max-w-5xl mx-auto\">\r\n            {/* Header / Back Link */}\r\n            <div className=\"flex items-center gap-4\">\r\n                <Link href=\"/admin/customers\" className=\"p-2 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-full transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-text-muted\">arrow_back</span>\r\n                </Link>\r\n                <h1 className=\"text-2xl font-bold text-text-main\">Customer Profile</h1>\r\n            </div>\r\n\r\n            {/* Profile Card */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle p-8 shadow-sm flex flex-col md:flex-row gap-8 items-center md:items-start\">\r\n                <div className=\"w-32 h-32 rounded-full overflow-hidden bg-gray-100 shrink-0 border-4 border-white dark:border-slate-700 shadow-lg\">\r\n                    {customer.avatar_url ? (\r\n                        <img src={customer.avatar_url} alt={customer.full_name} className=\"w-full h-full object-cover\" onError={(e) => (e.currentTarget.style.display = 'none')} />\r\n                    ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center bg-primary/10 text-primary\">\r\n                            <span className=\"material-symbols-outlined text-5xl\">person</span>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n                <div className=\"flex-1 text-center md:text-left space-y-4\">\r\n                    <div>\r\n                        <h2 className=\"text-3xl font-bold text-text-main\">{customer.full_name || 'Unknown User'}</h2>\r\n                        {customer.username && <p className=\"text-lg text-text-muted\">@{customer.username}</p>}\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-4 max-w-lg\">\r\n                        <div className=\"p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-border-subtle\">\r\n                            <p className=\"text-xs font-bold text-text-muted uppercase tracking-wider mb-1\">Phone</p>\r\n                            <p className=\"text-text-main font-medium\">{customer.phone || 'N/A'}</p>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-border-subtle\">\r\n                            <p className=\"text-xs font-bold text-text-muted uppercase tracking-wider mb-1\">Joined</p>\r\n                            <p className=\"text-text-main font-medium\">\r\n                                {customer.created_at || customer.updated_at ? new Date(customer.created_at || customer.updated_at).toLocaleDateString('en-US') : 'N/A'}\r\n                            </p>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-border-subtle\">\r\n                            <p className=\"text-xs font-bold text-text-muted uppercase tracking-wider mb-1\">Total Orders</p>\r\n                            <p className=\"text-2xl font-bold text-primary\">{orders.length}</p>\r\n                        </div>\r\n                        <div className=\"p-4 rounded-xl bg-gray-50 dark:bg-slate-700/50 border border-border-subtle\">\r\n                            <p className=\"text-xs font-bold text-text-muted uppercase tracking-wider mb-1\">Total Spent</p>\r\n                            <p className=\"text-2xl font-bold text-green-600\">\r\n                                {formatPrice(orders.reduce((sum, o) => sum + (o.total_amount || 0), 0))}\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Order History */}\r\n            <div className=\"space-y-4\">\r\n                <h3 className=\"text-xl font-bold text-text-main px-2\">Order History</h3>\r\n                <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm overflow-hidden\">\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-left\">\r\n                            <thead className=\"bg-gray-50 dark:bg-slate-700 text-text-muted text-[11px] uppercase tracking-wider font-bold border-b border-border-subtle\">\r\n                                <tr>\r\n                                    <th className=\"px-6 py-4\">Order ID</th>\r\n                                    <th className=\"px-6 py-4\">Date</th>\r\n                                    <th className=\"px-6 py-4\">Status</th>\r\n                                    <th className=\"px-6 py-4 text-right\">Amount</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-border-subtle\">\r\n                                {orders.length === 0 ? (\r\n                                    <tr>\r\n                                        <td colSpan={4} className=\"px-6 py-8 text-center text-text-muted\">No orders found.</td>\r\n                                    </tr>\r\n                                ) : (\r\n                                    orders.map((order) => (\r\n                                        <tr key={order.id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                            <td className=\"px-6 py-4 font-mono text-sm text-text-muted\">\r\n                                                #{order.id.toString().slice(0, 8)}...\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-sm text-text-muted\">\r\n                                                {new Date(order.created_at).toLocaleDateString()}\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4\">\r\n                                                <span className={`px-2 py-1 rounded-full text-xs font-bold uppercase ${order.status === 'delivered' ? 'bg-green-100 text-green-700' :\r\n                                                    order.status === 'cancelled' ? 'bg-red-100 text-red-700' :\r\n                                                        order.status === 'processing' ? 'bg-blue-100 text-blue-700' :\r\n                                                            'bg-yellow-100 text-yellow-700'\r\n                                                    }`}>\r\n                                                    {order.status}\r\n                                                </span>\r\n                                            </td>\r\n                                            <td className=\"px-6 py-4 text-right font-bold text-text-main\">\r\n                                                {formatPrice(order.total_amount)}\r\n                                            </td>\r\n                                        </tr>\r\n                                    ))\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\customers\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":16,"column":8,"nodeType":"ArrayExpression","endLine":16,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [fetchData, searchQuery]","fix":{"range":[514,527],"text":"[fetchData, searchQuery]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":78,"column":57,"nodeType":"JSXOpeningElement","endLine":78,"endColumn":222}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getCustomers } from '@/lib/api';\r\n\r\nexport default function AdminCustomersPage() {\r\n    const [customers, setCustomers] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            fetchData();\r\n        }, 500);\r\n        return () => clearTimeout(timer);\r\n    }, [searchQuery]);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await getCustomers(searchQuery);\r\n            setCustomers(data);\r\n        } catch (error) {\r\n            console.error('Failed to fetch customers', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4\">\r\n                <h1 className=\"text-2xl font-bold text-text-main\">Customers</h1>\r\n                <div className=\"flex items-center gap-4 w-full sm:w-auto\">\r\n                    <div className=\"relative flex-1 sm:w-64\">\r\n                        <span className=\"material-symbols-outlined absolute left-3 top-1/2 -translate-y-1/2 text-text-muted text-lg\">search</span>\r\n                        <input\r\n                            type=\"text\"\r\n                            placeholder=\"Search by phone...\"\r\n                            value={searchQuery}\r\n                            onChange={(e) => setSearchQuery(e.target.value)}\r\n                            className=\"w-full pl-10 pr-4 py-2 rounded-lg border border-border-subtle bg-white dark:bg-slate-800 text-sm focus:ring-primary focus:border-primary\"\r\n                        />\r\n                    </div>\r\n                    <div className=\"bg-primary/10 text-primary px-4 py-2 rounded-lg font-bold whitespace-nowrap\">\r\n                        {customers.length} Users\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-gray-50 dark:bg-slate-700 text-text-muted text-[11px] uppercase tracking-wider font-bold border-b border-border-subtle\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4\">User</th>\r\n                                <th className=\"px-6 py-4\">Phone</th>\r\n                                <th className=\"px-6 py-4\">Joined</th>\r\n                                <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border-subtle\">\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={4} className=\"px-6 py-8 text-center text-text-muted\">Loading...</td>\r\n                                </tr>\r\n                            ) : customers.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={4} className=\"px-6 py-8 text-center text-text-muted\">No customers found.</td>\r\n                                </tr>\r\n                            ) : (\r\n                                customers.map((customer) => (\r\n                                    <tr key={customer.id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-10 h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center\">\r\n                                                    {customer.avatar_url ? (\r\n                                                        <img src={customer.avatar_url} alt={customer.full_name || 'User'} className=\"w-full h-full object-cover\" onError={(e) => (e.currentTarget.style.display = 'none')} />\r\n                                                    ) : (\r\n                                                        <span className=\"material-symbols-outlined text-gray-400\">person</span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"font-bold text-text-main\">{customer.full_name || 'Unknown User'}</p>\r\n                                                    {customer.username && <p className=\"text-xs text-text-muted\">@{customer.username}</p>}\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">\r\n                                            {customer.phone || 'N/A'}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">\r\n                                            {customer.created_at || customer.updated_at ? new Date(customer.created_at || customer.updated_at).toLocaleDateString('en-US') : 'N/A'}\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            <Link href={`/admin/customers/${customer.id}`} className=\"px-3 py-1.5 bg-primary/10 text-primary text-xs font-bold rounded-lg hover:bg-primary/20 transition-colors\">\r\n                                                View Details\r\n                                            </Link>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\documentation\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\layout.tsx","messages":[{"ruleId":"@next/next/no-page-custom-font","severity":1,"message":"Custom fonts not added in `pages/_document.js` will only load for a single page. This is discouraged. See: https://nextjs.org/docs/messages/no-page-custom-font","line":108,"column":17,"nodeType":"JSXOpeningElement","endLine":108,"endColumn":153}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n'use client';\r\nimport Link from 'next/link';\r\nimport { usePathname, useRouter } from 'next/navigation';\r\nimport { AdminNotificationProvider } from '@/context/AdminNotificationContext';\r\nimport { NotificationDropdown } from '@/components/admin/NotificationDropdown';\r\nimport { useEffect } from 'react';\r\nimport { useTheme } from 'next-themes';\r\nimport { useAdminAuth } from '@/context/AdminAuthContext';\r\n\r\nfunction ThemeToggle() {\r\n    const { theme, setTheme } = useTheme();\r\n\r\n    return (\r\n        <button\r\n            onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')}\r\n            className=\"w-full flex items-center gap-3 px-3 py-2 rounded-xl text-text-main hover:bg-white dark:hover:bg-slate-700 border border-transparent hover:border-slate-200 dark:hover:border-slate-600 transition-all group\"\r\n        >\r\n            <span className=\"material-symbols-outlined !text-[20px] text-text-muted group-hover:text-primary transition-colors\">\r\n                {theme === 'dark' ? 'light_mode' : 'dark_mode'}\r\n            </span>\r\n            <span className=\"text-sm font-medium\">\r\n                {theme === 'dark' ? 'Light Mode' : 'Dark Mode'}\r\n            </span>\r\n        </button>\r\n    );\r\n}\r\n\r\nfunction AdminProtectedLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode;\r\n}) {\r\n    const pathname = usePathname();\r\n    const router = useRouter();\r\n    const { adminUser, adminLoading, signOutAdmin } = useAdminAuth();\r\n\r\n    const isPublicAdminPage = pathname === '/admin/login' || pathname === '/admin/register';\r\n\r\n    useEffect(() => {\r\n        console.log('[LAYOUT DEBUG] Session Check:', {\r\n            adminLoading,\r\n            hasUser: !!adminUser,\r\n            pathname,\r\n        });\r\n\r\n        if (!isPublicAdminPage && !adminLoading && !adminUser) {\r\n            console.log('[LAYOUT DEBUG] Redirecting to login due to missing session - Ensuring Logout');\r\n            // Force sign out to clear potentially invalid session cookies that trap the user in a loop\r\n            // asking for /admin -> middleware sees valid cookie -> /admin -> layout sees no profile -> /login\r\n            signOutAdmin().then(() => {\r\n                router.replace('/admin/login');\r\n            });\r\n        }\r\n    }, [adminUser, adminLoading, router, isPublicAdminPage, pathname, signOutAdmin]);\r\n\r\n    // Allow access to login and register page without auth check or dashboard layout\r\n    if (isPublicAdminPage) {\r\n        return <>{children}</>;\r\n    }\r\n\r\n    if (adminLoading) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-900\">\r\n                <div className=\"flex flex-col items-center gap-4\">\r\n                    <div className=\"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n                    <p className=\"text-slate-500 font-medium\">Loading Admin Panel...</p>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (!adminUser) {\r\n        // Don't show blocking UI which can get stuck.\r\n        // The useEffect will handle the redirect.\r\n        // Return null to render nothing while redirecting? \r\n        // Or better: render null, but ensure the useEffect fires.\r\n        return null;\r\n    }\r\n\r\n    const navItems = [\r\n        { name: 'Dashboard', href: '/admin', icon: 'dashboard' },\r\n        { name: 'Orders', href: '/admin/orders', icon: 'shopping_bag' },\r\n        { name: 'Products', href: '/admin/products', icon: 'inventory_2' },\r\n\r\n        ...((adminUser?.role === 'SUPERADMIN') ? [ // Allow SUPERADMIN\r\n            { name: 'Special Offers', href: '/admin/special-categories', icon: 'local_offer' },\r\n            { name: 'Customers', href: '/admin/customers', icon: 'group' },\r\n            { name: 'Merchants', href: '/admin/merchants', icon: 'admin_panel_settings' },\r\n            { name: 'Categories', href: '/admin/categories', icon: 'category' }\r\n        ] : []),\r\n\r\n        ...((adminUser?.role === 'SUPERADMIN') ? [\r\n            { name: 'Reviews', href: '/admin/reviews', icon: 'reviews' },\r\n        ] : []),\r\n\r\n        { name: 'Settings', href: '/admin/settings', icon: 'settings' },\r\n        { name: 'Documentation', href: '/admin/documentation', icon: 'menu_book' },\r\n    ];\r\n\r\n    const activeItem = navItems.find(item => item.href === pathname) || navItems[0];\r\n    const pageTitle = activeItem ? (activeItem.name === 'Dashboard' ? 'Dashboard Overview' : activeItem.name) : 'Dashboard Overview';\r\n\r\n    return (\r\n        <AdminNotificationProvider>\r\n            <div className=\"flex min-h-screen bg-background-light dark:bg-background-dark text-text-main font-sans\">\r\n                {/* Load Material Symbols */}\r\n                <link href=\"https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap\" rel=\"stylesheet\" />\r\n                <style jsx global>{`\r\n                    .material-symbols-outlined {\r\n                        font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;\r\n                    }\r\n                    .active-nav {\r\n                        background-color: #22C55E;\r\n                        color: white;\r\n                    }\r\n                    .active-nav .material-symbols-outlined {\r\n                        color: white; /* Ensure icon is white in active state */\r\n                    }\r\n                `}</style>\r\n                <div\r\n                    className=\"fixed inset-0 z-0 pointer-events-none opacity-[0.03]\"\r\n                    style={{ backgroundImage: \"url('https://www.transparenttextures.com/patterns/cubes.png')\" }}\r\n                ></div>\r\n\r\n                {/* Sidebar Navigation */}\r\n                <aside className=\"w-64 border-r border-border-subtle bg-white dark:bg-slate-800 sticky top-0 h-screen flex flex-col z-10 shadow-sm\">\r\n                    <div className=\"p-6 flex items-center gap-3\">\r\n                        <div className=\"bg-primary rounded-xl p-2 flex items-center justify-center shadow-lg shadow-primary/20\">\r\n                            <span className=\"material-symbols-outlined text-white\">storefront</span>\r\n                        </div>\r\n                        <div className=\"flex flex-col\">\r\n                            <h1 className=\"text-text-main text-lg font-bold leading-none tracking-tight\">Daily Fresh</h1>\r\n                            <p className=\"text-text-muted text-xs font-bold uppercase tracking-wider mt-1\">Admin Panel</p>\r\n                        </div>\r\n                    </div>\r\n                    <nav className=\"flex-1 px-4 py-4 space-y-1 overflow-y-auto\">\r\n                        {navItems.map((item) => {\r\n                            const isActive = pathname === item.href;\r\n                            return (\r\n                                <Link\r\n                                    key={item.href}\r\n                                    href={item.href}\r\n                                    className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-all group ${isActive ? 'active-nav shadow-lg shadow-primary/20' : 'text-text-main hover:bg-primary/5 hover:translate-x-1'\r\n                                        }`}\r\n                                >\r\n                                    <span className={`material-symbols-outlined !text-[20px] transition-transform group-hover:scale-110 ${isActive ? '' : 'text-text-muted'}`}>{item.icon}</span>\r\n                                    <span className=\"text-sm font-bold\">{item.name}</span>\r\n                                </Link>\r\n                            );\r\n                        })}\r\n                    </nav>\r\n                    <div className=\"p-4 border-t border-border-subtle bg-slate-50/50 dark:bg-slate-800/50\">\r\n                        <ThemeToggle />\r\n                        <div className=\"flex items-center gap-3 px-3 py-3 rounded-xl bg-white dark:bg-slate-700 border border-slate-100 dark:border-slate-600 shadow-sm mt-3\">\r\n                            <div className=\"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center shrink-0\">\r\n                                <span className=\"material-symbols-outlined text-primary\">person</span>\r\n                            </div>\r\n                            <div className=\"flex flex-col overflow-hidden flex-1\">\r\n                                <span className=\"text-xs font-bold text-text-main truncate\">{adminUser?.email?.split('@')[0] || 'Admin'}</span>\r\n                                <span className=\"text-[10px] text-text-muted truncate\">Administrator</span>\r\n                            </div>\r\n                            <button\r\n                                onClick={() => signOutAdmin()}\r\n                                className=\"p-1.5 rounded-lg hover:bg-red-50 text-slate-400 hover:text-red-500 transition-colors\"\r\n                            >\r\n                                <span className=\"material-symbols-outlined !text-[18px]\">logout</span>\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n                </aside>\r\n\r\n                {/* Main Content */}\r\n                <main className=\"flex-1 flex flex-col overflow-hidden relative z-10\">\r\n                    {/* Top Navbar */}\r\n                    <header className=\"flex items-center justify-between px-8 py-4 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border-b border-border-subtle sticky top-0 z-20 shrink-0\">\r\n                        <div className=\"flex items-center gap-6\">\r\n                            <h2 className=\"text-xl font-bold text-text-main\">{pageTitle}</h2>\r\n                        </div>\r\n                        <div className=\"flex items-center gap-4\">\r\n                            <NotificationDropdown />\r\n                            <Link href=\"/admin/documentation\" className=\"w-10 h-10 flex items-center justify-center rounded-full hover:bg-primary/10 text-text-main transition-colors\" title=\"Documentation\">\r\n                                <span className=\"material-symbols-outlined\">help_outline</span>\r\n                            </Link>\r\n                            <div className=\"h-6 w-px bg-border-subtle mx-2\"></div>\r\n                            <div className=\"flex items-center gap-2 px-2 py-1 rounded-lg\">\r\n                                <div className=\"w-8 h-8 rounded-lg bg-primary/20 flex items-center justify-center text-primary font-bold\">\r\n                                    {adminUser?.email?.[0].toUpperCase() || 'A'}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </header>\r\n\r\n                    <div className=\"flex-1 overflow-y-auto p-8 space-y-8 max-w-7xl mx-auto w-full\">\r\n                        {children}\r\n                    </div>\r\n                </main>\r\n            </div>\r\n        </AdminNotificationProvider>\r\n    );\r\n}\r\n\r\nimport { AdminAuthProvider } from '@/context/AdminAuthContext';\r\n\r\nexport default function AdminLayout({\r\n    children,\r\n}: {\r\n    children: React.ReactNode;\r\n}) {\r\n    return (\r\n        <AdminAuthProvider>\r\n            <AdminProtectedLayout>{children}</AdminProtectedLayout>\r\n        </AdminAuthProvider>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\login\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'theme' is assigned a value but never used.","line":15,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":15,"endColumn":18},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setShowTwoFactor' is assigned a value but never used.","line":19,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":19,"endColumn":43}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\n\"use client\"\r\n\r\nimport { useState, useTransition } from \"react\"\r\nimport { useForm } from \"react-hook-form\"\r\nimport { zodResolver } from \"@hookform/resolvers/zod\"\r\nimport * as z from \"zod\"\r\nimport { LoginSchema } from \"@/schemas\"\r\nimport { createClient } from \"@/lib/supabase/client\"\r\nimport { useTheme } from \"next-themes\"\r\nimport Link from \"next/link\"\r\nimport { useRouter } from \"next/navigation\"\r\n\r\nexport default function LoginPage() {\r\n    const { theme } = useTheme()\r\n    const [isPending, startTransition] = useTransition()\r\n    const [error, setError] = useState<string | undefined>(\"\")\r\n    const [success, setSuccess] = useState<string | undefined>(\"\")\r\n    const [showTwoFactor, setShowTwoFactor] = useState(false)\r\n\r\n    const form = useForm<z.infer<typeof LoginSchema>>({\r\n        resolver: zodResolver(LoginSchema),\r\n        defaultValues: {\r\n            email: \"\",\r\n            password: \"\",\r\n            code: \"\",\r\n        },\r\n    })\r\n\r\n\r\n    const router = useRouter()\r\n    const supabase = createClient()\r\n\r\n    const onSubmit = (values: z.infer<typeof LoginSchema>) => {\r\n        setError(\"\")\r\n        setSuccess(\"\")\r\n\r\n        startTransition(async () => {\r\n            const { data, error: authError } = await supabase.auth.signInWithPassword({\r\n                email: values.email,\r\n                password: values.password,\r\n            })\r\n\r\n            if (authError) {\r\n                setError(authError.message)\r\n                return\r\n            }\r\n\r\n            // Check user role from public.User table\r\n            if (data.user) {\r\n                const { data: profile } = await supabase\r\n                    .from('User')\r\n                    .select('role')\r\n                    .eq('id', data.user.id)\r\n                    .single()\r\n\r\n                // Only allow MERCHANT and SUPERADMIN roles to login to admin panel\r\n                if (profile && profile.role !== 'MERCHANT' && profile.role !== 'SUPERADMIN') {\r\n                    await supabase.auth.signOut()\r\n                    setError('This account is not authorized to access the admin panel. Please use the customer portal.')\r\n                    return\r\n                }\r\n            }\r\n\r\n            setSuccess(\"Login successful!\")\r\n            router.refresh()\r\n            router.push('/admin')\r\n        })\r\n    }\r\n\r\n    return (\r\n        <div className=\"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-slate-900 p-4\">\r\n            <div className=\"max-w-md w-full bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 space-y-6 border border-gray-100 dark:border-slate-700\">\r\n                <div className=\"text-center space-y-2\">\r\n                    <h1 className=\"text-3xl font-bold text-gray-900 dark:text-white\">Welcome Back</h1>\r\n                    <p className=\"text-gray-500 dark:text-gray-400\">Sign in to your admin dashboard</p>\r\n                </div>\r\n\r\n                <form onSubmit={form.handleSubmit(onSubmit)} className=\"space-y-4\">\r\n                    {!showTwoFactor && (\r\n                        <>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-200\">Email</label>\r\n                                <input\r\n                                    {...form.register(\"email\")}\r\n                                    type=\"email\"\r\n                                    disabled={isPending}\r\n                                    className=\"w-full px-4 py-3 rounded-lg bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all dark:text-white\"\r\n                                    placeholder=\"admin@example.com\"\r\n                                />\r\n                                {form.formState.errors.email && (\r\n                                    <p className=\"text-sm text-red-500\">{form.formState.errors.email.message}</p>\r\n                                )}\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-medium text-gray-700 dark:text-gray-200\">Password</label>\r\n                                <input\r\n                                    {...form.register(\"password\")}\r\n                                    type=\"password\"\r\n                                    disabled={isPending}\r\n                                    className=\"w-full px-4 py-3 rounded-lg bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all dark:text-white\"\r\n                                    placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                                />\r\n                                {form.formState.errors.password && (\r\n                                    <p className=\"text-sm text-red-500\">{form.formState.errors.password.message}</p>\r\n                                )}\r\n                            </div>\r\n                        </>\r\n                    )}\r\n\r\n                    {showTwoFactor && (\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-medium text-gray-700 dark:text-gray-200\">Two Factor Code</label>\r\n                            <input\r\n                                {...form.register(\"code\")}\r\n                                disabled={isPending}\r\n                                className=\"w-full px-4 py-3 rounded-lg bg-gray-50 dark:bg-slate-900 border border-gray-200 dark:border-slate-700 focus:ring-2 focus:ring-primary focus:border-transparent outline-none transition-all dark:text-white text-center tracking-widest text-lg\"\r\n                                placeholder=\"123456\"\r\n                            />\r\n                        </div>\r\n                    )}\r\n\r\n                    {error && (\r\n                        <div className=\"p-3 bg-red-50/50 border border-red-200 text-red-600 rounded-lg text-sm text-center\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    {success && (\r\n                        <div className=\"p-3 bg-emerald-50/50 border border-emerald-200 text-emerald-600 rounded-lg text-sm text-center\">\r\n                            {success}\r\n                        </div>\r\n                    )}\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={isPending}\r\n                        className=\"w-full py-3 px-4 bg-primary hover:bg-primary/90 text-white font-medium rounded-lg shadow-lg shadow-primary/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isPending ? \"Authenticating...\" : showTwoFactor ? \"Confirm\" : \"Sign In\"}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className=\"text-center pt-4 border-t border-gray-100 dark:border-slate-700\">\r\n                    <p className=\"text-sm text-gray-500 dark:text-gray-400\">\r\n                        Want to become a merchant?{' '}\r\n                        <Link href=\"/admin/register\" className=\"text-primary hover:underline font-medium\">\r\n                            Register here\r\n                        </Link>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\low-stock\\page.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":62,"column":53,"nodeType":"JSXOpeningElement","endLine":62,"endColumn":138}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport { getLowStockProducts } from '@/lib/api';\r\nimport { formatPrice } from '@/lib/format';\r\n\r\nexport default function LowStockPage() {\r\n    const [products, setProducts] = useState<any[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n    }, []);\r\n\r\n    const fetchData = async () => {\r\n        try {\r\n            const data = await getLowStockProducts();\r\n            setProducts(data);\r\n        } catch (error) {\r\n            console.error('Failed to fetch low stock products', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6\">\r\n            <div className=\"flex items-center gap-4\">\r\n                <Link href=\"/admin\" className=\"p-2 hover:bg-gray-100 dark:hover:bg-slate-800 rounded-full transition-colors\">\r\n                    <span className=\"material-symbols-outlined text-text-muted\">arrow_back</span>\r\n                </Link>\r\n                <h1 className=\"text-2xl font-bold text-text-main\">Low Stock Alert</h1>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-red-50 dark:bg-red-900/10 text-red-700 dark:text-red-400 text-[11px] uppercase tracking-wider font-bold border-b border-red-100 dark:border-red-900/20\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4\">Product</th>\r\n                                <th className=\"px-6 py-4\">Category</th>\r\n                                <th className=\"px-6 py-4\">Price</th>\r\n                                <th className=\"px-6 py-4\">Current Stock</th>\r\n                                <th className=\"px-6 py-4 text-right\">Status</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border-subtle\">\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-8 text-center text-text-muted\">Loading...</td>\r\n                                </tr>\r\n                            ) : products.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={5} className=\"px-6 py-8 text-center text-text-muted\">No low stock items found.</td>\r\n                                </tr>\r\n                            ) : (\r\n                                products.map((product) => (\r\n                                    <tr key={product.id} className=\"hover:bg-gray-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <div className=\"w-10 h-10 bg-gray-100 rounded-lg overflow-hidden shrink-0\">\r\n                                                    <img src={product.image} alt={product.name} className=\"w-full h-full object-cover\" />\r\n                                                </div>\r\n                                                <span className=\"text-sm font-bold text-text-main\">{product.name}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">{product.category}</td>\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-text-main\">{formatPrice(product.price)}</td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-bold bg-red-100 text-red-700\">\r\n                                                {product.stock_quantity} left\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            <span className=\"text-xs font-bold text-red-600 uppercase tracking-wider\">Restock</span>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\merchants\\page.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'router'. Either include it or remove the dependency array.","line":35,"column":8,"nodeType":"ArrayExpression","endLine":35,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [adminUser, adminLoading, router]","fix":{"range":[1107,1132],"text":"[adminUser, adminLoading, router]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport { useAdminAuth } from '@/context/AdminAuthContext';\r\nimport { getMerchants, updateMerchantStatus } from '@/lib/api';\r\n\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\n\r\ntype AdminUser = {\r\n    id: string;\r\n    email: string;\r\n    full_name: string;\r\n    shop_name?: string;\r\n    status: 'pending' | 'approved' | 'rejected' | 'suspended';\r\n    role: 'SUPERADMIN' | 'MERCHANT' | 'CUSTOMER';\r\n    created_at: string;\r\n    phone?: string;\r\n};\r\n\r\nexport default function MerchantsPage() {\r\n    const { adminUser, adminLoading } = useAdminAuth();\r\n    const router = useRouter();\r\n    const [merchants, setMerchants] = useState<AdminUser[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!adminLoading) {\r\n            if (!adminUser) {\r\n                router.push('/admin/login');\r\n            } else {\r\n                fetchMerchants();\r\n            }\r\n        }\r\n        // Removed strict role check redirect here to allow debugging if role is slightly off\r\n    }, [adminUser, adminLoading]);\r\n\r\n\r\n    const fetchMerchants = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const data = await getMerchants();\r\n            setMerchants(data as any[]); // Cast to match AdminUser type if slight mismatch\r\n        } catch (error) {\r\n            console.error('Error fetching merchants:', error);\r\n            // Optional: set error state\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const updateStatus = async (id: string, newStatus: string) => {\r\n        try {\r\n            await updateMerchantStatus(id, newStatus);\r\n            // Optimistic update\r\n            setMerchants(merchants.map(m => m.id === id ? { ...m, status: newStatus as any } : m));\r\n        } catch (error) {\r\n            console.error('Error updating status:', error);\r\n            alert('Failed to update status');\r\n        }\r\n    };\r\n\r\n    if (loading || adminLoading) {\r\n        return <div className=\"p-8 text-center\">Loading...</div>;\r\n    }\r\n\r\n    if (adminUser?.role !== 'SUPERADMIN') return null;\r\n\r\n    return (\r\n        <div className=\"p-6 md:p-10\">\r\n            <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-6\">Merchant Management</h1>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl shadow-sm border border-slate-100 dark:border-slate-700 overflow-hidden\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full\">\r\n                        <thead className=\"bg-slate-50 dark:bg-slate-900/50 text-left\">\r\n                            <tr>\r\n                                <th className=\"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm\">Merchant</th>\r\n                                <th className=\"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm\">Role</th>\r\n                                <th className=\"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm\">Status</th>\r\n                                <th className=\"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm\">Joined</th>\r\n                                <th className=\"p-4 font-semibold text-slate-600 dark:text-slate-400 text-sm text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                            {merchants.map((merchant) => (\r\n                                <tr key={merchant.id} className=\"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                    <td className=\"p-4\">\r\n                                        <div>\r\n                                            <p className=\"font-medium text-slate-900 dark:text-white\">{merchant.shop_name || merchant.full_name || 'No Name'}</p>\r\n                                            <p className=\"text-sm text-slate-500\">{merchant.email}</p>\r\n                                            <p className=\"text-xs text-slate-400\">Owner: {merchant.full_name}</p>\r\n                                            {merchant.phone && <p className=\"text-xs text-slate-400\">{merchant.phone}</p>}\r\n                                        </div>\r\n                                    </td>\r\n                                    <td className=\"p-4\">\r\n                                        <span className={`text-xs font-bold px-2 py-1 rounded uppercase ${merchant.role === 'SUPERADMIN' ? 'bg-purple-100 text-purple-700' : 'bg-slate-100 text-slate-600'}`}>\r\n                                            {merchant.role}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"p-4\">\r\n                                        <span className={`\r\n                                            text-xs font-bold px-2 py-1 rounded uppercase\r\n                                            ${merchant.status === 'approved' ? 'bg-green-100 text-green-700' :\r\n                                                merchant.status === 'pending' ? 'bg-yellow-100 text-yellow-700' :\r\n                                                    'bg-red-100 text-red-700'}\r\n                                        `}>\r\n                                            {merchant.status}\r\n                                        </span>\r\n                                    </td>\r\n                                    <td className=\"p-4 text-sm text-slate-500\">\r\n                                        {new Date(merchant.created_at).toLocaleDateString()}\r\n                                    </td>\r\n                                    <td className=\"p-4 text-right\">\r\n                                        {merchant.role !== 'SUPERADMIN' && (\r\n                                            <div className=\"flex items-center justify-end gap-2\">\r\n                                                <Link\r\n                                                    href={`/admin/products?merchant_id=${merchant.id}`}\r\n                                                    className=\"px-3 py-1.5 bg-blue-100 dark:bg-blue-900/30 text-blue-700 dark:text-blue-400 text-xs font-bold rounded-lg hover:bg-blue-200 dark:hover:bg-blue-900/50 transition-colors flex items-center gap-1\"\r\n                                                >\r\n                                                    <span className=\"material-icons-round text-sm\">inventory_2</span>\r\n                                                    View Products\r\n                                                </Link>\r\n                                                {merchant.status === 'pending' && (\r\n                                                    <>\r\n                                                        <button\r\n                                                            onClick={() => updateStatus(merchant.id, 'approved')}\r\n                                                            className=\"px-3 py-1.5 bg-green-500 text-white text-xs font-bold rounded-lg hover:bg-green-600 transition-colors\"\r\n                                                        >\r\n                                                            Approve\r\n                                                        </button>\r\n                                                        <button\r\n                                                            onClick={() => updateStatus(merchant.id, 'rejected')}\r\n                                                            className=\"px-3 py-1.5 bg-red-500 text-white text-xs font-bold rounded-lg hover:bg-red-600 transition-colors\"\r\n                                                        >\r\n                                                            Reject\r\n                                                        </button>\r\n                                                    </>\r\n                                                )}\r\n                                                {merchant.status === 'approved' && (\r\n                                                    <button\r\n                                                        onClick={() => updateStatus(merchant.id, 'suspended')}\r\n                                                        className=\"px-3 py-1.5 bg-orange-500 text-white text-xs font-bold rounded-lg hover:bg-orange-600 transition-colors\"\r\n                                                    >\r\n                                                        Suspend\r\n                                                    </button>\r\n                                                )}\r\n                                                {(merchant.status === 'rejected' || merchant.status === 'suspended') && (\r\n                                                    <button\r\n                                                        onClick={() => updateStatus(merchant.id, 'approved')}\r\n                                                        className=\"px-3 py-1.5 bg-slate-500 text-white text-xs font-bold rounded-lg hover:bg-slate-600 transition-colors\"\r\n                                                    >\r\n                                                        Re-activate\r\n                                                    </button>\r\n                                                )}\r\n                                            </div>\r\n                                        )}\r\n                                    </td>\r\n                                </tr>\r\n                            ))}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\orders\\[id]\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useAuth' is defined but never used.","line":7,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useAuth"},"fix":{"range":[238,286],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchOrder'. Either include it or remove the dependency array.","line":18,"column":8,"nodeType":"ArrayExpression","endLine":18,"endColumn":12,"suggestions":[{"desc":"Update the dependencies array to be: [fetchOrder, id]","fix":{"range":[596,600],"text":"[fetchOrder, id]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":92,"column":45,"nodeType":"JSXOpeningElement","endLine":96,"endColumn":47}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useEffect, useState } from 'react';\r\nimport { useParams, useRouter } from 'next/navigation';\r\nimport { getAdminOrder, updateAdminOrderStatus } from '@/lib/adminApi';\r\nimport { formatPrice } from '@/lib/format';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport Link from 'next/link';\r\n\r\nexport default function AdminOrderDetailsPage() {\r\n    const { id } = useParams();\r\n    const router = useRouter();\r\n    const [order, setOrder] = useState<any>(null);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchOrder();\r\n    }, [id]);\r\n\r\n    const fetchOrder = async () => {\r\n        try {\r\n            const data = await getAdminOrder(id as string);\r\n            if (data) {\r\n                setOrder(data);\r\n            } else {\r\n                router.push('/admin/orders');\r\n            }\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleStatusUpdate = async (newStatus: string) => {\r\n        try {\r\n            await updateAdminOrderStatus(id as string, newStatus);\r\n            setOrder({ ...order, status: newStatus });\r\n        } catch (error) {\r\n            console.error('Failed to update status', error);\r\n            alert('Failed to update status');\r\n        }\r\n    };\r\n\r\n    if (loading || !order) {\r\n        return (\r\n            <div className=\"min-h-screen flex items-center justify-center\">\r\n                <div className=\"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary\"></div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"max-w-4xl mx-auto space-y-8\">\r\n            {/* Header */}\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <Link href=\"/admin/orders\" className=\"inline-flex items-center gap-2 text-sm font-medium text-text-muted hover:text-primary transition-colors mb-2\">\r\n                        <span className=\"material-symbols-outlined text-lg\">arrow_back</span>\r\n                        Back to Orders\r\n                    </Link>\r\n                    <h1 className=\"text-3xl font-bold text-text-main\">Order #{order.id.slice(0, 8)}</h1>\r\n                    <p className=\"text-text-muted\">\r\n                        Placed on {new Date(order.created_at).toLocaleDateString()} at {new Date(order.created_at).toLocaleTimeString()}\r\n                    </p>\r\n                </div>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <select\r\n                        value={order.status}\r\n                        onChange={(e) => handleStatusUpdate(e.target.value)}\r\n                        className=\"text-sm font-bold border border-border-subtle rounded-lg px-4 py-2 bg-white text-text-main focus:ring-primary focus:border-primary cursor-pointer\"\r\n                    >\r\n                        <option value=\"pending\">Pending</option>\r\n                        <option value=\"processing\">Processing</option>\r\n                        <option value=\"delivered\">Delivered</option>\r\n                        <option value=\"cancelled\">Cancelled</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid md:grid-cols-3 gap-8\">\r\n                {/* Main Info */}\r\n                <div className=\"md:col-span-2 space-y-6\">\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm overflow-hidden p-6\">\r\n                        <h2 className=\"text-lg font-bold text-text-main mb-4\">Order Items</h2>\r\n                        <div className=\"space-y-4\">\r\n                            {order.items?.map((item: any) => (\r\n                                <div key={item.id} className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-16 h-16 bg-slate-50 dark:bg-slate-700 rounded-lg overflow-hidden shrink-0 relative\">\r\n                                        {/* Prioritize current product image (index 0), then snapshot image */}\r\n                                        {(item.products?.images && item.products.images.length > 0) || item.image ? (\r\n                                            <img\r\n                                                src={item.products?.images?.[0] || item.image}\r\n                                                alt={item.name}\r\n                                                className=\"w-full h-full object-cover\"\r\n                                            />\r\n                                        ) : (\r\n                                            <div className=\"w-full h-full flex items-center justify-center text-slate-300\">\r\n                                                <span className=\"material-symbols-outlined\">image</span>\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n                                    <div className=\"flex-1\">\r\n                                        <h3 className=\"font-bold text-text-main line-clamp-1\">{item.name}</h3>\r\n                                        <div className=\"flex flex-col gap-1 mt-1\">\r\n                                            <p className=\"text-sm text-text-muted\">Qty: {item.quantity} ├ù {formatPrice(item.price)}</p>\r\n                                            <div className=\"flex gap-3 text-xs\">\r\n                                                {item.size && (\r\n                                                    <span className=\"font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded\">\r\n                                                        Size: {item.size}\r\n                                                    </span>\r\n                                                )}\r\n                                                {item.color && (\r\n                                                    <span className=\"font-medium text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 px-2 py-0.5 rounded\">\r\n                                                        Color: {item.color}\r\n                                                    </span>\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"text-right font-bold text-text-main\">\r\n                                        {formatPrice(item.price * item.quantity)}\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                        <div className=\"border-t border-border-subtle mt-6 pt-4 space-y-2\">\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-text-muted\">Subtotal</span>\r\n                                <span className=\"font-bold text-text-main\">{formatPrice(order.total_amount / 1.05)}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-sm\">\r\n                                <span className=\"text-text-muted\">Tax</span>\r\n                                <span className=\"font-bold text-text-main\">{formatPrice(order.total_amount - (order.total_amount / 1.05))}</span>\r\n                            </div>\r\n                            <div className=\"flex justify-between text-lg font-bold pt-2\">\r\n                                <span className=\"text-text-main\">Total</span>\r\n                                <span className=\"text-primary\">{formatPrice(order.total_amount)}</span>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Customer Info */}\r\n                <div className=\"space-y-6\">\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm p-6\">\r\n                        <h3 className=\"text-lg font-bold text-text-main mb-4\">Customer Details</h3>\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"text-xs text-text-muted uppercase font-bold\">Name</label>\r\n                                <p className=\"text-sm font-medium text-text-main\">{order.customer?.name || order.shipping_name}</p>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs text-text-muted uppercase font-bold\">Phone</label>\r\n                                <p className=\"text-sm font-medium text-text-main flex items-center gap-2\">\r\n                                    <span className=\"material-symbols-outlined text-base text-text-muted\">phone</span>\r\n                                    {order.customer?.phone || order.shipping_phone}\r\n                                </p>\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"text-xs text-text-muted uppercase font-bold\">Address</label>\r\n                                <p className=\"text-sm font-medium text-text-main\">{order.shipping_address}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-border-subtle shadow-sm p-6\">\r\n                        <h3 className=\"text-lg font-bold text-text-main mb-4\">Payment</h3>\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"text-xs text-text-muted uppercase font-bold\">Method</label>\r\n                                <p className=\"text-sm font-medium text-text-main uppercase\">{order.payment_method}</p>\r\n                            </div>\r\n\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\orders\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\orders\\page.tsx:50:9\n  48 |\n  49 |     useEffect(() => {\n> 50 |         loadData();\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  51 |     }, [filters]);\n  52 |\n  53 |     const handleStatusChange = async (orderId: number, newStatus: string) => {","line":50,"column":9,"nodeType":null,"endLine":50,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":51,"column":8,"nodeType":"ArrayExpression","endLine":51,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [filters, loadData]","fix":{"range":[1826,1835],"text":"[filters, loadData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":297,"column":49,"nodeType":"JSXOpeningElement","endLine":297,"endColumn":144}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n    getAllOrders,\r\n    updateOrderStatus,\r\n    getOrderStatistics,\r\n    type AdminOrder,\r\n    type OrderFilters\r\n} from '@/actions/orders';\r\nimport { formatPrice } from '@/lib/format';\r\nimport { createClient } from '@/lib/supabase/client';\r\n\r\nconst ORDER_STATUSES = ['PENDING', 'PROCESSING', 'SHIPPED', 'DELIVERED', 'CANCELLED'];\r\n\r\nconst STATUS_COLORS: Record<string, string> = {\r\n    PENDING: 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400',\r\n    PROCESSING: 'bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400',\r\n    SHIPPED: 'bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400',\r\n    DELIVERED: 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400',\r\n    CANCELLED: 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400'\r\n};\r\n\r\nexport default function OrdersPage() {\r\n    const [orders, setOrders] = useState<AdminOrder[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [stats, setStats] = useState({\r\n        totalOrders: 0,\r\n        pendingOrders: 0,\r\n        processingOrders: 0,\r\n        deliveredOrders: 0,\r\n        totalRevenue: 0\r\n    });\r\n    const [filters, setFilters] = useState<OrderFilters>({ status: 'all' });\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n    const [selectedOrder, setSelectedOrder] = useState<AdminOrder | null>(null);\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        const [ordersData, statsData] = await Promise.all([\r\n            getAllOrders({ ...filters, searchTerm }),\r\n            getOrderStatistics()\r\n        ]);\r\n        setOrders(ordersData);\r\n        setStats(statsData);\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [filters]);\r\n\r\n    const handleStatusChange = async (orderId: number, newStatus: string) => {\r\n        const result = await updateOrderStatus(orderId, newStatus);\r\n        if (result.success) {\r\n            loadData();\r\n        } else {\r\n            alert(result.error);\r\n        }\r\n    };\r\n\r\n    const handleSearch = () => {\r\n        setFilters({ ...filters, searchTerm });\r\n    };\r\n\r\n    // Set up Realtime subscription for orders\r\n    useEffect(() => {\r\n        const supabase = createClient();\r\n\r\n        const channel = supabase\r\n            .channel('orders-page-realtime')\r\n            .on('postgres_changes',\r\n                { event: 'INSERT', schema: 'public', table: 'orders' },\r\n                (payload: any) => {\r\n                    console.log('Orders Page: New order received', payload.new);\r\n                    // Prepend new order to the list\r\n                    setOrders(prev => [payload.new, ...prev]);\r\n                    // Update stats\r\n                    setStats(prev => ({\r\n                        ...prev,\r\n                        totalOrders: prev.totalOrders + 1,\r\n                        pendingOrders: prev.pendingOrders + (payload.new.status?.toLowerCase() === 'pending' ? 1 : 0)\r\n                    }));\r\n                }\r\n            )\r\n            .on('postgres_changes',\r\n                { event: 'UPDATE', schema: 'public', table: 'orders' },\r\n                (payload: any) => {\r\n                    console.log('Orders Page: Order updated', payload.new);\r\n                    // Update order in the list\r\n                    setOrders(prev => prev.map(order =>\r\n                        order.id === payload.new.id ? payload.new : order\r\n                    ));\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, []);\r\n\r\n    return (\r\n        <div className=\"p-8\">\r\n            <h1 className=\"text-3xl font-bold mb-8\">Orders Management</h1>\r\n\r\n            {/* Statistics Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-5 gap-6 mb-8\">\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Total Orders</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.totalOrders}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-blue-500\">shopping_bag</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Pending</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.pendingOrders}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-yellow-500\">schedule</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Processing</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.processingOrders}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-blue-500\">sync</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Delivered</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.deliveredOrders}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-green-500\">check_circle</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Revenue</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{formatPrice(stats.totalRevenue)}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-green-500\">payments</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 mb-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">Search</label>\r\n                        <div className=\"flex gap-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\r\n                                placeholder=\"Order ID, customer name, phone...\"\r\n                                className=\"flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700\"\r\n                            />\r\n                            <button\r\n                                onClick={handleSearch}\r\n                                className=\"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90\"\r\n                            >\r\n                                Search\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">Status</label>\r\n                        <select\r\n                            value={filters.status || 'all'}\r\n                            onChange={(e) => setFilters({ ...filters, status: e.target.value })}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700\"\r\n                        >\r\n                            <option value=\"all\">All Statuses</option>\r\n                            {ORDER_STATUSES.map(status => (\r\n                                <option key={status} value={status}>{status}</option>\r\n                            ))}\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">&nbsp;</label>\r\n                        <button\r\n                            onClick={() => {\r\n                                setFilters({ status: 'all' });\r\n                                setSearchTerm('');\r\n                            }}\r\n                            className=\"w-full px-4 py-2 bg-slate-200 dark:bg-slate-700 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600\"\r\n                        >\r\n                            Clear Filters\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Orders List */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                        <div className=\"inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n                    </div>\r\n                ) : orders.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-slate-500\">\r\n                        No orders found\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-slate-200 dark:divide-slate-700\">\r\n                        {orders.map((order) => (\r\n                            <div key={order.id} className=\"p-4 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors flex items-center justify-between gap-4 group cursor-pointer\" onClick={() => setSelectedOrder(order)}>\r\n                                <div className=\"flex items-center gap-4 flex-1\">\r\n                                    <div className=\"min-w-[80px]\">\r\n                                        <h3 className=\"font-bold text-slate-900 dark:text-white\">#{String(order.id).padStart(6, '0')}</h3>\r\n                                        <p className=\"text-xs text-slate-500\">{new Date(order.created_at).toLocaleDateString()}</p>\r\n                                    </div>\r\n\r\n                                    <div className=\"flex-1\">\r\n                                        <p className=\"font-medium text-slate-900 dark:text-white truncate\">{order.shipping_name}</p>\r\n                                        <p className=\"text-xs text-slate-500\">{order.order_items?.length || 0} items ΓÇó {order.payment_method}</p>\r\n                                    </div>\r\n\r\n                                    <div className=\"text-right px-4\">\r\n                                        <p className=\"font-bold text-primary\">{formatPrice(order.total_amount)}</p>\r\n                                    </div>\r\n                                </div>\r\n\r\n                                <div className=\"flex items-center gap-3\">\r\n                                    <select\r\n                                        value={order.status?.toUpperCase()}\r\n                                        onClick={(e) => e.stopPropagation()}\r\n                                        onChange={(e) => {\r\n                                            e.stopPropagation();\r\n                                            handleStatusChange(order.id, e.target.value);\r\n                                        }}\r\n                                        className={`px-2.5 py-1 rounded-full text-xs font-bold border-none outline-none cursor-pointer appearance-none text-center min-w-[100px] ${STATUS_COLORS[order.status?.toUpperCase()] || 'bg-slate-100 text-slate-600'}`}\r\n                                    >\r\n                                        {ORDER_STATUSES.map(status => (\r\n                                            <option key={status} value={status} className=\"bg-white text-slate-900\">{status}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                    <button\r\n                                        onClick={(e) => {\r\n                                            e.stopPropagation();\r\n                                            setSelectedOrder(order);\r\n                                        }}\r\n                                        className=\"p-2 text-slate-400 hover:text-primary transition-colors\"\r\n                                    >\r\n                                        <span className=\"material-icons-round\">visibility</span>\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Order Details Modal */}\r\n            {selectedOrder && (\r\n                <div className=\"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4\" onClick={() => setSelectedOrder(null)}>\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-6\" onClick={(e) => e.stopPropagation()}>\r\n                        <div className=\"flex items-center justify-between mb-6\">\r\n                            <h2 className=\"text-2xl font-bold\">Order #{selectedOrder.id}</h2>\r\n                            <button onClick={() => setSelectedOrder(null)} className=\"p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg\">\r\n                                <span className=\"material-icons-round\">close</span>\r\n                            </button>\r\n                        </div>\r\n\r\n                        <div className=\"space-y-4\">\r\n                            <div>\r\n                                <h3 className=\"font-bold mb-2\">Customer Information</h3>\r\n                                <p>{selectedOrder.shipping_name}</p>\r\n                                <p className=\"text-sm text-slate-500\">{selectedOrder.shipping_phone}</p>\r\n                                <p className=\"text-sm text-slate-500\">{selectedOrder.shipping_address}</p>\r\n                            </div>\r\n\r\n                            <div>\r\n                                <h3 className=\"font-bold mb-2\">Order Items</h3>\r\n                                <div className=\"space-y-2 max-h-[300px] overflow-y-auto pr-2\">\r\n                                    {selectedOrder.order_items?.map((item, idx) => (\r\n                                        <div key={idx} className=\"flex gap-3 p-3 bg-slate-50 dark:bg-slate-700 rounded-lg border border-slate-100 dark:border-slate-600\">\r\n                                            {item.image ? (\r\n                                                <img src={item.image} alt={item.name} className=\"w-16 h-16 rounded-lg object-cover bg-white\" />\r\n                                            ) : (\r\n                                                <div className=\"w-16 h-16 rounded-lg bg-slate-200 flex items-center justify-center\">\r\n                                                    <span className=\"material-icons-round text-slate-400\">image</span>\r\n                                                </div>\r\n                                            )}\r\n                                            <div className=\"flex-1\">\r\n                                                <p className=\"font-medium text-slate-900 dark:text-white\">{item.name}</p>\r\n                                                <p className=\"text-sm text-slate-500\">\r\n                                                    {item.size && <span className=\"mr-2\">Size: {item.size}</span>}\r\n                                                    {item.color && <span>Color: {item.color}</span>}\r\n                                                </p>\r\n                                                <div className=\"flex justify-between mt-1\">\r\n                                                    <p className=\"text-sm text-slate-500\">{item.quantity} ├ù {formatPrice(item.price)}</p>\r\n                                                    <p className=\"font-bold text-slate-900 dark:text-white\">{formatPrice(item.price * item.quantity)}</p>\r\n                                                </div>\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"p-4 bg-slate-50 dark:bg-slate-700/50 rounded-xl space-y-3\">\r\n                                <div className=\"flex items-center justify-between\">\r\n                                    <span className=\"font-medium\">Update Status</span>\r\n                                    <select\r\n                                        value={selectedOrder.status}\r\n                                        onChange={(e) => {\r\n                                            const newStatus = e.target.value;\r\n                                            setSelectedOrder({ ...selectedOrder, status: newStatus }); // Optimistic update in modal\r\n                                            handleStatusChange(selectedOrder.id, newStatus);\r\n                                        }}\r\n                                        className=\"px-3 py-1.5 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-800 text-sm font-bold\"\r\n                                    >\r\n                                        {ORDER_STATUSES.map(status => (\r\n                                            <option key={status} value={status}>{status}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            </div>\r\n\r\n                            <div className=\"pt-4 border-t\">\r\n                                <div className=\"flex justify-between text-lg font-bold\">\r\n                                    <span>Total</span>\r\n                                    <span className=\"text-primary\">{formatPrice(selectedOrder.total_amount)}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateAdminOrderStatus' is defined but never used.","line":6,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"updateAdminOrderStatus"},"fix":{"range":[120,149],"text":""},"desc":"Remove unused variable \"updateAdminOrderStatus\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getLowStockProducts' is defined but never used.","line":7,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":24,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getLowStockProducts"},"fix":{"range":[149,175],"text":""},"desc":"Remove unused variable \"getLowStockProducts\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getTotalMerchantsCount' is defined but never used.","line":11,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getTotalMerchantsCount"},"fix":{"range":[251,280],"text":""},"desc":"Remove unused variable \"getTotalMerchantsCount\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'getMerchantStats' is defined but never used.","line":12,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":12,"endColumn":21,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"getMerchantStats"},"fix":{"range":[280,303],"text":""},"desc":"Remove unused variable \"getMerchantStats\"."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":39,"column":8,"nodeType":"ArrayExpression","endLine":39,"endColumn":33,"suggestions":[{"desc":"Update the dependencies array to be: [adminUser, adminLoading, fetchData]","fix":{"range":[1365,1390],"text":"[adminUser, adminLoading, fetchData]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState, useEffect } from 'react';\r\nimport Link from 'next/link';\r\nimport {\r\n    getAdminOrders,\r\n    updateAdminOrderStatus,\r\n    getLowStockProducts,\r\n    getSalesAnalytics,\r\n    getCategoryStats,\r\n    getBestSellingProducts,\r\n    getTotalMerchantsCount,\r\n    getMerchantStats\r\n} from '@/lib/adminApi';\r\nimport { formatPrice } from '@/lib/format';\r\nimport { AreaChart, Area, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, BarChart, Bar } from 'recharts';\r\nimport { useAdminAuth } from '@/context/AdminAuthContext';\r\nimport { createClient } from '@/lib/supabase/client';\r\n\r\nexport default function AdminDashboard() {\r\n    const { adminUser, adminLoading } = useAdminAuth();\r\n\r\n    // Super Admin State\r\n    const [orders, setOrders] = useState<any[]>([]);\r\n    const [salesData, setSalesData] = useState<any[]>([]);\r\n    const [categoryStats, setCategoryStats] = useState<any[]>([]);\r\n    const [topProducts, setTopProducts] = useState<any[]>([]);\r\n    const [lowStockCount, setLowStockCount] = useState(0);\r\n    const [merchantCount, setMerchantCount] = useState(0);\r\n\r\n    // Merchant State\r\n    const [merchantStats, setMerchantStats] = useState<any>(null);\r\n\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        if (!adminLoading && adminUser) {\r\n            fetchData();\r\n        }\r\n    }, [adminUser, adminLoading]);\r\n\r\n    const fetchData = async () => {\r\n        setLoading(true);\r\n        try {\r\n            if (adminUser?.role === 'MERCHANT') {\r\n                // Fetch from secure API\r\n                const res = await fetch(`/api/admin/dashboard-stats?role=merchant&userId=${adminUser.id}`);\r\n                const stats = await res.json();\r\n                if (res.ok) {\r\n                    setMerchantStats(stats);\r\n                } else {\r\n                    console.error('Failed to fetch merchant stats:', stats.error);\r\n                }\r\n            } else {\r\n                // Super Admin\r\n                // 1. Fetch secure stats (Merchant Count, etc)\r\n                const secureRes = await fetch('/api/admin/dashboard-stats?role=admin');\r\n                const secureData = await secureRes.json();\r\n\r\n                if (secureRes.ok) {\r\n                    setMerchantCount(secureData.merchantCount || 0);\r\n                    setLowStockCount(secureData.lowStockCount || 0);\r\n                }\r\n\r\n                // 2. Fetch standard stats (Orders, Products)\r\n                const [ordersData, analyticsData, catStats, topProdData] = await Promise.all([\r\n                    getAdminOrders(),\r\n                    getSalesAnalytics(),\r\n                    getCategoryStats(),\r\n                    getBestSellingProducts(10)\r\n                ]);\r\n\r\n                setOrders(ordersData);\r\n                // setLowStockCount is handled by secure API\r\n                setSalesData(analyticsData);\r\n                setCategoryStats(catStats);\r\n                setTopProducts(topProdData);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to fetch dashboard data', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Set up Realtime subscription for orders (Super Admin only)\r\n    useEffect(() => {\r\n        if (adminUser?.role !== 'SUPERADMIN') return;\r\n\r\n        const supabase = createClient();\r\n\r\n        const channel = supabase\r\n            .channel('dashboard-orders-realtime')\r\n            .on('postgres_changes',\r\n                { event: 'INSERT', schema: 'public', table: 'orders' },\r\n                (payload: any) => {\r\n                    console.log('Dashboard: New order received', payload.new);\r\n                    // Prepend new order to the list\r\n                    setOrders(prev => [payload.new, ...prev]);\r\n                }\r\n            )\r\n            .on('postgres_changes',\r\n                { event: 'UPDATE', schema: 'public', table: 'orders' },\r\n                (payload: any) => {\r\n                    console.log('Dashboard: Order updated', payload.new);\r\n                    // Update order in the list\r\n                    setOrders(prev => prev.map(order =>\r\n                        order.id === payload.new.id ? payload.new : order\r\n                    ));\r\n                }\r\n            )\r\n            .subscribe();\r\n\r\n        return () => {\r\n            supabase.removeChannel(channel);\r\n        };\r\n    }, [adminUser]);\r\n\r\n    if (adminLoading || loading) {\r\n        return <div className=\"p-8 text-center\">Loading Dashboard...</div>;\r\n    }\r\n\r\n    if (adminUser?.role === 'MERCHANT') {\r\n        const { totalEarnings, totalOrders, totalProducts, recentOrders, products, totalReviews, salesChartData } = merchantStats || {};\r\n\r\n        return (\r\n            <div className=\"space-y-8\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Merchant Dashboard</h1>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <span className=\"flex h-3 w-3 rounded-full bg-green-500\"></span>\r\n                        <span className=\"text-sm font-medium text-slate-600 dark:text-slate-400\">Shop Open</span>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* KPI Cards */}\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"p-3 bg-green-50 dark:bg-green-900/20 rounded-xl text-green-600 dark:text-green-400\">\r\n                                <span className=\"material-symbols-outlined\">payments</span>\r\n                            </div>\r\n                            <span className=\"text-xs font-bold text-green-700 bg-green-100 dark:bg-green-900/40 px-2 py-1 rounded-lg\">+18.2%</span>\r\n                        </div>\r\n                        <p className=\"text-slate-500 dark:text-slate-400 text-sm font-medium\">Total Earnings</p>\r\n                        <p className=\"text-3xl font-bold text-slate-900 dark:text-white mt-1\">{formatPrice(totalEarnings || 0)}</p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-xl text-blue-600 dark:text-blue-400\">\r\n                                <span className=\"material-symbols-outlined\">check_circle</span>\r\n                            </div>\r\n                            <span className=\"text-xs font-bold text-blue-700 bg-blue-100 dark:bg-blue-900/40 px-2 py-1 rounded-lg\">+4.3%</span>\r\n                        </div>\r\n                        <p className=\"text-slate-500 dark:text-slate-400 text-sm font-medium\">Successful Orders</p>\r\n                        <p className=\"text-3xl font-bold text-slate-900 dark:text-white mt-1\">{totalOrders || 0}</p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-xl text-purple-600 dark:text-purple-400\">\r\n                                <span className=\"material-symbols-outlined\">inventory_2</span>\r\n                            </div>\r\n                            <span className=\"text-xs font-bold text-purple-700 bg-purple-100 dark:bg-purple-900/40 px-2 py-1 rounded-lg\">New: {products?.filter((p: any) => !p.is_approved).length || 0}</span>\r\n                        </div>\r\n                        <p className=\"text-slate-500 dark:text-slate-400 text-sm font-medium\">Total Products</p>\r\n                        <p className=\"text-3xl font-bold text-slate-900 dark:text-white mt-1\">{totalProducts || 0}</p>\r\n                    </div>\r\n\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm\">\r\n                        <div className=\"flex justify-between items-start mb-4\">\r\n                            <div className=\"p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-xl text-yellow-600 dark:text-yellow-400\">\r\n                                <span className=\"material-symbols-outlined\">star</span>\r\n                            </div>\r\n                            <span className=\"text-xs font-bold text-yellow-700 bg-yellow-100 dark:bg-yellow-900/40 px-2 py-1 rounded-lg\">Dynamic</span>\r\n                        </div>\r\n                        <p className=\"text-slate-500 dark:text-slate-400 text-sm font-medium\">Total Reviews</p>\r\n                        <p className=\"text-3xl font-bold text-slate-900 dark:text-white mt-1\">{totalReviews || 0}</p>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                    {/* Revenue Growth Chart (Mock for now, reused container) */}\r\n                    <div className=\"lg:col-span-2 bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 p-6 shadow-sm\">\r\n                        <div className=\"flex items-center justify-between mb-8\">\r\n                            <div>\r\n                                <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">Revenue Growth</h3>\r\n                                <p className=\"text-sm text-slate-500\">Weekly earnings performance</p>\r\n                            </div>\r\n                        </div>\r\n                        <div className=\"h-72 w-full mt-4\">\r\n                            {salesChartData && salesChartData.length > 0 ? (\r\n                                <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                    <AreaChart data={salesChartData}>\r\n                                        <defs>\r\n                                            <linearGradient id=\"colorMerchantSales\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                                <stop offset=\"5%\" stopColor=\"#22C55E\" stopOpacity={0.2} />\r\n                                                <stop offset=\"95%\" stopColor=\"#22C55E\" stopOpacity={0} />\r\n                                            </linearGradient>\r\n                                        </defs>\r\n                                        <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e5e7eb\" />\r\n                                        <XAxis\r\n                                            dataKey=\"name\"\r\n                                            tick={{ fontSize: 10, fill: '#64748B' }}\r\n                                            tickLine={false}\r\n                                            axisLine={false}\r\n                                            interval=\"preserveStartEnd\"\r\n                                        />\r\n                                        <YAxis\r\n                                            tick={{ fontSize: 10, fill: '#64748B' }}\r\n                                            tickLine={false}\r\n                                            axisLine={false}\r\n                                            tickFormatter={(value) => formatPrice(value)}\r\n                                        />\r\n                                        <Tooltip\r\n                                            contentStyle={{ borderRadius: '12px', borderColor: '#e5e7eb', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\r\n                                            formatter={(value: any) => [formatPrice(value), 'Earnings']}\r\n                                        />\r\n                                        <Area\r\n                                            type=\"monotone\"\r\n                                            dataKey=\"sales\"\r\n                                            stroke=\"#22C55E\"\r\n                                            strokeWidth={3}\r\n                                            fillOpacity={1}\r\n                                            fill=\"url(#colorMerchantSales)\"\r\n                                        />\r\n                                    </AreaChart>\r\n                                </ResponsiveContainer>\r\n                            ) : (\r\n                                <div className=\"h-full flex items-center justify-center text-slate-400 text-sm\">\r\n                                    No sales data available for chart.\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Top Selling Items */}\r\n                    <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 p-6 shadow-sm\">\r\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white mb-6\">Top Selling Items</h3>\r\n                        <div className=\"space-y-6\">\r\n                            {(products || []).slice(0, 3).map((product: any) => (\r\n                                <div key={product.id} className=\"flex items-center gap-4\">\r\n                                    <div className=\"w-12 h-12 bg-slate-100 dark:bg-slate-700 rounded-xl flex items-center justify-center shrink-0\">\r\n                                        {/* If image exists show it, else icon */}\r\n                                        <span className=\"material-symbols-outlined text-slate-400\">shopping_bag</span>\r\n                                    </div>\r\n                                    <div>\r\n                                        <p className=\"font-bold text-slate-900 dark:text-white text-sm line-clamp-1\">{product.name}</p>\r\n                                        <p className=\"text-xs text-slate-500\">{product.sold_count || 0} Sales this month</p>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                            {(!products || products.length === 0) && <p className=\"text-sm text-slate-500\">No products yet.</p>}\r\n                        </div>\r\n                        <Link href=\"/admin/products\" className=\"block w-full mt-8 py-3 text-center border border-green-500 text-green-500 font-bold text-sm rounded-xl hover:bg-green-50 transition-colors uppercase tracking-wide\">\r\n                            Manage All Products\r\n                        </Link>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Recent Item Orders */}\r\n                <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm overflow-hidden\">\r\n                    <div className=\"p-6 border-b border-slate-100 dark:border-slate-700 flex items-center justify-between\">\r\n                        <h3 className=\"text-lg font-bold text-slate-900 dark:text-white\">Recent Item Orders</h3>\r\n                        <Link href=\"/admin/orders\" className=\"text-green-500 font-bold text-sm hover:underline\">View All My Sales</Link>\r\n                    </div>\r\n                    <div className=\"overflow-x-auto\">\r\n                        <table className=\"w-full text-left\">\r\n                            <thead className=\"bg-slate-50 dark:bg-slate-900/50 text-slate-500 text-[11px] uppercase tracking-wider font-bold\">\r\n                                <tr>\r\n                                    <th className=\"px-6 py-4\">Order ID</th>\r\n                                    <th className=\"px-6 py-4\">Product</th>\r\n                                    <th className=\"px-6 py-4\">Date</th>\r\n                                    <th className=\"px-6 py-4\">Price</th>\r\n                                    <th className=\"px-6 py-4\">Status</th>\r\n                                    <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                                </tr>\r\n                            </thead>\r\n                            <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                                {(recentOrders || []).map((order: any) => (\r\n                                    <tr key={order.id + order.product_name} className=\"hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-slate-900 dark:text-white\">#{String(order.id).padStart(8, '0')}</td>\r\n                                        <td className=\"px-6 py-4 text-sm text-slate-600 dark:text-slate-300\">\r\n                                            <div className=\"flex items-center gap-3\">\r\n                                                <span className=\"material-symbols-outlined text-slate-400 text-lg\">inventory_2</span>\r\n                                                <span className=\"line-clamp-1\">{order.product_name}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm text-green-600 dark:text-green-400 font-medium\">{new Date(order.date).toLocaleDateString()}</td>\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-slate-900 dark:text-white\">{formatPrice(order.price)}</td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <span className={`inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700`}>\r\n                                                <span className=\"w-1.5 h-1.5 rounded-full bg-green-600\"></span> {order.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            <button className=\"text-slate-400 hover:text-green-500 transition-colors\">\r\n                                                <span className=\"material-symbols-outlined\">more_horiz</span>\r\n                                            </button>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))}\r\n                                {(!recentOrders || recentOrders.length === 0) && (\r\n                                    <tr><td colSpan={6} className=\"px-6 py-8 text-center text-slate-500\">No orders yet.</td></tr>\r\n                                )}\r\n                            </tbody>\r\n                        </table>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // --- SUPER ADMIN DASHBOARD (Existing) ---\r\n\r\n    // Calculate Stats\r\n    const totalSales = orders.reduce((sum, order) => sum + (order.status?.toUpperCase() === 'DELIVERED' ? Number(order.total_amount) : 0), 0);\r\n    const processingOrders = orders.filter(o => o.status?.toUpperCase() === 'PROCESSING').length;\r\n    const pendingOrders = orders.filter(o => o.status?.toUpperCase() === 'PENDING').length;\r\n    const deliveredOrders = orders.filter(o => o.status?.toUpperCase() === 'DELIVERED').length;\r\n\r\n    const getStatusColor = (status: string) => {\r\n        switch (status.toLowerCase()) {\r\n            case 'pending': return 'text-yellow-700 bg-yellow-100';\r\n            case 'processing': return 'text-blue-700 bg-blue-100';\r\n            case 'delivered': return 'text-green-700 bg-green-100';\r\n            case 'cancelled': return 'text-red-700 bg-red-100';\r\n            default: return 'text-gray-700 bg-gray-100';\r\n        }\r\n    };\r\n\r\n    const getStatusDot = (status: string) => {\r\n        switch (status.toLowerCase()) {\r\n            case 'pending': return 'bg-yellow-600';\r\n            case 'processing': return 'bg-blue-600';\r\n            case 'delivered': return 'bg-green-600';\r\n            case 'cancelled': return 'bg-red-600';\r\n            default: return 'bg-gray-600';\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-8\">\r\n            {/* Stats Row */}\r\n            <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4\">\r\n                <div className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 transition-all hover:shadow-md\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-primary/10 rounded-lg text-primary\">\r\n                            <span className=\"material-symbols-outlined\">payments</span>\r\n                        </div>\r\n                        <span className=\"text-xs font-bold text-green-700 bg-green-50 px-2 py-1 rounded-full\">+12.5%</span>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Total Sales</p>\r\n                    <p className=\"text-2xl font-bold text-text-main\">{formatPrice(totalSales)}</p>\r\n                </div>\r\n\r\n                {/* Active (Processing) Orders */}\r\n                <div className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 transition-all hover:shadow-md\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-blue-500/10 rounded-lg text-blue-500\">\r\n                            <span className=\"material-symbols-outlined\">sync</span>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Active (Processing)</p>\r\n                    <p className=\"text-2xl font-bold text-text-main\">{processingOrders}</p>\r\n                </div>\r\n\r\n                {/* Pending Orders */}\r\n                <div className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 transition-all hover:shadow-md\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-yellow-500/10 rounded-lg text-yellow-500\">\r\n                            <span className=\"material-symbols-outlined\">hourglass_empty</span>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Pending Orders</p>\r\n                    <p className=\"text-2xl font-bold text-text-main\">{pendingOrders}</p>\r\n                </div>\r\n\r\n                {/* Completed (Delivered) Orders */}\r\n                <div className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 transition-all hover:shadow-md\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-green-500/10 rounded-lg text-green-500\">\r\n                            <span className=\"material-symbols-outlined\">check_circle</span>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Order Completed</p>\r\n                    <p className=\"text-2xl font-bold text-text-main\">{deliveredOrders}</p>\r\n                </div>\r\n\r\n                {/* Low Stock Alerts */}\r\n                <Link href=\"/admin/low-stock\" className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 ring-1 ring-red-100 transition-all hover:shadow-md hover:ring-red-200 cursor-pointer block\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-red-500/10 rounded-lg text-red-500\">\r\n                            <span className=\"material-symbols-outlined\">warning</span>\r\n                        </div>\r\n                        <span className=\"text-xs font-bold text-red-600 bg-red-50 px-2 py-1 rounded-full\">Critical</span>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Low Stock Alerts</p>\r\n                    <p className=\"text-2xl font-bold text-red-600\">{lowStockCount} Items</p>\r\n                </Link>\r\n\r\n                {/* Total Merchants */}\r\n                <div className=\"bg-white dark:bg-background-dark p-4 rounded-2xl border border-border-subtle shadow-sm flex flex-col gap-1 transition-all hover:shadow-md\">\r\n                    <div className=\"flex justify-between items-start mb-2\">\r\n                        <div className=\"p-2 bg-purple-500/10 rounded-lg text-purple-500\">\r\n                            <span className=\"material-symbols-outlined\">store</span>\r\n                        </div>\r\n                    </div>\r\n                    <p className=\"text-text-muted text-sm font-medium\">Total Merchants</p>\r\n                    <p className=\"text-2xl font-bold text-text-main\">{merchantCount}</p>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Charts Section */}\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\r\n                <div className=\"lg:col-span-2 bg-white dark:bg-background-dark rounded-2xl border border-border-subtle p-6 shadow-sm\">\r\n                    <div className=\"flex items-center justify-between mb-8\">\r\n                        <div>\r\n                            <h3 className=\"text-lg font-bold text-text-main\">Sales Overview</h3>\r\n                            <p className=\"text-sm text-text-muted\">Last 30 days performance</p>\r\n                        </div>\r\n                    </div>\r\n                    <div className=\"h-72 w-full\">\r\n                        <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                            <AreaChart data={salesData}>\r\n                                <defs>\r\n                                    <linearGradient id=\"colorSales\" x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\r\n                                        <stop offset=\"5%\" stopColor=\"#22C55E\" stopOpacity={0.2} />\r\n                                        <stop offset=\"95%\" stopColor=\"#22C55E\" stopOpacity={0} />\r\n                                    </linearGradient>\r\n                                </defs>\r\n                                <CartesianGrid strokeDasharray=\"3 3\" vertical={false} stroke=\"#e5e7eb\" />\r\n                                <XAxis\r\n                                    dataKey=\"name\"\r\n                                    tick={{ fontSize: 10, fill: '#64748B' }}\r\n                                    tickLine={false}\r\n                                    axisLine={false}\r\n                                    interval=\"preserveStartEnd\"\r\n                                />\r\n                                <YAxis\r\n                                    tick={{ fontSize: 10, fill: '#64748B' }}\r\n                                    tickLine={false}\r\n                                    axisLine={false}\r\n                                    tickFormatter={(value) => formatPrice(value)}\r\n                                />\r\n                                <Tooltip\r\n                                    contentStyle={{ borderRadius: '12px', borderColor: '#e5e7eb', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\r\n                                    formatter={(value: any) => [formatPrice(value), 'Sales']}\r\n                                />\r\n                                <Area\r\n                                    type=\"monotone\"\r\n                                    dataKey=\"sales\"\r\n                                    stroke=\"#22C55E\"\r\n                                    strokeWidth={3}\r\n                                    fillOpacity={1}\r\n                                    fill=\"url(#colorSales)\"\r\n                                />\r\n                            </AreaChart>\r\n                        </ResponsiveContainer>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Popular Categories */}\r\n                <div className=\"bg-white dark:bg-background-dark rounded-2xl border border-border-subtle p-6 shadow-sm\">\r\n                    <h3 className=\"text-lg font-bold text-text-main mb-6\">Popular Categories</h3>\r\n                    <div className=\"space-y-4\">\r\n                        {categoryStats.length === 0 ? (\r\n                            <p className=\"text-sm text-text-muted\">No sales data available yet.</p>\r\n                        ) : (\r\n                            categoryStats.slice(0, 5).map((cat, index) => {\r\n                                const colors = ['bg-primary', 'bg-blue-500', 'bg-purple-500', 'bg-orange-500', 'bg-pink-500'];\r\n                                const color = colors[index % colors.length];\r\n\r\n                                return (\r\n                                    <div key={cat.name} className=\"space-y-2\">\r\n                                        <div className=\"flex justify-between text-sm\">\r\n                                            <span className=\"font-medium text-text-main\">{cat.name}</span>\r\n                                            <span className=\"font-bold text-text-main\">{cat.percentage}%</span>\r\n                                        </div>\r\n                                        <div className={`h-2 w-full rounded-full overflow-hidden relative bg-gray-100 dark:bg-gray-700`}>\r\n                                            <div\r\n                                                className={`h-full ${color} rounded-full transition-all duration-1000 ease-out`}\r\n                                                style={{ width: `${cat.percentage}%` }}\r\n                                            ></div>\r\n                                        </div>\r\n                                    </div>\r\n                                );\r\n                            })\r\n                        )}\r\n                    </div>\r\n                    <button className=\"w-full mt-6 py-2 rounded-lg border border-primary text-primary text-xs font-bold hover:bg-primary/5 transition-colors uppercase tracking-wider\">\r\n                        View Full Report\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Top Products Chart */}\r\n            <div className=\"bg-white dark:bg-background-dark rounded-2xl border border-border-subtle p-6 shadow-sm\">\r\n                <div className=\"flex items-center justify-between mb-8\">\r\n                    <div>\r\n                        <h3 className=\"text-lg font-bold text-text-main\">Top Selling Products</h3>\r\n                        <p className=\"text-sm text-text-muted\">Best performing items by quantity sold</p>\r\n                    </div>\r\n                </div>\r\n                <div className=\"h-80 w-full\">\r\n                    <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                        <BarChart data={topProducts} layout=\"vertical\" margin={{ top: 5, right: 30, left: 40, bottom: 5 }}>\r\n                            <CartesianGrid strokeDasharray=\"3 3\" horizontal={true} vertical={false} stroke=\"#e5e7eb\" />\r\n                            <XAxis type=\"number\" hide />\r\n                            <YAxis\r\n                                dataKey=\"name\"\r\n                                type=\"category\"\r\n                                width={150}\r\n                                tick={{ fontSize: 11, fill: '#64748B' }}\r\n                                tickLine={false}\r\n                                axisLine={false}\r\n                                tickFormatter={(value) => value.length > 20 ? `${value.substring(0, 20)}...` : value}\r\n                            />\r\n                            <Tooltip\r\n                                cursor={{ fill: 'transparent' }}\r\n                                contentStyle={{ borderRadius: '12px', borderColor: '#e5e7eb', boxShadow: '0 4px 6px -1px rgb(0 0 0 / 0.1)' }}\r\n                                formatter={(value: any) => [value, 'Sold Count']}\r\n                            />\r\n                            <Bar dataKey=\"sold_count\" fill=\"#22C55E\" radius={[0, 4, 4, 0]} barSize={20} />\r\n                        </BarChart>\r\n                    </ResponsiveContainer>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Recent Orders Table */}\r\n            <div className=\"bg-white dark:bg-background-dark rounded-2xl border border-border-subtle shadow-sm overflow-hidden\">\r\n                <div className=\"p-6 border-b border-border-subtle flex items-center justify-between\">\r\n                    <h3 className=\"text-lg font-bold text-text-main\">Recent Orders</h3>\r\n                    <Link href=\"/admin/orders\" className=\"text-primary text-sm font-bold hover:underline\">View All Orders</Link>\r\n                </div>\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left\">\r\n                        <thead className=\"bg-primary/5 text-text-muted text-[11px] uppercase tracking-wider font-bold\">\r\n                            <tr>\r\n                                <th className=\"px-6 py-4\">Order ID</th>\r\n                                <th className=\"px-6 py-4\">Customer</th>\r\n                                <th className=\"px-6 py-4\">Date</th>\r\n                                <th className=\"px-6 py-4\">Total</th>\r\n                                <th className=\"px-6 py-4\">Status</th>\r\n                                <th className=\"px-6 py-4 text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-border-subtle\">\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={6} className=\"px-6 py-4 text-center text-text-muted\">Loading...</td>\r\n                                </tr>\r\n                            ) : (\r\n                                orders.slice(0, 5).map((order) => (\r\n                                    <tr key={order.id} className=\"hover:bg-primary/5 transition-colors group\">\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-text-main\">#{String(order.id).padStart(8, '0')}</td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <div className=\"flex flex-col\">\r\n                                                <span className=\"text-sm font-medium text-text-main\">{order.shipping_name || 'Guest'}</span>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-sm text-text-muted\">{new Date(order.created_at).toLocaleDateString()}</td>\r\n                                        <td className=\"px-6 py-4 text-sm font-bold text-text-main\">{formatPrice(order.total_amount)}</td>\r\n                                        <td className=\"px-6 py-4\">\r\n                                            <span className={`inline-flex items-center gap-1 px-2.5 py-1 rounded-full text-xs font-bold ${getStatusColor(order.status)}`}>\r\n                                                <span className={`w-1 h-1 rounded-full ${getStatusDot(order.status)}`}></span> {order.status}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"px-6 py-4 text-right\">\r\n                                            <Link href=\"/admin/orders\" className=\"material-symbols-outlined text-text-muted hover:text-primary transition-colors\">edit_square</Link>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\products\\ProductForm.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createProduct' is defined but never used.","line":4,"column":66,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":79,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"createProduct"},"fix":{"range":[126,141],"text":""},"desc":"Remove unused variable \"createProduct\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'updateProduct' is defined but never used.","line":4,"column":81,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":94,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"updateProduct"},"fix":{"range":[141,156],"text":""},"desc":"Remove unused variable \"updateProduct\"."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":590,"column":37,"nodeType":"JSXOpeningElement","endLine":590,"endColumn":116}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Product, getCategories, getSpecialCategories, Category, createProduct, updateProduct } from '@/lib/api';\r\nimport { useRouter } from 'next/navigation';\r\nimport { supabaseClient as supabase } from '@/lib/supabaseClient';\r\nimport { useAdminAuth } from '@/context/AdminAuthContext';\r\n\r\nexport function ProductForm({ initialData }: { initialData?: Partial<Product> }) {\r\n    const { adminUser } = useAdminAuth();\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [categoriesList, setCategoriesList] = useState<Category[]>([]);\r\n    const [specialCategoriesList, setSpecialCategoriesList] = useState<{ id: number, name: string }[]>([]);\r\n    const [availableSubcategories, setAvailableSubcategories] = useState<string[]>([]);\r\n    // Image Upload State\r\n    const [selectedFiles, setSelectedFiles] = useState<File[]>([]);\r\n    const [previewUrls, setPreviewUrls] = useState<string[]>(initialData?.images || []);\r\n    const [uploading, setUploading] = useState(false);\r\n\r\n    // We store the 'specialCategoryId' in the formData. \r\n    // Note: The API requires resolved IDs usually, but for updateProduct we might need to handle this.\r\n    // However, updateProduct in api.ts currently takes a Partial<Product> and resolves mainly the Category/Subcategory names.\r\n    // We should make sure we pass the specialCategory ID correctly. \r\n    // Looking at api.ts, updateProduct doesn't currently handle 'specialCategoryId' update explicitly in the easy way if it expects just 'specialCategoryLabel'.\r\n    // Wait, V2 SQL implementation has `special_category_id` column.\r\n    // But `updateProduct` in `api.ts` (lines 282+) essentially just resolves Category/Subcategory by name.\r\n    // It DOES NOT yet update `special_category_id`.\r\n    // I need to update `lib/api.ts` `updateProduct` and `createProduct` to handle `special_category_id` and `discount_percent`.\r\n    // For this Form, I will add the fields to state.\r\n\r\n    // Helper to get ID from label if needed, or we just pass the ID if we update the API to take ID.\r\n    // For now, let's store standard fields.\r\n\r\n    const [activeTab, setActiveTab] = useState<'details' | 'seo'>('details');\r\n\r\n    const [formData, setFormData] = useState<Partial<Product> & { specialCategoryId?: number }>({\r\n        id: initialData?.id, // Keep ID if editing\r\n        name: initialData?.name || '',\r\n        price: initialData?.price || 0,\r\n        originalPrice: initialData?.originalPrice || 0,\r\n        category: initialData?.category || '',\r\n        subcategory: initialData?.subcategory || '',\r\n        description: initialData?.description || '',\r\n        stockQuantity: initialData?.stockQuantity || 0,\r\n        colors: initialData?.colors || [],\r\n        sizes: initialData?.sizes || [],\r\n        quantity: initialData?.quantity || '',\r\n        discountPercent: initialData?.discountPercent || 0,\r\n        specialCategoryId: undefined,\r\n        images: initialData?.images || [],\r\n        metaTitle: initialData?.metaTitle || '',\r\n        metaDescription: initialData?.metaDescription || '',\r\n        canonicalUrl: initialData?.canonicalUrl || '',\r\n        keywords: initialData?.keywords || [],\r\n        noIndex: initialData?.noIndex || false,\r\n        ogImage: initialData?.ogImage || ''\r\n    });\r\n\r\n    useEffect(() => {\r\n        const loadData = async () => {\r\n            const [cats, specialCats] = await Promise.all([getCategories(), getSpecialCategories()]);\r\n            setCategoriesList(cats);\r\n            setSpecialCategoriesList(specialCats);\r\n\r\n            if (initialData?.category) {\r\n                const selectedCat = cats.find(c => c.name === initialData.category);\r\n                if (selectedCat && selectedCat.subcategories) {\r\n                    setAvailableSubcategories(selectedCat.subcategories.map(s => s.name));\r\n                }\r\n            }\r\n\r\n            // Try to match special category label to ID if editing\r\n            if (initialData?.specialCategoryLabel) {\r\n                const match = specialCats.find(sc => sc.name === initialData.specialCategoryLabel);\r\n                if (match) {\r\n                    setFormData(prev => ({ ...prev, specialCategoryId: match.id }));\r\n                }\r\n            }\r\n        };\r\n        loadData();\r\n    }, [initialData]);\r\n\r\n    const handleCategoryChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n        const categoryName = e.target.value;\r\n        const selectedCat = categoriesList.find(c => c.name === categoryName);\r\n\r\n        setFormData({\r\n            ...formData,\r\n            category: categoryName,\r\n            subcategory: ''\r\n        });\r\n\r\n        if (selectedCat && selectedCat.subcategories) {\r\n            setAvailableSubcategories(selectedCat.subcategories.map(s => s.name));\r\n        } else {\r\n            setAvailableSubcategories([]);\r\n        }\r\n    };\r\n\r\n    // Auto-calculate Price logic\r\n    const handleDiscountChange = (val: string) => {\r\n        const newDiscount = val === '' ? 0 : parseInt(val);\r\n        if (isNaN(newDiscount)) return;\r\n\r\n        const basePrice = formData.originalPrice || formData.price || 0;\r\n        const discount = Math.min(100, Math.max(0, newDiscount));\r\n\r\n        let newPrice = formData.price;\r\n        if (basePrice > 0) {\r\n            newPrice = Math.round(basePrice * (1 - discount / 100));\r\n        }\r\n\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            discountPercent: val === '' ? undefined : discount, // Store as is or 0? Better to keep as number usually, but for input control sometimes string is needed. \r\n            // Actually, safely calling it 0 is fine for logic, but for UI we might want to allow empty. \r\n            // Let's stick to safe number for now to satisfy the \"Received NaN\" error.\r\n            // If we use 0, clearing the box sets it to 0 immediately. \r\n            price: newPrice,\r\n            originalPrice: basePrice\r\n        }));\r\n    };\r\n\r\n    const handleOriginalPriceChange = (val: string) => {\r\n        const newOriginal = val === '' ? 0 : parseFloat(val);\r\n        if (isNaN(newOriginal)) return;\r\n\r\n        const discount = formData.discountPercent || 0;\r\n        const newPrice = Math.round(newOriginal * (1 - discount / 100));\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            originalPrice: newOriginal,\r\n            price: newPrice\r\n        }));\r\n    };\r\n\r\n    const [colorInput, setColorInput] = useState('');\r\n\r\n    // Image Handling\r\n    const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        if (e.target.files) {\r\n            const files = Array.from(e.target.files);\r\n            if (files.length + previewUrls.length > 6) {\r\n                alert(\"You can only have up to 6 images per product.\");\r\n                return;\r\n            }\r\n            setSelectedFiles(prev => [...prev, ...files]);\r\n\r\n            // Generate preview URLs\r\n            const newPreviews = files.map(file => URL.createObjectURL(file));\r\n            setPreviewUrls(prev => [...prev, ...newPreviews]);\r\n        }\r\n    };\r\n\r\n    const removeImage = (index: number) => {\r\n        // If index < existing images count (from initialData), it's a URL removal\r\n        // If it's a new file, we need to remove from selectedFiles\r\n\r\n        // Actually, let's keep it simple: previewUrls tracks ALL images (existing + new previews)\r\n        // We need to know which are 'new files' to remove from 'selectedFiles'\r\n\r\n        // Better strategy:\r\n        // previewUrls: all strings.\r\n        // selectedFiles: just the File objects. \r\n        // Mapping is hard if we delete from middle.\r\n\r\n        // Let's just rebuild previewUrls and handle files carefully? \r\n        // Or simpler: We don't support deleting 'newly added but not uploaded' individually easily without complex state.\r\n        // Let's just remove from previewUrls. \r\n        // BUT we need to not upload the file then.\r\n\r\n        // Correct approach:\r\n        // Maintain a single list of items: { type: 'url' | 'file', content: string | File }\r\n        // But for time saving, let's just reset if they want to change? No, that's bad UX.\r\n\r\n        // Let's stick to: \r\n        // formData.images = existing URLs.\r\n        // selectedFiles = new files.\r\n        // When rendering, show [...formData.images, ...selectedFiles.map(preview)]\r\n\r\n        // Wait, I put logic in render.\r\n        // Let's rethink state:\r\n        // images: (string | File)[]\r\n\r\n        // Since I'm using previewUrls as the source of truth for display:\r\n        // When removing index i:\r\n        // output = previewUrls.filter((_, idx) => idx !== i)\r\n        // setPreviewUrls(output)\r\n        // If it was a File, remove from selectedFiles? \r\n        // This is tricky.\r\n\r\n        // New Plan:\r\n        // Just use `previewUrls` for display.\r\n        // `existingImages`: string[] (URLs)\r\n        // `newFiles`: File[]\r\n        // Render existing, then new.\r\n        // Remove button on existing -> remove from `existingImages`.\r\n        // Remove button on new -> remove from `newFiles`.\r\n\r\n        const existingCount = formData.images?.length || 0;\r\n\r\n        if (index < existingCount) {\r\n            // Removing an existing image\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                images: prev.images?.filter((_, i) => i !== index)\r\n            }));\r\n            setPreviewUrls(prev => prev.filter((_, i) => i !== index));\r\n        } else {\r\n            // Removing a new file\r\n            const fileIndex = index - existingCount;\r\n            setSelectedFiles(prev => prev.filter((_, i) => i !== fileIndex));\r\n            setPreviewUrls(prev => prev.filter((_, i) => i !== index));\r\n        }\r\n    };\r\n\r\n    const uploadImages = async (productId: string) => {\r\n        const uploadedUrls: string[] = [];\r\n\r\n        for (const file of selectedFiles) {\r\n            const fileExt = file.name.split('.').pop();\r\n            const fileName = `${Math.random().toString(36).substring(2)}.${fileExt}`;\r\n            const filePath = `${productId}/${fileName}`;\r\n\r\n            const { error: uploadError } = await supabase.storage\r\n                .from('product-images')\r\n                .upload(filePath, file);\r\n\r\n            if (uploadError) {\r\n                console.error('Error uploading image:', uploadError);\r\n                // Continue with others? Or fail?\r\n                continue;\r\n            }\r\n\r\n            const { data } = supabase.storage\r\n                .from('product-images')\r\n                .getPublicUrl(filePath);\r\n\r\n            if (data) {\r\n                uploadedUrls.push(data.publicUrl);\r\n            }\r\n        }\r\n        return uploadedUrls;\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n\r\n        try {\r\n            // 1. Prepare initial payload (without images)\r\n            console.log('Admin User:', adminUser);\r\n            console.log('Admin User ID:', adminUser?.id);\r\n            console.log('Admin User Role:', adminUser?.role);\r\n\r\n            const payload = {\r\n                ...formData,\r\n                images: formData.images || [], // Keep existing images if editing\r\n                // Only include ID if editing\r\n                ...(initialData?.id && { id: initialData.id }),\r\n                // Attach Merchant Info if applicable\r\n                merchantId: adminUser?.id, // Always include user ID\r\n                shopName: adminUser?.role === 'MERCHANT' ? (adminUser.shop_name || adminUser.full_name) : undefined\r\n            };\r\n\r\n            console.log('Submitting product payload:', payload);\r\n\r\n            // 2. Save product first to get the ID\r\n            const { upsertProductAction } = await import('@/actions/products');\r\n            const result = await upsertProductAction(payload as any);\r\n\r\n            console.log('Server action result:', result);\r\n\r\n            if (!result.success) {\r\n                throw new Error(result.error);\r\n            }\r\n\r\n            // 3. Upload images if any new files selected\r\n            if (selectedFiles.length > 0 && result.data?.id) {\r\n                setUploading(true);\r\n                const productId = String(result.data.id);\r\n                console.log('Uploading images for product ID:', productId);\r\n\r\n                const newImageUrls = await uploadImages(productId);\r\n                console.log('Uploaded image URLs:', newImageUrls);\r\n\r\n                // 4. Update product with image URLs\r\n                if (newImageUrls.length > 0) {\r\n                    const finalImages = [...(formData.images || []), ...newImageUrls];\r\n                    const updateResult = await upsertProductAction({\r\n                        ...payload,\r\n                        id: result.data.id,\r\n                        images: finalImages\r\n                    } as any);\r\n\r\n                    if (!updateResult.success) {\r\n                        console.error('Failed to update product with images:', updateResult.error);\r\n                    } else {\r\n                        console.log('Product updated with images successfully');\r\n                    }\r\n                }\r\n            }\r\n\r\n            router.push('/admin/products');\r\n            router.refresh();\r\n\r\n        } catch (error: any) {\r\n            console.error('Failed to save product:', error);\r\n            alert(`Failed to save product: ${error.message}`);\r\n        } finally {\r\n            setLoading(false);\r\n            setUploading(false);\r\n        }\r\n    };\r\n\r\n    const handleAddColor = () => {\r\n        if (colorInput.trim()) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                colors: [...(prev.colors || []), colorInput.trim()]\r\n            }));\r\n            setColorInput('');\r\n        }\r\n    };\r\n\r\n    const removeColor = (colorToRemove: string) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            colors: prev.colors?.filter(c => c !== colorToRemove) || []\r\n        }));\r\n    };\r\n\r\n    const [sizeInput, setSizeInput] = useState('');\r\n    const handleAddSize = () => {\r\n        if (sizeInput.trim()) {\r\n            setFormData(prev => ({\r\n                ...prev,\r\n                sizes: [...(prev.sizes || []), sizeInput.trim()]\r\n            }));\r\n            setSizeInput('');\r\n        }\r\n    };\r\n\r\n    const removeSize = (sizeToRemove: string) => {\r\n        setFormData(prev => ({\r\n            ...prev,\r\n            sizes: prev.sizes?.filter(s => s !== sizeToRemove) || []\r\n        }));\r\n    };\r\n\r\n\r\n\r\n    return (\r\n        <form onSubmit={handleSubmit} className=\"space-y-8 max-w-5xl mx-auto\">\r\n            <div className=\"flex items-center gap-4 mb-6 border-b border-slate-200 dark:border-slate-700\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => setActiveTab('details')}\r\n                    className={`px-4 py-2 font-bold text-sm transition-colors border-b-2 ${activeTab === 'details' ? 'border-primary text-primary' : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400'}`}\r\n                >\r\n                    Product Details\r\n                </button>\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => setActiveTab('seo')}\r\n                    className={`px-4 py-2 font-bold text-sm transition-colors border-b-2 ${activeTab === 'seo' ? 'border-primary text-primary' : 'border-transparent text-slate-500 hover:text-slate-700 dark:text-slate-400'}`}\r\n                >\r\n                    SEO Settings\r\n                </button>\r\n            </div>\r\n\r\n            <div className={activeTab === 'details' ? 'block space-y-8' : 'hidden'}>\r\n                <div className=\"bg-white dark:bg-slate-800 p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm space-y-6\">\r\n\r\n                    {/* Header */}\r\n                    <div className=\"border-b border-slate-100 dark:border-slate-700 pb-4 mb-4\">\r\n                        <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Product Information</h2>\r\n                        <p className=\"text-sm text-slate-500\">Manage basic product details, pricing, and inventory.</p>\r\n                    </div>\r\n\r\n                    {/* Special Offers Section */}\r\n                    <div className=\"bg-slate-50 dark:bg-slate-900/50 p-6 rounded-xl border border-dashed border-slate-300 dark:border-slate-600 space-y-4\">\r\n                        <h3 className=\"font-bold text-primary flex items-center gap-2\">\r\n                            <span className=\"material-icons-round\">local_offer</span>\r\n                            Special Offers & Pricing\r\n                        </h3>\r\n                        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Original Price ({'\\u09F3'})</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    step=\"0.01\"\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.originalPrice}\r\n                                    onChange={e => handleOriginalPriceChange(e.target.value)}\r\n                                    placeholder=\"Base Price\"\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Discount (%)</label>\r\n                                <input\r\n                                    type=\"number\"\r\n                                    min=\"0\"\r\n                                    max=\"100\"\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.discountPercent ?? ''}\r\n                                    onChange={e => handleDiscountChange(e.target.value)}\r\n                                />\r\n                            </div>\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Special Tag</label>\r\n                                <select\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-white dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.specialCategoryId || ''}\r\n                                    onChange={e => setFormData({ ...formData, specialCategoryId: parseInt(e.target.value) })}\r\n                                >\r\n                                    <option value=\"\">None</option>\r\n                                    {specialCategoriesList.map(sc => (\r\n                                        <option key={sc.id} value={sc.id}>{sc.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Basic Info */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Product Name</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                required\r\n                                className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                value={formData.name}\r\n                                onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-4\">\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Category</label>\r\n                                <select\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.category}\r\n                                    onChange={handleCategoryChange}\r\n                                >\r\n                                    <option value=\"\">Select Category</option>\r\n                                    {categoriesList.map(c => (\r\n                                        <option key={c.id} value={c.name}>{c.name}</option>\r\n                                    ))}\r\n                                </select>\r\n                            </div>\r\n                            {availableSubcategories.length > 0 && (\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Subcategory</label>\r\n                                    <select\r\n                                        className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                        value={formData.subcategory}\r\n                                        onChange={e => setFormData({ ...formData, subcategory: e.target.value })}\r\n                                    >\r\n                                        <option value=\"\">Select Subcategory</option>\r\n                                        {availableSubcategories.map(sub => (\r\n                                            <option key={sub} value={sub}>{sub}</option>\r\n                                        ))}\r\n                                    </select>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Final Price & Stock */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Final Price ({'\\u09F3'})</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"0.01\"\r\n                                required\r\n                                className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all font-bold text-primary\"\r\n                                value={formData.price}\r\n                                readOnly\r\n                                title=\"Auto-calculated from Original Price - Discount\"\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Stock Quantity</label>\r\n                            <input\r\n                                type=\"number\"\r\n                                required\r\n                                className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                value={formData.stockQuantity}\r\n                                onChange={e => setFormData({ ...formData, stockQuantity: e.target.value === '' ? 0 : parseInt(e.target.value) })}\r\n                            />\r\n                        </div>\r\n                        <div className=\"space-y-2\">\r\n                            <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Unit Label</label>\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"e.g. 1kg, 500g, Pack\"\r\n                                className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                value={formData.quantity}\r\n                                onChange={e => setFormData({ ...formData, quantity: e.target.value })}\r\n                            />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Description */}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Description</label>\r\n                        <textarea\r\n                            rows={4}\r\n                            className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                            value={formData.description}\r\n                            onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                        />\r\n                    </div>\r\n\r\n                    {/* Colors */}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Available Colors</label>\r\n                        <div className=\"flex gap-2 mb-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Add a color (e.g. Red, Blue)\"\r\n                                className=\"flex-1 px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                value={colorInput}\r\n                                onChange={e => setColorInput(e.target.value)}\r\n                                onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddColor())}\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleAddColor}\r\n                                className=\"px-6 py-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors\"\r\n                            >\r\n                                Add\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {formData.colors?.map((color) => (\r\n                                <span key={color} className=\"inline-flex items-center gap-2 px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-full text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                                    {color}\r\n                                    <button type=\"button\" onClick={() => removeColor(color)} className=\"hover:text-red-500\">\r\n                                        <span className=\"material-icons-round text-base\">close</span>\r\n                                    </button>\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Sizes */}\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Available Sizes</label>\r\n                        <div className=\"flex gap-2 mb-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                placeholder=\"Add a size (e.g. S, M, XL, 42)\"\r\n                                className=\"flex-1 px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                value={sizeInput}\r\n                                onChange={e => setSizeInput(e.target.value)}\r\n                                onKeyDown={e => e.key === 'Enter' && (e.preventDefault(), handleAddSize())}\r\n                            />\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={handleAddSize}\r\n                                className=\"px-6 py-3 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 dark:hover:bg-slate-600 transition-colors\"\r\n                            >\r\n                                Add\r\n                            </button>\r\n                        </div>\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {formData.sizes?.map((size) => (\r\n                                <span key={size} className=\"inline-flex items-center gap-2 px-3 py-1 bg-slate-100 dark:bg-slate-700 rounded-full text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                                    {size}\r\n                                    <button type=\"button\" onClick={() => removeSize(size)} className=\"hover:text-red-500\">\r\n                                        <span className=\"material-icons-round text-base\">close</span>\r\n                                    </button>\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Product Images */}\r\n                    <div className=\"space-y-4\">\r\n                        <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Product Images (Max 6)</label>\r\n\r\n                        {/* Image Grid */}\r\n                        <div className=\"grid grid-cols-3 md:grid-cols-6 gap-4\">\r\n                            {previewUrls.map((url, idx) => (\r\n                                <div key={idx} className=\"relative aspect-square bg-slate-100 dark:bg-slate-700 rounded-xl overflow-hidden border border-slate-200 dark:border-slate-600 group\">\r\n                                    <img src={url} alt={`Preview ${idx}`} className=\"w-full h-full object-cover\" />\r\n                                    <button\r\n                                        type=\"button\"\r\n                                        onClick={() => removeImage(idx)}\r\n                                        className=\"absolute top-1 right-1 bg-red-500 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity\"\r\n                                    >\r\n                                        <span className=\"material-icons-round text-xs\">close</span>\r\n                                    </button>\r\n                                </div>\r\n                            ))}\r\n\r\n                            {/* Upload Button */}\r\n                            {previewUrls.length < 6 && (\r\n                                <label className=\"aspect-square bg-slate-50 dark:bg-slate-900 border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-xl flex flex-col items-center justify-center cursor-pointer hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors\">\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        multiple\r\n                                        accept=\"image/*\"\r\n                                        className=\"hidden\"\r\n                                        onChange={handleFileSelect}\r\n                                    />\r\n                                    <span className=\"material-icons-round text-slate-400 mb-1\">add_photo_alternate</span>\r\n                                    <span className=\"text-xs font-bold text-slate-500\">Add Image</span>\r\n                                </label>\r\n                            )}\r\n                        </div>\r\n                        <p className=\"text-xs text-slate-500\">First image will be the primary display image.</p>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* SEO Section */}\r\n            <div className={activeTab === 'seo' ? 'block' : 'hidden'}>\r\n                <div className=\"bg-white dark:bg-slate-800 p-8 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm space-y-8\">\r\n                    <div className=\"border-b border-slate-100 dark:border-slate-700 pb-4\">\r\n                        <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">Search Engine Optimization</h2>\r\n                        <p className=\"text-sm text-slate-500\">Optimize how your product appears in search results.</p>\r\n                    </div>\r\n\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12\">\r\n                        {/* SEO Fields */}\r\n                        <div className=\"space-y-6\">\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex justify-between\">\r\n                                    <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Meta Title</label>\r\n                                    <span className={`text-xs ${(formData.metaTitle?.length || 0) > 60 ? 'text-red-500' : 'text-slate-400'}`}>\r\n                                        {formData.metaTitle?.length || 0} / 60\r\n                                    </span>\r\n                                </div>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.metaTitle}\r\n                                    placeholder={formData.name || \"Product Name\"}\r\n                                    onChange={e => setFormData({ ...formData, metaTitle: e.target.value })}\r\n                                />\r\n                                <p className=\"text-xs text-slate-500\">Leave blank to use Product Name.</p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <div className=\"flex justify-between\">\r\n                                    <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Meta Description</label>\r\n                                    <span className={`text-xs ${(formData.metaDescription?.length || 0) > 160 ? 'text-red-500' : 'text-slate-400'}`}>\r\n                                        {formData.metaDescription?.length || 0} / 160\r\n                                    </span>\r\n                                </div>\r\n                                <textarea\r\n                                    rows={4}\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.metaDescription}\r\n                                    placeholder={formData.description?.slice(0, 160) || \"Short description of the product...\"}\r\n                                    onChange={e => setFormData({ ...formData, metaDescription: e.target.value })}\r\n                                />\r\n                                <p className=\"text-xs text-slate-500\">Leave blank to use Product Description.</p>\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Keywords</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.keywords?.join(', ')}\r\n                                    placeholder=\"Comma separated keywords (e.g. fresh, organic, vegetables)\"\r\n                                    onChange={e => setFormData({ ...formData, keywords: e.target.value.split(',').map(k => k.trim()) })}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"space-y-2\">\r\n                                <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300\">Canonical URL</label>\r\n                                <input\r\n                                    type=\"url\"\r\n                                    className=\"w-full px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none transition-all\"\r\n                                    value={formData.canonicalUrl}\r\n                                    onChange={e => setFormData({ ...formData, canonicalUrl: e.target.value })}\r\n                                />\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3 p-4 bg-slate-50 dark:bg-slate-900 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    id=\"noIndex\"\r\n                                    checked={formData.noIndex}\r\n                                    onChange={e => setFormData({ ...formData, noIndex: e.target.checked })}\r\n                                    className=\"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary\"\r\n                                />\r\n                                <label htmlFor=\"noIndex\" className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                                    No Index (Hide from Search Engines)\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Google Search Preview */}\r\n                        <div>\r\n                            <label className=\"text-sm font-bold text-slate-700 dark:text-slate-300 mb-4 block\">Google Search Preview</label>\r\n                            <div className=\"bg-white p-4 rounded-xl shadow-sm border border-slate-200 max-w-xl\">\r\n                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                    <div className=\"w-7 h-7 bg-slate-100 rounded-full flex items-center justify-center text-[10px] text-slate-500\">Logo</div>\r\n                                    <div className=\"flex flex-col\">\r\n                                        <span className=\"text-sm text-[#202124]\">Daily Fresh</span>\r\n                                        <span className=\"text-xs text-[#5f6368]\">https://dailyfresh.com/product/{formData.name?.toLowerCase().replace(/\\s+/g, '-')}</span>\r\n                                    </div>\r\n                                    <span className=\"material-icons-round text-lg text-[#5f6368] ml-auto\">more_vert</span>\r\n                                </div>\r\n                                <h3 className=\"text-xl text-[#1a0dab] hover:underline cursor-pointer truncate mb-1\">\r\n                                    {formData.metaTitle || formData.name || \"Product Name\"}\r\n                                </h3>\r\n                                <p className=\"text-sm text-[#4d5156] line-clamp-2\">\r\n                                    {formData.metaDescription || formData.description || \"Product description will appear here...\"}\r\n                                </p>\r\n                            </div>\r\n                            <p className=\"text-xs text-slate-500 mt-4\">\r\n                                * This is a simulation. Actual appearance on Google may vary.\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"flex justify-end gap-4\">\r\n                <button\r\n                    type=\"button\"\r\n                    onClick={() => router.back()}\r\n                    className=\"px-8 py-4 bg-white dark:bg-slate-800 text-slate-700 dark:text-slate-300 font-bold rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors\"\r\n                >\r\n                    Cancel\r\n                </button>\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"px-8 py-4 bg-primary text-white font-bold rounded-xl shadow-lg shadow-green-500/30 hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                >\r\n                    {uploading && <span className=\"material-icons-round animate-spin text-sm\">refresh</span>}\r\n                    {loading ? (uploading ? 'Uploading...' : 'Saving...') : 'Save Product'}\r\n                </button>\r\n            </div>\r\n        </form >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\products\\[id]\\edit\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\products\\new\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\products\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Image' is defined but never used.","line":5,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":13,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Image"},"fix":{"range":[238,269],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":45,"column":8,"nodeType":"ArrayExpression","endLine":45,"endColumn":95,"suggestions":[{"desc":"Update the dependencies array to be: [searchQuery, selectedCategory, sortBy, minPrice, maxPrice, adminUser, queryMerchantId, fetchData]","fix":{"range":[1785,1872],"text":"[searchQuery, selectedCategory, sortBy, minPrice, maxPrice, adminUser, queryMerchantId, fetchData]"}}]},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchData'. Either include it or remove the dependency array.","line":50,"column":8,"nodeType":"ArrayExpression","endLine":50,"endColumn":21,"suggestions":[{"desc":"Update the dependencies array to be: [currentPage, fetchData]","fix":{"range":[2009,2022],"text":"[currentPage, fetchData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":229,"column":57,"nodeType":"JSXOpeningElement","endLine":229,"endColumn":148},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":328,"column":74,"nodeType":"Identifier","messageId":"unusedVar","endLine":328,"endColumn":75}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":5,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { getProductsPaginated, deleteProduct, updateProduct, getCategories, Category, ProductFilterOptions, PaginatedProducts } from '@/lib/api';\r\nimport { formatPrice } from '@/lib/format';\r\nimport Link from 'next/link';\r\nimport Image from 'next/image';\r\nimport { useState, useEffect } from 'react';\r\nimport { useSearchParams } from 'next/navigation';\r\nimport { useAdminAuth } from '@/context/AdminAuthContext';\r\nimport { toggleFeaturedProduct } from '@/actions/products';\r\n\r\nexport default function AdminProductsPage() {\r\n    const { adminUser } = useAdminAuth();\r\n    const [products, setProducts] = useState<any[]>([]);\r\n    const [searchQuery, setSearchQuery] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const searchParams = useSearchParams();\r\n    const queryMerchantId = searchParams.get('merchant_id');\r\n\r\n    // Filter State\r\n    const [categories, setCategories] = useState<Category[]>([]);\r\n    const [selectedCategory, setSelectedCategory] = useState('');\r\n    const [sortBy, setSortBy] = useState<ProductFilterOptions['sortBy']>('newest');\r\n    const [minPrice, setMinPrice] = useState('');\r\n    const [maxPrice, setMaxPrice] = useState('');\r\n\r\n    // Pagination State\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n    const [totalPages, setTotalPages] = useState(1);\r\n    const [totalCount, setTotalCount] = useState(0);\r\n    const pageSize = 10;\r\n\r\n    useEffect(() => {\r\n        // Load Categories on mount\r\n        getCategories().then(setCategories);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        const timer = setTimeout(() => {\r\n            // Reset to page 1 when filters change\r\n            setCurrentPage(1);\r\n            fetchData(1);\r\n        }, 500);\r\n        return () => clearTimeout(timer);\r\n    }, [searchQuery, selectedCategory, sortBy, minPrice, maxPrice, adminUser, queryMerchantId]); // Added queryMerchantId dependency\r\n\r\n    // Fetch when page changes\r\n    useEffect(() => {\r\n        fetchData(currentPage);\r\n    }, [currentPage]);\r\n\r\n    const fetchData = async (pageToFetch: number) => {\r\n        // Wait for adminUser to check role, or proceed if loaded?\r\n        // Actually, if adminUser is null but loading is false, it means not logged in?\r\n        // useAdminAuth handles redirect usually?\r\n        // Here we just skip fetch if auth loading/missing\r\n        if (!adminUser) return;\r\n\r\n        try {\r\n            setLoading(true);\r\n            // Determine effective Merchant ID\r\n            let targetMerchantId = undefined;\r\n            if (adminUser.role === 'MERCHANT') {\r\n                targetMerchantId = adminUser.id;\r\n            } else if (adminUser.role === 'SUPERADMIN' && queryMerchantId) {\r\n                targetMerchantId = queryMerchantId;\r\n            }\r\n\r\n            const options: ProductFilterOptions = {\r\n                query: searchQuery,\r\n                categoryId: selectedCategory || undefined,\r\n                sortBy: sortBy,\r\n                minPrice: minPrice ? parseFloat(minPrice) : undefined,\r\n                maxPrice: maxPrice ? parseFloat(maxPrice) : undefined,\r\n                page: pageToFetch,\r\n                limit: pageSize,\r\n                merchantId: targetMerchantId\r\n            };\r\n            const result: PaginatedProducts = await getProductsPaginated(options);\r\n            setProducts(result.data);\r\n            setTotalPages(result.totalPages);\r\n            setTotalCount(result.count);\r\n        } catch (error) {\r\n            console.error('Failed to fetch products', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handlePageChange = (newPage: number) => {\r\n        if (newPage >= 1 && newPage <= totalPages) {\r\n            setCurrentPage(newPage);\r\n        }\r\n    };\r\n\r\n    const toggleApproval = async (product: any) => {\r\n        if (!confirm(`Are you sure you want to ${product.is_approved ? 'reject' : 'approve'} this product?`)) return;\r\n\r\n        try {\r\n            await updateProduct(product.id, { isApproved: !product.is_approved });\r\n            // Optimistic update\r\n            setProducts(prev => prev.map(p => p.id === product.id ? { ...p, is_approved: !p.is_approved } : p));\r\n        } catch (error) {\r\n            console.error('Error updating approval:', error);\r\n            alert('Failed to update status');\r\n        }\r\n    };\r\n\r\n    const handleToggleFeatured = async (productId: number, currentFeatured: boolean) => {\r\n        try {\r\n            const result = await toggleFeaturedProduct(productId, !currentFeatured);\r\n            if (result.success) {\r\n                // Optimistic update\r\n                setProducts(prev => prev.map(p => p.id === productId ? { ...p, is_featured: !currentFeatured } : p));\r\n            } else {\r\n                alert('Failed to toggle featured status');\r\n            }\r\n        } catch (error) {\r\n            console.error('Error toggling featured:', error);\r\n            alert('Failed to toggle featured status');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div>\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-4\">\r\n                <div>\r\n                    <h1 className=\"text-3xl font-bold text-slate-900 dark:text-white\">Products</h1>\r\n                    <p className=\"text-slate-500 dark:text-slate-400\">Manage your product inventory ({totalCount} items)</p>\r\n                </div>\r\n                <div className=\"flex flex-col sm:flex-row gap-4 w-full sm:w-auto items-center\">\r\n\r\n                    <Link\r\n                        href=\"/admin/products/new\"\r\n                        className=\"flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl hover:bg-primary/90 transition-colors font-bold shadow-lg shadow-green-500/20 whitespace-nowrap\"\r\n                    >\r\n                        <span className=\"material-icons-round\">add</span>\r\n                        Add Product\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filter Toolbar */}\r\n            <div className=\"bg-white dark:bg-slate-800 p-4 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm mb-6 flex flex-wrap gap-4 items-center\">\r\n                <div className=\"relative w-full sm:w-64\">\r\n                    <span className=\"material-icons-round absolute left-3 top-1/2 -translate-y-1/2 text-slate-400\">search</span>\r\n                    <input\r\n                        type=\"text\"\r\n                        placeholder=\"Search by name...\"\r\n                        value={searchQuery}\r\n                        onChange={(e) => setSearchQuery(e.target.value)}\r\n                        className=\"w-full pl-10 pr-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-sm focus:ring-primary focus:border-primary shadow-sm\"\r\n                    />\r\n                </div>\r\n\r\n                <select\r\n                    value={selectedCategory}\r\n                    onChange={(e) => setSelectedCategory(e.target.value)}\r\n                    className=\"px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-sm focus:ring-primary focus:border-primary shadow-sm outline-none\"\r\n                >\r\n                    <option value=\"\">All Categories</option>\r\n                    {categories.map(cat => (\r\n                        <option key={cat.id} value={cat.id}>{cat.name}</option>\r\n                    ))}\r\n                </select>\r\n\r\n                <select\r\n                    value={sortBy}\r\n                    onChange={(e) => setSortBy(e.target.value as any)}\r\n                    className=\"px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-sm focus:ring-primary focus:border-primary shadow-sm outline-none\"\r\n                >\r\n                    <option value=\"newest\">Newest First</option>\r\n                    <option value=\"price_asc\">Price: Low to High</option>\r\n                    <option value=\"price_desc\">Price: High to Low</option>\r\n                    <option value=\"stock_asc\">Stock: Low to High</option>\r\n                    <option value=\"stock_desc\">Stock: High to Low</option>\r\n                </select>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <input\r\n                        type=\"number\"\r\n                        placeholder=\"Min Price\"\r\n                        value={minPrice}\r\n                        onChange={(e) => setMinPrice(e.target.value)}\r\n                        className=\"w-24 px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-sm focus:ring-primary focus:border-primary shadow-sm outline-none\"\r\n                    />\r\n                    <span className=\"text-slate-400\">-</span>\r\n                    <input\r\n                        type=\"number\"\r\n                        placeholder=\"Max Price\"\r\n                        value={maxPrice}\r\n                        onChange={(e) => setMaxPrice(e.target.value)}\r\n                        className=\"w-24 px-4 py-2.5 rounded-xl border border-slate-200 dark:border-slate-700 bg-slate-50 dark:bg-slate-900 text-sm focus:ring-primary focus:border-primary shadow-sm outline-none\"\r\n                    />\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm overflow-hidden flex flex-col\">\r\n                <div className=\"overflow-x-auto\">\r\n                    <table className=\"w-full text-left border-collapse\">\r\n                        <thead>\r\n                            <tr className=\"bg-slate-50 dark:bg-slate-900/50 border-b border-slate-200 dark:border-slate-700 text-slate-500 dark:text-slate-400 text-sm uppercase tracking-wider\">\r\n                                <th className=\"p-6 font-semibold\">Product</th>\r\n                                <th className=\"p-6 font-semibold\">Category</th>\r\n                                <th className=\"p-6 font-semibold\">Price</th>\r\n                                <th className=\"p-6 font-semibold\">Stock</th>\r\n                                <th className=\"p-6 font-semibold\">Status</th>\r\n                                <th className=\"p-6 font-semibold\">Featured</th>\r\n                                {adminUser?.role === 'SUPERADMIN' && <th className=\"p-6 font-semibold\">Merchant</th>}\r\n                                <th className=\"p-6 font-semibold text-right\">Actions</th>\r\n                            </tr>\r\n                        </thead>\r\n                        <tbody className=\"divide-y divide-slate-100 dark:divide-slate-700\">\r\n                            {loading ? (\r\n                                <tr>\r\n                                    <td colSpan={7} className=\"p-8 text-center text-slate-500\">Loading products...</td>\r\n                                </tr>\r\n                            ) : products.length === 0 ? (\r\n                                <tr>\r\n                                    <td colSpan={7} className=\"p-8 text-center text-slate-500\">No products found.</td>\r\n                                </tr>\r\n                            ) : (\r\n                                products.map((product) => (\r\n                                    <tr key={product.id} className=\"hover:bg-slate-50 dark:hover:bg-slate-800/50 transition-colors\">\r\n                                        <td className=\"p-6\">\r\n                                            <div className=\"flex items-center gap-4\">\r\n                                                <div className=\"w-12 h-12 rounded-lg bg-slate-100 dark:bg-slate-700 p-1 shrink-0 overflow-hidden\">\r\n                                                    {product.images && product.images.length > 0 ? (\r\n                                                        <img src={product.images[0]} alt={product.name} className=\"w-full h-full object-contain\" />\r\n                                                    ) : (\r\n                                                        <div className=\"w-full h-full flex items-center justify-center text-slate-400\">\r\n                                                            <span className=\"material-icons-round text-sm\">image_not_supported</span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                </div>\r\n                                                <div>\r\n                                                    <p className=\"font-bold text-slate-900 dark:text-white line-clamp-1\">{product.name}</p>\r\n                                                    <p className=\"text-xs text-slate-500\">{product.quantity}</p>\r\n                                                    {(product.sizes && product.sizes.length > 0) && (\r\n                                                        <p className=\"text-xs text-slate-400 mt-1\">Sizes: {product.sizes.join(', ')}</p>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                        </td>\r\n                                        <td className=\"p-6 text-slate-600 dark:text-slate-300\">\r\n                                            <span className=\"px-3 py-1 rounded-full bg-slate-100 dark:bg-slate-700 text-xs font-bold\">\r\n                                                {product.category}\r\n                                            </span>\r\n                                        </td>\r\n                                        <td className=\"p-6 font-bold text-slate-900 dark:text-white\">\r\n                                            {formatPrice(product.price)}\r\n                                        </td>\r\n                                        <td className=\"p-6\">\r\n                                            {product.stockQuantity === 0 ? (\r\n                                                <span className=\"text-red-500 font-bold text-sm bg-red-50 dark:bg-red-900/20 px-3 py-1 rounded-full\">Out of Stock</span>\r\n                                            ) : (\r\n                                                <span className={`font-medium ${product.stockQuantity < 10 ? 'text-orange-500' : 'text-slate-600 dark:text-slate-300'}`}>\r\n                                                    {product.stockQuantity} units\r\n                                                </span>\r\n                                            )}\r\n                                        </td>\r\n                                        <td className=\"p-6\">\r\n                                            {product.is_approved ? (\r\n                                                <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold border border-green-200 dark:border-green-800\">\r\n                                                    <span className=\"w-1.5 h-1.5 rounded-full bg-green-600\"></span>\r\n                                                    Approved\r\n                                                </span>\r\n                                            ) : (\r\n                                                <span className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-yellow-100 dark:bg-yellow-900/30 text-yellow-700 dark:text-yellow-400 text-xs font-bold border border-yellow-200 dark:border-yellow-800\">\r\n                                                    <span className=\"w-1.5 h-1.5 rounded-full bg-yellow-600\"></span>\r\n                                                    Pending\r\n                                                </span>\r\n                                            )}\r\n                                        </td>\r\n\r\n                                        <td className=\"p-6\">\r\n                                            <button\r\n                                                onClick={() => handleToggleFeatured(product.id, product.is_featured)}\r\n                                                className={`w-8 h-8 flex items-center justify-center rounded-lg transition-all ${product.is_featured\r\n                                                        ? 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 hover:bg-yellow-200 dark:hover:bg-yellow-900/50'\r\n                                                        : 'text-slate-300 dark:text-slate-600 hover:bg-slate-100 dark:hover:bg-slate-700 hover:text-yellow-500'\r\n                                                    }`}\r\n                                                title={product.is_featured ? 'Remove from Featured' : 'Add to Featured'}\r\n                                            >\r\n                                                <span className=\"material-icons-round text-xl\">\r\n                                                    {product.is_featured ? 'star' : 'star_outline'}\r\n                                                </span>\r\n                                            </button>\r\n                                        </td>\r\n\r\n                                        {adminUser?.role === 'SUPERADMIN' && (\r\n                                            <td className=\"p-6 text-sm text-slate-600 dark:text-slate-300\">\r\n                                                {product.shop_name || 'Daily Fresh'}\r\n                                            </td>\r\n                                        )}\r\n\r\n                                        <td className=\"p-6 text-right\">\r\n                                            <div className=\"flex items-center justify-end gap-2\">\r\n                                                {/* Super Admin Approval Actions */}\r\n                                                {adminUser?.role === 'SUPERADMIN' && (\r\n                                                    <button\r\n                                                        onClick={() => toggleApproval(product)}\r\n                                                        className={`w-8 h-8 flex items-center justify-center rounded-lg transition-colors ${product.is_approved\r\n                                                            ? 'hover:bg-yellow-50 dark:hover:bg-yellow-900/20 text-slate-400 hover:text-yellow-600'\r\n                                                            : 'hover:bg-green-50 dark:hover:bg-green-900/20 text-slate-400 hover:text-green-600'\r\n                                                            }`}\r\n                                                        title={product.is_approved ? \"Reject Product\" : \"Approve Product\"}\r\n                                                    >\r\n                                                        <span className=\"material-icons-round text-lg\">\r\n                                                            {product.is_approved ? 'block' : 'check_circle'}\r\n                                                        </span>\r\n                                                    </button>\r\n                                                )}\r\n\r\n                                                <Link\r\n                                                    href={`/admin/products/${product.id}/edit`}\r\n                                                    className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-slate-100 dark:hover:bg-slate-700 text-slate-400 hover:text-primary transition-colors\"\r\n                                                >\r\n                                                    <span className=\"material-icons-round text-lg\">edit</span>\r\n                                                </Link>\r\n                                                <button\r\n                                                    onClick={() => {\r\n                                                        if (confirm('Are you sure you want to delete this product?')) {\r\n                                                            const handleDelete = async () => {\r\n                                                                try {\r\n                                                                    await deleteProduct(product.id);\r\n                                                                    fetchData(currentPage);\r\n                                                                } catch (e) {\r\n                                                                    alert('Failed to delete product');\r\n                                                                }\r\n                                                            };\r\n                                                            handleDelete();\r\n                                                        }\r\n                                                    }}\r\n                                                    className=\"w-8 h-8 flex items-center justify-center rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 text-slate-400 hover:text-red-500 transition-colors\"\r\n                                                >\r\n                                                    <span className=\"material-icons-round text-lg\">delete</span>\r\n                                                </button>\r\n                                            </div>\r\n                                        </td>\r\n                                    </tr>\r\n                                ))\r\n                            )}\r\n                        </tbody>\r\n                    </table>\r\n                </div>\r\n\r\n                {/* Pagination Controls */}\r\n                <div className=\"p-4 border-t border-slate-200 dark:border-slate-700 flex items-center justify-between bg-slate-50 dark:bg-slate-900/50\">\r\n                    <p className=\"text-sm text-slate-500 dark:text-slate-400\">\r\n                        Showing page <span className=\"font-bold text-slate-900 dark:text-white\">{currentPage}</span> of <span className=\"font-bold text-slate-900 dark:text-white\">{totalPages}</span>\r\n                    </p>\r\n                    <div className=\"flex items-center gap-2\">\r\n                        <button\r\n                            onClick={() => handlePageChange(currentPage - 1)}\r\n                            disabled={currentPage === 1}\r\n                            className=\"px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                        >\r\n                            Previous\r\n                        </button>\r\n                        <button\r\n                            onClick={() => handlePageChange(currentPage + 1)}\r\n                            disabled={currentPage === totalPages}\r\n                            className=\"px-4 py-2 rounded-lg border border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800 text-sm font-medium text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                        >\r\n                            Next\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div >\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\register\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":7,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":7,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState } from 'react';\r\nimport { useRouter } from 'next/navigation';\r\nimport Link from 'next/link';\r\n\r\nexport default function AdminRegister() {\r\n    const router = useRouter();\r\n    const [formData, setFormData] = useState({\r\n        email: '',\r\n        password: '',\r\n        full_name: '',\r\n        shop_name: '',\r\n        phone: ''\r\n    });\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [success, setSuccess] = useState(false);\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        setLoading(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const res = await fetch('/api/admin/register', {\r\n                method: 'POST',\r\n                headers: { 'Content-Type': 'application/json' },\r\n                body: JSON.stringify(formData)\r\n            });\r\n\r\n            const data = await res.json();\r\n\r\n            if (!res.ok) {\r\n                throw new Error(data.error || 'Registration failed');\r\n            }\r\n\r\n            setSuccess(true);\r\n        } catch (err: any) {\r\n            setError(err.message);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (success) {\r\n        return (\r\n            <div className=\"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-900 p-4\">\r\n                <div className=\"max-w-md w-full bg-white dark:bg-slate-800 rounded-2xl shadow-xl p-8 text-center border border-green-100 dark:border-green-900/30\">\r\n                    <div className=\"w-16 h-16 bg-green-100 dark:bg-green-900/30 rounded-full flex items-center justify-center mx-auto mb-6\">\r\n                        <span className=\"material-icons-round text-3xl text-green-600 dark:text-green-400\">check_circle</span>\r\n                    </div>\r\n                    <h2 className=\"text-2xl font-bold text-slate-900 dark:text-white mb-2\">Registration Successful!</h2>\r\n                    <p className=\"text-slate-600 dark:text-slate-400 mb-6\">\r\n                        Your account has been created and is currently <strong>Pending Approval</strong>.\r\n                        <br />\r\n                        Please wait for an administrator to verify your details.\r\n                    </p>\r\n                    <Link href=\"/admin/login\" className=\"inline-block px-6 py-3 bg-primary text-white rounded-xl font-bold hover:shadow-lg transition-all\">\r\n                        Back to Login\r\n                    </Link>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    return (\r\n        <div className=\"flex items-center justify-center min-h-screen bg-slate-50 dark:bg-slate-900 py-12 px-4\">\r\n            <div className=\"w-full max-w-md bg-white dark:bg-slate-800 rounded-2xl shadow-xl border border-slate-100 dark:border-slate-700 p-8\">\r\n                <div className=\"text-center mb-8\">\r\n                    <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Merchant Registration</h1>\r\n                    <p className=\"text-slate-500 text-sm mt-2\">Join DailyFresh as a merchant</p>\r\n                </div>\r\n\r\n                <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                    {error && (\r\n                        <div className=\"p-3 text-sm text-red-500 bg-red-50 dark:bg-red-900/10 border border-red-100 dark:border-red-900/20 rounded-xl\">\r\n                            {error}\r\n                        </div>\r\n                    )}\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Full Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            required\r\n                            value={formData.full_name}\r\n                            onChange={(e) => setFormData({ ...formData, full_name: e.target.value })}\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all\"\r\n                            placeholder=\"John Doe\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Shop Name</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            required\r\n                            value={(formData as any).shop_name}\r\n                            onChange={(e) => setFormData({ ...formData, shop_name: e.target.value } as any)}\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all\"\r\n                            placeholder=\"My Awesome Store\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Email</label>\r\n                        <input\r\n                            type=\"email\"\r\n                            required\r\n                            value={formData.email}\r\n                            onChange={(e) => setFormData({ ...formData, email: e.target.value })}\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all\"\r\n                            placeholder=\"merchant@example.com\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Phone (Optional)</label>\r\n                        <input\r\n                            type=\"tel\"\r\n                            value={formData.phone}\r\n                            onChange={(e) => setFormData({ ...formData, phone: e.target.value })}\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all\"\r\n                            placeholder=\"+1 234 567 8900\"\r\n                        />\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium text-slate-700 dark:text-slate-300 mb-1\">Password</label>\r\n                        <input\r\n                            type=\"password\"\r\n                            required\r\n                            minLength={6}\r\n                            value={formData.password}\r\n                            onChange={(e) => setFormData({ ...formData, password: e.target.value })}\r\n                            className=\"w-full px-4 py-3 rounded-xl border border-slate-200 dark:border-slate-600 bg-white dark:bg-slate-700 text-slate-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/20 transition-all\"\r\n                            placeholder=\"ΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇóΓÇó\"\r\n                        />\r\n                    </div>\r\n\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={loading}\r\n                        className=\"w-full py-4 px-6 bg-primary text-white rounded-xl font-bold hover:bg-[#3d8b72] disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-primary/30\"\r\n                    >\r\n                        {loading ? 'Registering...' : 'Create Account'}\r\n                    </button>\r\n                </form>\r\n\r\n                <div className=\"mt-6 text-center\">\r\n                    <p className=\"text-sm text-slate-500\">\r\n                        Already have an account?{' '}\r\n                        <Link href=\"/admin/login\" className=\"text-primary font-bold hover:underline\">\r\n                            Login here\r\n                        </Link>\r\n                    </p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\reviews\\page.tsx","messages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\reviews\\page.tsx:37:9\n  35 |\n  36 |     useEffect(() => {\n> 37 |         loadData();\n     |         ^^^^^^^^ Avoid calling setState() directly within an effect\n  38 |     }, [filters]);\n  39 |\n  40 |     const handleToggleVisibility = async (reviewId: number, currentlyHidden: boolean) => {","line":37,"column":9,"nodeType":null,"endLine":37,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'loadData'. Either include it or remove the dependency array.","line":38,"column":8,"nodeType":"ArrayExpression","endLine":38,"endColumn":17,"suggestions":[{"desc":"Update the dependencies array to be: [filters, loadData]","fix":{"range":[1061,1070],"text":"[filters, loadData]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":209,"column":49,"nodeType":"JSXOpeningElement","endLine":213,"endColumn":51}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport {\r\n    getAllReviews,\r\n    toggleReviewVisibility,\r\n    deleteReview,\r\n    getReviewStatistics,\r\n    type AdminReview,\r\n    type ReviewFilters\r\n} from '@/actions/reviews';\r\n\r\nexport default function ReviewsPage() {\r\n    const [reviews, setReviews] = useState<AdminReview[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [stats, setStats] = useState({\r\n        totalReviews: 0,\r\n        hiddenReviews: 0,\r\n        averageRating: 0,\r\n        recentReviews: 0\r\n    });\r\n    const [filters, setFilters] = useState<ReviewFilters>({});\r\n    const [searchTerm, setSearchTerm] = useState('');\r\n\r\n    const loadData = async () => {\r\n        setLoading(true);\r\n        const [reviewsData, statsData] = await Promise.all([\r\n            getAllReviews({ ...filters, searchTerm }),\r\n            getReviewStatistics()\r\n        ]);\r\n        setReviews(reviewsData);\r\n        setStats(statsData);\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, [filters]);\r\n\r\n    const handleToggleVisibility = async (reviewId: number, currentlyHidden: boolean) => {\r\n        const result = await toggleReviewVisibility(reviewId, !currentlyHidden);\r\n        if (result.success) {\r\n            loadData();\r\n        } else {\r\n            alert(result.error);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (reviewId: number) => {\r\n        if (!confirm('Are you sure you want to delete this review?')) return;\r\n\r\n        const result = await deleteReview(reviewId);\r\n        if (result.success) {\r\n            loadData();\r\n        } else {\r\n            alert(result.error);\r\n        }\r\n    };\r\n\r\n    const handleSearch = () => {\r\n        setFilters({ ...filters, searchTerm });\r\n    };\r\n\r\n    return (\r\n        <div className=\"p-8\">\r\n            <h1 className=\"text-3xl font-bold mb-8\">Reviews Management</h1>\r\n\r\n            {/* Statistics Cards */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Total Reviews</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.totalReviews}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-blue-500\">rate_review</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Average Rating</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.averageRating.toFixed(1)}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-yellow-500\">star</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Hidden Reviews</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.hiddenReviews}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-red-500\">visibility_off</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                    <div className=\"flex items-center justify-between\">\r\n                        <div>\r\n                            <p className=\"text-sm text-slate-500 dark:text-slate-400\">Last 7 Days</p>\r\n                            <p className=\"text-2xl font-bold text-slate-900 dark:text-white\">{stats.recentReviews}</p>\r\n                        </div>\r\n                        <span className=\"material-icons-round text-3xl text-green-500\">trending_up</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Filters */}\r\n            <div className=\"bg-white dark:bg-slate-800 p-6 rounded-xl border border-slate-200 dark:border-slate-700 mb-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">Search</label>\r\n                        <div className=\"flex gap-2\">\r\n                            <input\r\n                                type=\"text\"\r\n                                value={searchTerm}\r\n                                onChange={(e) => setSearchTerm(e.target.value)}\r\n                                onKeyPress={(e) => e.key === 'Enter' && handleSearch()}\r\n                                placeholder=\"Product, user, comment...\"\r\n                                className=\"flex-1 px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700\"\r\n                            />\r\n                            <button\r\n                                onClick={handleSearch}\r\n                                className=\"px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90\"\r\n                            >\r\n                                Search\r\n                            </button>\r\n                        </div>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">Visibility</label>\r\n                        <select\r\n                            value={filters.isHidden === undefined ? 'all' : filters.isHidden ? 'hidden' : 'visible'}\r\n                            onChange={(e) => {\r\n                                const value = e.target.value;\r\n                                setFilters({\r\n                                    ...filters,\r\n                                    isHidden: value === 'all' ? undefined : value === 'hidden'\r\n                                });\r\n                            }}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700\"\r\n                        >\r\n                            <option value=\"all\">All</option>\r\n                            <option value=\"visible\">Visible</option>\r\n                            <option value=\"hidden\">Hidden</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">Rating</label>\r\n                        <select\r\n                            value={filters.rating || 'all'}\r\n                            onChange={(e) => {\r\n                                const value = e.target.value;\r\n                                setFilters({\r\n                                    ...filters,\r\n                                    rating: value === 'all' ? undefined : Number(value)\r\n                                });\r\n                            }}\r\n                            className=\"w-full px-4 py-2 rounded-lg border border-slate-300 dark:border-slate-600 bg-white dark:bg-slate-700\"\r\n                        >\r\n                            <option value=\"all\">All Ratings</option>\r\n                            <option value=\"5\">5 Stars</option>\r\n                            <option value=\"4\">4 Stars</option>\r\n                            <option value=\"3\">3 Stars</option>\r\n                            <option value=\"2\">2 Stars</option>\r\n                            <option value=\"1\">1 Star</option>\r\n                        </select>\r\n                    </div>\r\n\r\n                    <div>\r\n                        <label className=\"block text-sm font-medium mb-2\">&nbsp;</label>\r\n                        <button\r\n                            onClick={() => {\r\n                                setFilters({});\r\n                                setSearchTerm('');\r\n                            }}\r\n                            className=\"w-full px-4 py-2 bg-slate-200 dark:bg-slate-700 rounded-lg hover:bg-slate-300 dark:hover:bg-slate-600\"\r\n                        >\r\n                            Clear Filters\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Reviews List */}\r\n            <div className=\"bg-white dark:bg-slate-800 rounded-xl border border-slate-200 dark:border-slate-700\">\r\n                {loading ? (\r\n                    <div className=\"p-8 text-center\">\r\n                        <div className=\"inline-block w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n                    </div>\r\n                ) : reviews.length === 0 ? (\r\n                    <div className=\"p-8 text-center text-slate-500\">\r\n                        No reviews found\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"divide-y divide-slate-200 dark:divide-slate-700\">\r\n                        {reviews.map((review) => (\r\n                            <div key={review.id} className=\"p-6 hover:bg-slate-50 dark:hover:bg-slate-700/50 transition-colors\">\r\n                                <div className=\"flex items-start justify-between gap-4\">\r\n                                    <div className=\"flex-1\">\r\n                                        {/* Product Info */}\r\n                                        <div className=\"flex items-center gap-3 mb-3\">\r\n                                            {review.product?.images?.[0] && (\r\n                                                <img\r\n                                                    src={review.product.images[0]}\r\n                                                    alt={review.product.name}\r\n                                                    className=\"w-12 h-12 rounded-lg object-cover\"\r\n                                                />\r\n                                            )}\r\n                                            <div>\r\n                                                <h3 className=\"font-bold text-slate-900 dark:text-white\">\r\n                                                    {review.product?.name || 'Unknown Product'}\r\n                                                </h3>\r\n                                                <p className=\"text-sm text-slate-500\">\r\n                                                    by {review.User?.name || review.User?.email || 'Anonymous'}\r\n                                                </p>\r\n                                            </div>\r\n                                        </div>\r\n\r\n                                        {/* Rating */}\r\n                                        <div className=\"flex items-center gap-1 mb-2\">\r\n                                            {[...Array(5)].map((_, i) => (\r\n                                                <span\r\n                                                    key={i}\r\n                                                    className={`material-icons-round text-sm ${i < review.rating\r\n                                                        ? 'text-yellow-400'\r\n                                                        : 'text-slate-200 dark:text-slate-700'\r\n                                                        }`}\r\n                                                >\r\n                                                    star\r\n                                                </span>\r\n                                            ))}\r\n                                            <span className=\"text-sm text-slate-500 ml-2\">\r\n                                                {new Date(review.created_at).toLocaleDateString()}\r\n                                            </span>\r\n                                        </div>\r\n\r\n                                        {/* Comment */}\r\n                                        <p className=\"text-slate-600 dark:text-slate-300 mb-2\">\r\n                                            {review.comment}\r\n                                        </p>\r\n\r\n                                        {/* Status Badge */}\r\n                                        {review.is_hidden && (\r\n                                            <span className=\"inline-flex items-center gap-1 px-2 py-1 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 text-xs rounded-full\">\r\n                                                <span className=\"material-icons-round text-xs\">visibility_off</span>\r\n                                                Hidden\r\n                                            </span>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {/* Actions */}\r\n                                    <div className=\"flex gap-2\">\r\n                                        <button\r\n                                            onClick={() => handleToggleVisibility(review.id, review.is_hidden)}\r\n                                            className={`p-2 rounded-lg transition-colors ${review.is_hidden\r\n                                                ? 'bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 hover:bg-green-200'\r\n                                                : 'bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-400 hover:bg-yellow-200'\r\n                                                }`}\r\n                                            title={review.is_hidden ? 'Show review' : 'Hide review'}\r\n                                        >\r\n                                            <span className=\"material-icons-round text-lg\">\r\n                                                {review.is_hidden ? 'visibility' : 'visibility_off'}\r\n                                            </span>\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDelete(review.id)}\r\n                                            className=\"p-2 bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400 rounded-lg hover:bg-red-200 transition-colors\"\r\n                                            title=\"Delete review\"\r\n                                        >\r\n                                            <span className=\"material-icons-round text-lg\">delete</span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\settings\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\admin\\special-categories\\page.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":82,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":82,"endColumn":23},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'error' is defined but never used.","line":94,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":94,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":185,"column":45,"nodeType":"JSXOpeningElement","endLine":185,"endColumn":129},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":217,"column":45,"nodeType":"JSXOpeningElement","endLine":217,"endColumn":146}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { getSpecialCategories, createSpecialCategory, updateSpecialCategory, deleteSpecialCategory, uploadSpecialOfferImage } from '@/lib/api';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport default function SpecialCategoriesPage() {\r\n    const router = useRouter();\r\n    const [categories, setCategories] = useState<{ id: number, name: string, description?: string, image_url?: string }[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isSubmitting, setIsSubmitting] = useState(false);\r\n    const [formData, setFormData] = useState({ name: '', description: '', imageUrl: '' });\r\n\r\n    const [editingId, setEditingId] = useState<number | null>(null);\r\n\r\n    const loadData = async () => {\r\n        try {\r\n            const data = await getSpecialCategories();\r\n            setCategories(data);\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadData();\r\n    }, []);\r\n\r\n    const handleImageUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        if (!formData.name) {\r\n            alert('Please enter a Name first.');\r\n            e.target.value = ''; // Reset\r\n            return;\r\n        }\r\n\r\n        try {\r\n            setIsSubmitting(true); // Reuse submitting state for loading\r\n            const publicUrl = await uploadSpecialOfferImage(file, formData.name);\r\n            setFormData(prev => ({ ...prev, imageUrl: publicUrl }));\r\n        } catch (error) {\r\n            console.error('Upload failed:', error);\r\n            alert('Failed to upload image.');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (category: any) => {\r\n        setEditingId(category.id);\r\n        setFormData({\r\n            name: category.name,\r\n            description: category.description || '',\r\n            imageUrl: category.image_url || ''\r\n        });\r\n        window.scrollTo({ top: 0, behavior: 'smooth' });\r\n    };\r\n\r\n    const handleCancelEdit = () => {\r\n        setEditingId(null);\r\n        setFormData({ name: '', description: '', imageUrl: '' });\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!formData.name.trim()) return;\r\n\r\n        setIsSubmitting(true);\r\n        try {\r\n            if (editingId) {\r\n                await updateSpecialCategory(editingId, formData.name, formData.description, formData.imageUrl);\r\n            } else {\r\n                await createSpecialCategory(formData.name, formData.description, formData.imageUrl);\r\n            }\r\n            handleCancelEdit(); // Reset form\r\n            loadData();\r\n            router.refresh();\r\n        } catch (error) {\r\n            alert('Failed to save category. Ensure name is unique.');\r\n        } finally {\r\n            setIsSubmitting(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id: number) => {\r\n        if (!confirm('Are you sure? This will remove the tag from all associated products.')) return;\r\n        try {\r\n            await deleteSpecialCategory(id);\r\n            loadData();\r\n        } catch (error) {\r\n            alert('Failed to delete category');\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"space-y-6 max-w-5xl mx-auto\">\r\n            <div className=\"flex items-center justify-between\">\r\n                <div>\r\n                    <h1 className=\"text-2xl font-bold text-slate-900 dark:text-white\">Special Offers</h1>\r\n                    <p className=\"text-slate-500 dark:text-slate-400\">Manage flash deals, seasonal offers, and special tags.</p>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\r\n                {/* Create Form */}\r\n                <div className=\"md:col-span-1\">\r\n                    <div className=\"bg-white dark:bg-slate-800 p-6 rounded-2xl border border-slate-200 dark:border-slate-700 shadow-sm sticky top-6\">\r\n                        <div className=\"flex items-center justify-between mb-4\">\r\n                            <h3 className=\"font-bold text-lg text-slate-900 dark:text-white\">\r\n                                {editingId ? 'Edit Tag' : 'Add New Tag'}\r\n                            </h3>\r\n                            {editingId && (\r\n                                <button\r\n                                    onClick={handleCancelEdit}\r\n                                    className=\"text-xs text-red-500 hover:underline font-bold\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                            )}\r\n                        </div>\r\n                        <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1\">Name</label>\r\n                                <input\r\n                                    type=\"text\"\r\n                                    required\r\n                                    className=\"w-full px-4 py-2 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none\"\r\n                                    placeholder=\"e.g. Flash Deal\"\r\n                                    value={formData.name}\r\n                                    onChange={e => setFormData({ ...formData, name: e.target.value })}\r\n                                />\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1\">\r\n                                    Description (Optional)\r\n                                    <span className={`float-right text-xs ${formData.description.split(/\\s+/).filter(w => w).length > 20 ? 'text-red-500' : 'text-slate-400'}`}>\r\n                                        {formData.description.split(/\\s+/).filter(w => w).length} / 20 words\r\n                                    </span>\r\n                                </label>\r\n                                <textarea\r\n                                    className={`w-full px-4 py-2 rounded-xl bg-slate-50 dark:bg-slate-900 border focus:ring-2 outline-none ${formData.description.split(/\\s+/).filter(w => w).length > 20\r\n                                        ? 'border-red-500 focus:ring-red-500/20'\r\n                                        : 'border-slate-200 dark:border-slate-700 focus:ring-primary/20'\r\n                                        }`}\r\n                                    placeholder=\"Short description (max 20 words)...\"\r\n                                    rows={2}\r\n                                    value={formData.description}\r\n                                    onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                                />\r\n                                {formData.description.split(/\\s+/).filter(w => w).length > 20 && (\r\n                                    <p className=\"text-xs text-red-500 mt-1\">Description must be 20 words or less.</p>\r\n                                )}\r\n                            </div>\r\n                            <div>\r\n                                <label className=\"block text-sm font-bold text-slate-700 dark:text-slate-300 mb-1\">Offer Image (Optional)</label>\r\n                                <div className=\"space-y-2\">\r\n                                    <label className=\"flex items-center gap-2 cursor-pointer w-fit px-4 py-2 bg-primary/10 hover:bg-primary/20 rounded-lg transition-colors text-primary font-bold text-xs\">\r\n                                        <span className=\"material-symbols-outlined text-sm\">cloud_upload</span>\r\n                                        Upload Image\r\n                                        <input\r\n                                            type=\"file\"\r\n                                            accept=\"image/*\"\r\n                                            onChange={handleImageUpload}\r\n                                            className=\"hidden\"\r\n                                            disabled={isSubmitting}\r\n                                        />\r\n                                    </label>\r\n                                    <p className=\"text-[10px] text-slate-400\">\r\n                                        Supported formats: JPG, PNG, WebP. We recommend <span className=\"font-semibold text-slate-500\">WebP</span>.\r\n                                        Best size: <span className=\"font-medium text-blue-500\">800x440px</span> for sliders.\r\n                                    </p>\r\n                                    <input\r\n                                        type=\"url\"\r\n                                        className=\"w-full px-4 py-2 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-200 dark:border-slate-700 focus:ring-2 focus:ring-primary/20 outline-none\"\r\n                                        placeholder=\"https://...\"\r\n                                        value={formData.imageUrl}\r\n                                        onChange={e => setFormData({ ...formData, imageUrl: e.target.value })}\r\n                                    />\r\n                                    {formData.imageUrl && (\r\n                                        <div className=\"mt-2 w-full h-24 rounded-lg overflow-hidden border border-slate-200 dark:border-slate-700\">\r\n                                            <img src={formData.imageUrl} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                                        </div>\r\n                                    )}\r\n                                </div>\r\n                                <p className=\"text-xs text-slate-500 mt-1\">If provided, this offer will appear on the Home Page slider.</p>\r\n                            </div>\r\n                            <button\r\n                                type=\"submit\"\r\n                                disabled={isSubmitting || formData.description.split(/\\s+/).filter(w => w).length > 20}\r\n                                className=\"w-full py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-green-500/30 hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                {isSubmitting ? 'Saving...' : (editingId ? 'Update Tag' : 'Create Tag')}\r\n                            </button>\r\n                        </form>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* List */}\r\n                <div className=\"md:col-span-2 space-y-4\">\r\n                    {loading ? (\r\n                        <div className=\"text-center py-12 text-slate-500\">Loading...</div>\r\n                    ) : categories.length === 0 ? (\r\n                        <div className=\"bg-white dark:bg-slate-800 p-8 rounded-2xl border border-slate-200 dark:border-slate-700 text-center\">\r\n                            <span className=\"material-icons-round text-4xl text-slate-300 mb-2\">local_offer</span>\r\n                            <p className=\"text-slate-500\">No special categories found.</p>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"grid gap-4\">\r\n                            {categories.map(cat => (\r\n                                <div key={cat.id} className=\"bg-white dark:bg-slate-800 p-4 rounded-xl border border-slate-200 dark:border-slate-700 flex items-center justify-between group hover:shadow-md transition-all\">\r\n                                    <div className=\"flex items-center gap-4\">\r\n                                        {cat.image_url ? (\r\n                                            <img src={cat.image_url} alt={cat.name} className=\"w-16 h-10 object-cover rounded-lg bg-slate-100\" />\r\n                                        ) : (\r\n                                            <div className=\"w-10 h-10 rounded-full bg-yellow-100 dark:bg-yellow-900/30 flex items-center justify-center text-yellow-600 dark:text-yellow-400\">\r\n                                                <span className=\"material-icons-round\">local_offer</span>\r\n                                            </div>\r\n                                        )}\r\n                                        <div>\r\n                                            <h4 className=\"font-bold text-slate-900 dark:text-white flex items-center gap-2\">\r\n                                                {cat.name}\r\n                                                {cat.image_url && <span className=\"text-[10px] bg-green-100 text-green-700 px-1.5 py-0.5 rounded font-bold uppercase\">Slider Active</span>}\r\n                                            </h4>\r\n                                            {cat.description && <p className=\"text-sm text-slate-500 line-clamp-1\">{cat.description}</p>}\r\n                                        </div>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-2 opacity-0 group-hover:opacity-100 transition-opacity\">\r\n                                        <button\r\n                                            onClick={() => handleEdit(cat)}\r\n                                            className=\"p-2 text-slate-400 hover:text-blue-500 transition-colors\"\r\n                                            title=\"Edit\"\r\n                                        >\r\n                                            <span className=\"material-icons-round\">edit</span>\r\n                                        </button>\r\n                                        <button\r\n                                            onClick={() => handleDelete(cat.id)}\r\n                                            className=\"p-2 text-slate-400 hover:text-red-500 transition-colors\"\r\n                                            title=\"Delete\"\r\n                                        >\r\n                                            <span className=\"material-icons-round\">delete</span>\r\n                                        </button>\r\n                                    </div>\r\n                                </div>\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\api\\admin\\dashboard-stats\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'lowStockError' is assigned a value but never used.","line":24,"column":50,"nodeType":"Identifier","messageId":"unusedVar","endLine":24,"endColumn":63}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/supabaseAdmin';\r\n\r\nexport async function GET(request: Request) {\r\n    try {\r\n        const { searchParams } = new URL(request.url);\r\n        const role = searchParams.get('role');\r\n        const userId = searchParams.get('userId'); // Merchant ID if role is merchant\r\n\r\n        // --- SUPER ADMIN STATS ---\r\n        if (role !== 'MERCHANT') {\r\n            // 1. Total Merchants (from User table with role = MERCHANT)\r\n            const { count: merchantCount, error: merchantError } = await supabaseAdmin\r\n                .from('User')\r\n                .select('id', { count: 'exact', head: true })\r\n                .eq('role', 'MERCHANT');\r\n\r\n            if (merchantError) {\r\n                console.error('Error fetching merchant count:', merchantError);\r\n                throw merchantError;\r\n            }\r\n\r\n            // 2. Low Stock (Reuse logic or fetch here)\r\n            const { count: lowStockCount, error: lowStockError } = await supabaseAdmin\r\n                .from('products')\r\n                .select('id', { count: 'exact', head: true })\r\n                .lte('stock_quantity', 10) // Updated threshold to 10\r\n                .eq('is_deleted', false);\r\n\r\n            return NextResponse.json({\r\n                merchantCount: merchantCount || 0,\r\n                lowStockCount: lowStockCount || 0\r\n            });\r\n        }\r\n\r\n        // --- MERCHANT STATS ---\r\n        if (role === 'MERCHANT' && userId) {\r\n            // 1. Get Merchant Products\r\n            const { data: products, error: prodError } = await supabaseAdmin\r\n                .from('products')\r\n                .select('id, name, is_approved, sold_count, images')\r\n                .eq('merchant_id', userId)\r\n                .eq('is_deleted', false);\r\n\r\n            if (prodError) throw prodError;\r\n            const productIds = products.map(p => p.id);\r\n\r\n            // 2. Get Total Reviews for Merchant's Products\r\n            let totalReviews = 0;\r\n            if (productIds.length > 0) {\r\n                const { count: reviewCount, error: reviewError } = await supabaseAdmin\r\n                    .from('reviews')\r\n                    .select('id', { count: 'exact', head: true })\r\n                    .in('product_id', productIds);\r\n\r\n                if (!reviewError) totalReviews = reviewCount || 0;\r\n            }\r\n\r\n            // 3. Stats from Order Items\r\n            let totalEarnings = 0;\r\n            let totalOrders = 0;\r\n            let recentOrders: any[] = [];\r\n            let salesChartData: any[] = []; // Data for chart\r\n\r\n            if (productIds.length > 0) {\r\n                // Fetch order items with order details\r\n                const { data: orderItems, error: itemsError } = await supabaseAdmin\r\n                    .from('order_items')\r\n                    .select(`\r\n                        price, \r\n                        quantity, \r\n                        order_id,\r\n                        name,\r\n                        orders!inner (status, created_at)\r\n                    `)\r\n                    .in('product_id', productIds)\r\n                    .neq('orders.status', 'cancelled')\r\n                    .neq('orders.status', 'pending'); // Only count processed/delivered for earnings\r\n\r\n\r\n                if (!itemsError && orderItems) {\r\n                    const validItems = orderItems;\r\n\r\n                    totalEarnings = validItems.reduce((sum: number, item: any) => sum + (item.price * item.quantity), 0);\r\n                    totalOrders = new Set(validItems.map((i: any) => i.order_id)).size;\r\n\r\n                    // --- GENERATE CHART DATA (Last 30 Days) ---\r\n                    const salesMap = new Map<string, number>();\r\n\r\n                    // Initialize last 30 days\r\n                    for (let i = 29; i >= 0; i--) {\r\n                        const d = new Date();\r\n                        d.setDate(d.getDate() - i);\r\n                        salesMap.set(d.toLocaleDateString('en-US'), 0);\r\n                    }\r\n\r\n                    // Aggregate Valid Sales\r\n                    validItems.forEach((item: any) => {\r\n                        if (item.orders?.created_at) {\r\n                            const date = new Date(item.orders.created_at).toLocaleDateString('en-US');\r\n                            if (salesMap.has(date)) {\r\n                                salesMap.set(date, salesMap.get(date)! + (item.price * item.quantity));\r\n                            }\r\n                        }\r\n                    });\r\n\r\n                    // Sort by date manually to ensure order (Map iteration order is usually insertion order but better safe)\r\n                    salesChartData = Array.from(salesMap.entries())\r\n                        .map(([date, sales]) => ({\r\n                            name: date.split('/')[0] + '/' + date.split('/')[1], // MM/DD format\r\n                            sales: sales,\r\n                            fullDate: date\r\n                        }))\r\n                        .sort((a, b) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime());\r\n\r\n\r\n                    // --- RECENT ORDERS ---\r\n                    const processedOrderIds = new Set();\r\n                    recentOrders = [...orderItems]\r\n                        .sort((a: any, b: any) => new Date(b.orders.created_at).getTime() - new Date(a.orders.created_at).getTime())\r\n                        .map((item: any) => {\r\n                            if (processedOrderIds.has(item.order_id)) return null;\r\n                            processedOrderIds.add(item.order_id);\r\n                            return {\r\n                                id: item.order_id,\r\n                                product_name: item.name,\r\n                                date: item.orders.created_at,\r\n                                price: item.price * item.quantity,\r\n                                status: item.orders.status\r\n                            };\r\n                        })\r\n                        .filter(Boolean)\r\n                        .slice(0, 5);\r\n                }\r\n            }\r\n\r\n            return NextResponse.json({\r\n                totalEarnings,\r\n                totalOrders,\r\n                totalProducts: products.length,\r\n                totalReviews,\r\n                products: products,\r\n                recentOrders,\r\n                salesChartData\r\n            });\r\n        }\r\n\r\n        return NextResponse.json({ error: 'Invalid request parameters' }, { status: 400 });\r\n\r\n    } catch (error: any) {\r\n        console.error('Error in dashboard-stats API:', error);\r\n        return NextResponse.json({ error: error.message }, { status: 500 });\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\api\\admin\\merchants\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\api\\admin\\register\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\api\\admin\\verify\\route.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\api\\debug\\env\\route.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":16,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":17}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { NextResponse } from 'next/server';\r\nimport { supabaseAdmin } from '@/lib/supabaseAdmin';\r\n\r\nexport const dynamic = 'force-dynamic';\r\n\r\nexport async function GET() {\r\n    const serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\r\n    const url = process.env.NEXT_PUBLIC_SUPABASE_URL;\r\n\r\n    console.log('[DEBUG] Environment Check:');\r\n    console.log('- URL Present:', !!url);\r\n    console.log('- Service Key Present:', !!serviceKey);\r\n    console.log('- Service Key Length:', serviceKey ? serviceKey.length : 0);\r\n\r\n    // Test DB Connection\r\n    const { data, error } = await supabaseAdmin.from('User').select('count').limit(1).single();\r\n\r\n    return NextResponse.json({\r\n        env: {\r\n            urlPresent: !!url,\r\n            serviceKeyPresent: !!serviceKey,\r\n            serviceKeyLength: serviceKey ? serviceKey.length : 0\r\n        },\r\n        dbConnection: {\r\n            success: !error,\r\n            error: error\r\n        }\r\n    });\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\layout.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\loading.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\not-found.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\app\\page.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\ScrollReset.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\AdScrollerSettings.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":125,"column":33,"nodeType":"JSXOpeningElement","endLine":125,"endColumn":107}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\AdScrollerSettings.tsx:20:9\n  18 |     useEffect(() => {\n  19 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 20 |         loadAds();\n     |         ^^^^^^^ Avoid calling setState() directly within an effect\n  21 |     }, []);\n  22 |\n  23 |     const handleAdd = async (e: React.FormEvent) => {","line":20,"column":9,"nodeType":null,"endLine":20,"endColumn":16,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { AdScroll, getAds, createAd, updateAd, deleteAd, uploadAdImage } from '@/lib/api';\r\n\r\nexport function AdScrollerSettings() {\r\n    const [ads, setAds] = useState<AdScroll[]>([]);\r\n    const [newAdUrl, setNewAdUrl] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    const loadAds = async () => {\r\n        setLoading(true);\r\n        const data = await getAds(false);\r\n        setAds(data);\r\n        setLoading(false);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        loadAds();\r\n    }, []);\r\n\r\n    const handleAdd = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newAdUrl.trim()) return;\r\n\r\n        await createAd(newAdUrl);\r\n        setNewAdUrl('');\r\n        loadAds();\r\n    };\r\n\r\n    const handleToggle = async (id: number, current: boolean) => {\r\n        await updateAd(id, { active: !current });\r\n        loadAds();\r\n    };\r\n\r\n    const handleDelete = async (id: number) => {\r\n        if (!confirm('Are you sure you want to delete this ad?')) return;\r\n        await deleteAd(id);\r\n        loadAds();\r\n    };\r\n\r\n    const handleFileUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        try {\r\n            setLoading(true); // Re-use loading state or create a specific one\r\n            const publicUrl = await uploadAdImage(file);\r\n            await createAd(publicUrl);\r\n            loadAds(); // Reload list to show new image\r\n            // Reset input\r\n            e.target.value = '';\r\n        } catch (error) {\r\n            console.error('Upload failed:', error);\r\n            alert('Failed to upload image.');\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"rounded-2xl border border-slate-200 dark:border-[#1e3a31] bg-white dark:bg-[#10221c] p-6 shadow-xl\">\r\n            <h2 className=\"text-lg font-bold text-slate-900 dark:text-white mb-6\">\r\n                Ad Scroller Images\r\n            </h2>\r\n\r\n            {/* Add New Ad */}\r\n            <div className=\"mb-8 space-y-4\">\r\n                <div className=\"flex items-center gap-4\">\r\n                    <label className=\"flex items-center gap-2 cursor-pointer px-4 py-3 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 rounded-xl transition-colors text-slate-600 dark:text-slate-300 font-bold text-sm\">\r\n                        <span className=\"material-icons-round\">cloud_upload</span>\r\n                        Upload Image\r\n                        <input\r\n                            type=\"file\"\r\n                            accept=\"image/*\"\r\n                            onChange={handleFileUpload}\r\n                            className=\"hidden\"\r\n                            disabled={loading}\r\n                        />\r\n                    </label>\r\n                    <span className=\"text-slate-400 text-sm\">or</span>\r\n                </div>\r\n\r\n                <p className=\"text-xs text-blue-500 -mt-2 mb-1 font-medium pl-1\">\r\n                    Recommended Size: 800x440px. Aspect Ratio: ~1.8:1 (Landscape)\r\n                </p>\r\n                <p className=\"text-[10px] text-slate-400 mb-4 pl-1\">\r\n                    Supported formats: JPG, PNG, WebP. We recommend <span className=\"font-semibold text-slate-500\">WebP</span> for superior performance.\r\n                </p>\r\n\r\n                <form onSubmit={handleAdd} className=\"flex gap-4\">\r\n                    <input\r\n                        type=\"text\"\r\n                        value={newAdUrl}\r\n                        onChange={(e) => setNewAdUrl(e.target.value)}\r\n                        placeholder=\"Enter image URL manually...\"\r\n                        className=\"flex-1 px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white\"\r\n                    />\r\n                    <button\r\n                        type=\"submit\"\r\n                        disabled={!newAdUrl.trim()}\r\n                        className=\"px-6 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        Add URL\r\n                    </button>\r\n                </form>\r\n            </div>\r\n\r\n            {/* List */}\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                {loading ? (\r\n                    <div className=\"col-span-full text-center py-8 text-slate-500\">Loading ads...</div>\r\n                ) : ads.length === 0 ? (\r\n                    <div className=\"col-span-full text-center py-8 text-slate-500\">No ads found. Add an image URL above!</div>\r\n                ) : (\r\n                    ads.map((ad) => (\r\n                        <div\r\n                            key={ad.id}\r\n                            className={`flex items-start gap-4 p-4 rounded-xl border transition-all ${ad.active\r\n                                ? 'bg-white dark:bg-[#10221c] border-slate-200 dark:border-[#1e3a31]'\r\n                                : 'bg-slate-50 dark:bg-slate-800/50 border-slate-100 dark:border-slate-800 opacity-70'\r\n                                }`}\r\n                        >\r\n                            <div className=\"w-24 h-16 bg-slate-100 dark:bg-slate-800 rounded-lg overflow-hidden flex-shrink-0 relative border border-slate-200 dark:border-slate-700\">\r\n                                <img src={ad.image_url} alt=\"Ad\" className=\"w-full h-full object-cover\" />\r\n                            </div>\r\n\r\n                            <div className=\"flex-1 min-w-0\">\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 truncate mb-3\" title={ad.image_url}>\r\n                                    {ad.image_url}\r\n                                </p>\r\n                                <div className=\"flex items-center gap-2\">\r\n                                    <button\r\n                                        onClick={() => handleToggle(ad.id, ad.active)}\r\n                                        className={`px-3 py-1.5 rounded-lg text-xs font-bold transition-colors ${ad.active\r\n                                            ? 'bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400 hover:bg-green-200'\r\n                                            : 'bg-slate-200 text-slate-500 dark:bg-slate-700 dark:text-slate-300 hover:bg-slate-300'\r\n                                            }`}\r\n                                    >\r\n                                        {ad.active ? 'Active' : 'Inactive'}\r\n                                    </button>\r\n                                    <button\r\n                                        onClick={() => handleDelete(ad.id)}\r\n                                        className=\"p-1.5 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors ml-auto\"\r\n                                        title=\"Delete\"\r\n                                    >\r\n                                        <span className=\"material-icons-round text-lg\">delete</span>\r\n                                    </button>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\HeroSettings.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":265,"column":37,"nodeType":"JSXOpeningElement","endLine":265,"endColumn":122}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { getHeroSettings, updateHeroSettings, uploadHeroImage } from '@/lib/api';\r\n\r\nexport function HeroSettings() {\r\n    const [loading, setLoading] = useState(true);\r\n    const [saving, setSaving] = useState(false);\r\n    const [isEditing, setIsEditing] = useState(false);\r\n    const [formData, setFormData] = useState({\r\n        title: '',\r\n        subtitle: '',\r\n        description: '',\r\n        image_url: '',\r\n        button_text: '',\r\n        button_link: ''\r\n    });\r\n\r\n    // Keep track of original data to revert on cancel\r\n    const [originalData, setOriginalData] = useState(formData);\r\n\r\n    // Image Validation State\r\n    const [imageStatus, setImageStatus] = useState<{\r\n        type: 'idle' | 'loading' | 'valid' | 'warning' | 'error';\r\n        message: string;\r\n        details?: string;\r\n    }>({ type: 'idle', message: '' });\r\n\r\n    const handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        try {\r\n            setImageStatus({ type: 'loading', message: 'Uploading image...' });\r\n            const publicUrl = await uploadHeroImage(file);\r\n            setFormData(prev => ({ ...prev, image_url: publicUrl }));\r\n            setImageStatus({ type: 'valid', message: 'Image uploaded successfully!', details: 'You must save changes to apply.' });\r\n        } catch (error) {\r\n            console.error('Upload failed:', error);\r\n            setImageStatus({ type: 'error', message: 'Failed to upload image.' });\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        loadSettings();\r\n    }, []);\r\n\r\n    // Validate image whenever URL changes (debounce could be added but simpler here)\r\n    useEffect(() => {\r\n        if (!formData.image_url) {\r\n            setImageStatus({ type: 'idle', message: '' });\r\n            return;\r\n        }\r\n\r\n        const timeoutId = setTimeout(() => {\r\n            setImageStatus({ type: 'loading', message: 'Validating image...' });\r\n            const img = new Image();\r\n            img.onload = () => {\r\n                const ratio = img.width / img.height;\r\n                // Ideal ratio for hero is around 2:1 to 3:1 (landscape) or at least 1.5:1\r\n                // Warning if < 1 (portrait) or > 3 (too wide)\r\n                let type: 'valid' | 'warning' | 'error' = 'valid';\r\n                let msg = 'Image looks good!';\r\n\r\n                if (ratio < 1) {\r\n                    type = 'warning';\r\n                    msg = 'Image is Portrait (tall). It might be cropped significantly.';\r\n                } else if (ratio < 1.3) {\r\n                    type = 'warning';\r\n                    msg = 'Image is nearly square. Standard landscape (16:9) is recommended.';\r\n                } else if (ratio > 3.5) {\r\n                    type = 'warning';\r\n                    msg = 'Image is extremely wide/panoramic.';\r\n                }\r\n\r\n                setImageStatus({\r\n                    type,\r\n                    message: msg,\r\n                    details: `${img.width}x${img.height} (Ratio: ${ratio.toFixed(2)})`\r\n                });\r\n            };\r\n            img.onerror = () => {\r\n                setImageStatus({ type: 'error', message: 'Failed to load image. Check the URL.' });\r\n            };\r\n            img.src = formData.image_url;\r\n        }, 500); // 500ms debounce\r\n\r\n        return () => clearTimeout(timeoutId);\r\n    }, [formData.image_url]);\r\n\r\n    const loadSettings = async () => {\r\n        try {\r\n            const data = await getHeroSettings();\r\n            if (data) {\r\n                const newData = {\r\n                    title: data.title || '',\r\n                    subtitle: data.subtitle || '',\r\n                    description: data.description || '',\r\n                    image_url: data.image_url || '',\r\n                    button_text: data.button_text || '',\r\n                    button_link: data.button_link || ''\r\n                };\r\n                setFormData(newData);\r\n                setOriginalData(newData);\r\n            }\r\n        } catch (error) {\r\n            console.error('Failed to load settings:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        // Strict Validation Block\r\n        if (imageStatus.type === 'error') {\r\n            alert('Cannot save with an invalid image URL.');\r\n            return;\r\n        }\r\n\r\n        setSaving(true);\r\n        try {\r\n            await updateHeroSettings(formData);\r\n            setOriginalData(formData); // Update original data on success\r\n            setIsEditing(false);\r\n            alert('Settings saved successfully!');\r\n        } catch (error) {\r\n            console.error('Failed to save settings:', error);\r\n            alert('Failed to save settings');\r\n        } finally {\r\n            setSaving(false);\r\n        }\r\n    };\r\n\r\n    const handleCancel = () => {\r\n        setFormData(originalData);\r\n        setIsEditing(false);\r\n    };\r\n\r\n    if (loading) return <div className=\"p-8 text-center text-slate-500\">Loading settings...</div>;\r\n\r\n    const InputCounter = ({ current, max }: { current: number, max: number }) => (\r\n        isEditing ? (\r\n            <span className={`text-xs font-bold ml-auto ${current > max ? 'text-red-500' : 'text-slate-400'}`}>\r\n                {current}/{max}\r\n            </span>\r\n        ) : null\r\n    );\r\n\r\n    const inputClasses = `w-full px-4 py-3 rounded-xl transition-all ${isEditing\r\n        ? 'bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white'\r\n        : 'bg-transparent border border-transparent px-0 font-medium text-slate-900 dark:text-white cursor-default'\r\n        }`;\r\n\r\n    return (\r\n        <div className={`rounded-2xl border transition-colors p-6 ${isEditing ? 'bg-white dark:bg-[#10221c] border-slate-200 dark:border-[#1e3a31] shadow-xl' : 'bg-white/50 dark:bg-[#10221c]/50 border-transparent'}`}>\r\n            <div className=\"flex justify-between items-center mb-6 pb-4 border-b border-slate-100 dark:border-[#1e3a31]\">\r\n                <h2 className=\"text-lg font-bold text-slate-900 dark:text-white\">\r\n                    Hero Section\r\n                </h2>\r\n                {!isEditing && (\r\n                    <button\r\n                        onClick={() => setIsEditing(true)}\r\n                        className=\"px-4 py-2 bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 font-bold rounded-lg transition-colors flex items-center gap-2\"\r\n                    >\r\n                        <span className=\"material-icons-round text-sm\">edit</span>\r\n                        Edit\r\n                    </button>\r\n                )}\r\n            </div>\r\n\r\n            <form onSubmit={handleSave} className=\"space-y-6\">\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2 flex flex-col\">\r\n                        <div className=\"flex justify-between h-5\">\r\n                            <label className=\"text-sm font-bold text-slate-500 uppercase\">Title</label>\r\n                            <InputCounter current={formData.title.length} max={60} />\r\n                        </div>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.title}\r\n                            maxLength={60}\r\n                            disabled={!isEditing}\r\n                            onChange={e => setFormData({ ...formData, title: e.target.value })}\r\n                            className={inputClasses}\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2 flex flex-col\">\r\n                        <div className=\"flex justify-between h-5\">\r\n                            <label className=\"text-sm font-bold text-slate-500 uppercase\">Subtitle</label>\r\n                            <InputCounter current={formData.subtitle.length} max={40} />\r\n                        </div>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.subtitle}\r\n                            maxLength={40}\r\n                            disabled={!isEditing}\r\n                            onChange={e => setFormData({ ...formData, subtitle: e.target.value })}\r\n                            className={inputClasses}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-2 flex flex-col\">\r\n                    <div className=\"flex justify-between h-5\">\r\n                        <label className=\"text-sm font-bold text-slate-500 uppercase\">Description</label>\r\n                        <InputCounter current={formData.description.length} max={200} />\r\n                    </div>\r\n                    <textarea\r\n                        rows={3}\r\n                        value={formData.description}\r\n                        maxLength={200}\r\n                        disabled={!isEditing}\r\n                        onChange={e => setFormData({ ...formData, description: e.target.value })}\r\n                        className={`${inputClasses} resize-none`}\r\n                    />\r\n                </div>\r\n\r\n                <div className=\"space-y-2\">\r\n                    <label className=\"text-sm font-bold text-slate-500 uppercase h-5 block\">Hero Image</label>\r\n\r\n                    {isEditing && (\r\n                        <div className=\"mb-4\">\r\n                            <label className=\"block w-full cursor-pointer\">\r\n                                <span className=\"sr-only\">Choose file</span>\r\n                                <input\r\n                                    type=\"file\"\r\n                                    accept=\"image/*\"\r\n                                    onChange={handleFileChange}\r\n                                    className=\"block w-full text-sm text-slate-500\r\n                                        file:mr-4 file:py-2.5 file:px-4\r\n                                        file:rounded-xl file:border-0\r\n                                        file:text-sm file:font-semibold\r\n                                        file:bg-primary/10 file:text-primary\r\n                                        hover:file:bg-primary/20\r\n                                        cursor-pointer disabled:opacity-50\r\n                                    \"\r\n                                    disabled={imageStatus.type === 'loading'}\r\n                                />\r\n                            </label>\r\n                            <p className=\"text-xs text-blue-500 mt-2 font-medium\">Recommended Size: 960x600px (or larger). Aspect Ratio: ~1.6:1 (Landscape)</p>\r\n                            <p className=\"text-[10px] text-slate-400 mt-1\">\r\n                                Supported formats: JPG, PNG, WebP. We recommend <span className=\"font-semibold text-slate-500\">WebP</span> for superior performance.\r\n                            </p>\r\n                            <p className=\"text-xs text-slate-400 mt-2\">or enter URL manually below</p>\r\n                        </div>\r\n                    )}\r\n\r\n                    <div className=\"flex flex-col gap-4\">\r\n                        <div className=\"flex gap-4\">\r\n                            {isEditing ? (\r\n                                <input\r\n                                    type=\"text\"\r\n                                    placeholder=\"https://...\"\r\n                                    value={formData.image_url}\r\n                                    onChange={e => setFormData({ ...formData, image_url: e.target.value })}\r\n                                    className={`flex-1 ${inputClasses} ${imageStatus.type === 'error' ? 'border-red-500 focus:ring-red-500/50' :\r\n                                        imageStatus.type === 'warning' ? 'border-yellow-500 focus:ring-yellow-500/50' : ''\r\n                                        }`}\r\n                                />\r\n                            ) : null}\r\n                            {formData.image_url && (\r\n                                <div className={`rounded-lg bg-slate-100 dark:bg-slate-800 overflow-hidden shrink-0 border border-slate-200 dark:border-slate-700 relative group ${isEditing ? 'w-12 h-12' : 'w-full h-64 shadow-inner'}`}>\r\n                                    <img src={formData.image_url} alt=\"Preview\" className=\"w-full h-full object-cover\" />\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        {/* Image Validation Feedback (Only when editing) */}\r\n                        {isEditing && formData.image_url && imageStatus.type !== 'idle' && (\r\n                            <div className={`px-4 py-3 rounded-xl text-sm font-medium flex items-center gap-2 ${imageStatus.type === 'error' ? 'bg-red-50 text-red-600' :\r\n                                imageStatus.type === 'warning' ? 'bg-yellow-50 text-yellow-700' :\r\n                                    imageStatus.type === 'loading' ? 'bg-slate-50 text-slate-500' :\r\n                                        'bg-green-50 text-green-700'\r\n                                }`}>\r\n                                <span className=\"material-icons-round text-lg\">\r\n                                    {imageStatus.type === 'error' ? 'error' :\r\n                                        imageStatus.type === 'warning' ? 'warning' :\r\n                                            imageStatus.type === 'loading' ? 'sync' : 'check_circle'}\r\n                                </span>\r\n                                <div className=\"flex-1\">\r\n                                    <p>{imageStatus.message}</p>\r\n                                    {imageStatus.details && <p className=\"text-xs opacity-80 mt-0.5 font-bold uppercase tracking-wide\">{imageStatus.details}</p>}\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                    <div className=\"space-y-2 flex flex-col\">\r\n                        <div className=\"flex justify-between h-5\">\r\n                            <label className=\"text-sm font-bold text-slate-500 uppercase\">Button Text</label>\r\n                            <InputCounter current={formData.button_text.length} max={20} />\r\n                        </div>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.button_text}\r\n                            maxLength={20}\r\n                            disabled={!isEditing}\r\n                            onChange={e => setFormData({ ...formData, button_text: e.target.value })}\r\n                            className={inputClasses}\r\n                        />\r\n                    </div>\r\n                    <div className=\"space-y-2\">\r\n                        <label className=\"text-sm font-bold text-slate-500 uppercase h-5 block\">Button Link</label>\r\n                        <input\r\n                            type=\"text\"\r\n                            value={formData.button_link}\r\n                            disabled={!isEditing}\r\n                            onChange={e => setFormData({ ...formData, button_link: e.target.value })}\r\n                            className={inputClasses}\r\n                        />\r\n                    </div>\r\n                </div>\r\n\r\n                {isEditing && (\r\n                    <div className=\"pt-4 flex justify-end gap-3 animate-in fade-in slide-in-from-bottom-2\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={handleCancel}\r\n                            className=\"px-6 py-3 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors\"\r\n                        >\r\n                            Cancel\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={saving || imageStatus.type === 'error'}\r\n                            className=\"px-8 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                            {saving ? 'Saving...' : 'Save Changes'}\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\MerchantProfileSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\NoticeSettings.tsx","messages":[{"ruleId":null,"message":"Unused eslint-disable directive (no problems were reported from 'react-hooks/set-state-in-effect').","line":32,"column":9,"severity":1,"nodeType":null,"fix":{"range":[1154,1213],"text":" "}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":1,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Notice, getNotices, createNotice, updateNotice, deleteNotice, getHeroSettings, updateHeroSettings } from '@/lib/api';\r\n\r\nexport function NoticeSettings() {\r\n    const [notices, setNotices] = useState<Notice[]>([]);\r\n    const [newNotice, setNewNotice] = useState('');\r\n    const [loading, setLoading] = useState(true);\r\n    const [showScroller, setShowScroller] = useState(true);\r\n    const [savingVisibility, setSavingVisibility] = useState(false);\r\n\r\n    const loadNotices = async () => {\r\n        setLoading(true);\r\n        const data = await getNotices(false); // Fetch all, including inactive\r\n        setNotices(data);\r\n        setLoading(false);\r\n    };\r\n\r\n    const loadSettings = async () => {\r\n        try {\r\n            const settings = await getHeroSettings();\r\n            setShowScroller(settings.show_notice_scroller !== false);\r\n        } catch (error) {\r\n            console.error('Error loading settings:', error);\r\n            // Default to true if column doesn't exist yet\r\n            setShowScroller(true);\r\n        }\r\n    };\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        loadNotices();\r\n        loadSettings();\r\n    }, []);\r\n\r\n    const handleAdd = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!newNotice.trim()) return;\r\n\r\n        await createNotice(newNotice);\r\n        setNewNotice('');\r\n        loadNotices();\r\n    };\r\n\r\n    const handleToggle = async (id: number, current: boolean) => {\r\n        await updateNotice(id, { active: !current });\r\n        loadNotices();\r\n    };\r\n\r\n    const handleDelete = async (id: number) => {\r\n        if (!confirm('Are you sure you want to delete this notice?')) return;\r\n        await deleteNotice(id);\r\n        loadNotices();\r\n    };\r\n\r\n    const handleToggleVisibility = async () => {\r\n        setSavingVisibility(true);\r\n        try {\r\n            await updateHeroSettings({ show_notice_scroller: !showScroller });\r\n            setShowScroller(!showScroller);\r\n        } catch (error: any) {\r\n            console.error('Failed to update visibility:', error);\r\n            if (error.message?.includes('show_notice_scroller')) {\r\n                alert('Please run the SQL script \"add_notice_visibility_toggle.sql\" in Supabase to add the required database column.');\r\n            } else {\r\n                alert('Failed to update visibility: ' + (error.message || 'Unknown error'));\r\n            }\r\n        } finally {\r\n            setSavingVisibility(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"rounded-2xl border border-slate-200 dark:border-[#1e3a31] bg-white dark:bg-[#10221c] p-6 shadow-xl\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <h2 className=\"text-lg font-bold text-slate-900 dark:text-white\">\r\n                    Notice Scroller\r\n                </h2>\r\n                <button\r\n                    onClick={handleToggleVisibility}\r\n                    disabled={savingVisibility}\r\n                    className={`flex items-center gap-2 px-4 py-2 rounded-lg font-medium transition-all ${showScroller\r\n                        ? 'bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400'\r\n                        : 'bg-slate-100 dark:bg-slate-800 text-slate-500'\r\n                        } hover:opacity-80 disabled:opacity-50`}\r\n                    title={showScroller ? 'Hide notice scroller from main site' : 'Show notice scroller on main site'}\r\n                >\r\n                    <span className=\"material-icons-round text-sm\">\r\n                        {showScroller ? 'visibility' : 'visibility_off'}\r\n                    </span>\r\n                    {showScroller ? 'Visible on Site' : 'Hidden from Site'}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Add New Notice */}\r\n            <form onSubmit={handleAdd} className=\"flex gap-4 mb-8\">\r\n                <input\r\n                    type=\"text\"\r\n                    value={newNotice}\r\n                    onChange={(e) => setNewNotice(e.target.value)}\r\n                    placeholder=\"Enter new notice text...\"\r\n                    className=\"flex-1 px-4 py-3 rounded-xl bg-slate-50 dark:bg-slate-800 border border-slate-200 dark:border-slate-700 focus:outline-none focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white\"\r\n                />\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={!newNotice.trim()}\r\n                    className=\"px-6 py-3 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/20 hover:bg-primary/90 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                >\r\n                    Add\r\n                </button>\r\n            </form>\r\n\r\n            {/* List */}\r\n            <div className=\"space-y-3\">\r\n                {loading ? (\r\n                    <div className=\"text-center py-8 text-slate-500\">Loading notices...</div>\r\n                ) : notices.length === 0 ? (\r\n                    <div className=\"text-center py-8 text-slate-500\">No notices found. Add one above!</div>\r\n                ) : (\r\n                    notices.map((notice) => (\r\n                        <div\r\n                            key={notice.id}\r\n                            className={`flex items-center justify-between p-4 rounded-xl border transition-all ${notice.active\r\n                                ? 'bg-primary/5 border-primary/20'\r\n                                : 'bg-slate-50 dark:bg-slate-800/50 border-slate-100 dark:border-slate-800 opacity-70'\r\n                                }`}\r\n                        >\r\n                            <span className={`font-medium ${notice.active ? 'text-slate-900 dark:text-white' : 'text-slate-500 line-through'}`}>\r\n                                {notice.text}\r\n                            </span>\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <button\r\n                                    onClick={() => handleToggle(notice.id, notice.active)}\r\n                                    className={`p-2 rounded-lg transition-colors ${notice.active\r\n                                        ? 'text-green-600 hover:bg-green-100 dark:hover:bg-green-900/30'\r\n                                        : 'text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'\r\n                                        }`}\r\n                                    title={notice.active ? \"Deactivate\" : \"Activate\"}\r\n                                >\r\n                                    <span className=\"material-icons-round text-xl\">\r\n                                        {notice.active ? 'check_circle' : 'remove_circle_outline'}\r\n                                    </span>\r\n                                </button>\r\n                                <button\r\n                                    onClick={() => handleDelete(notice.id)}\r\n                                    className=\"p-2 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors\"\r\n                                    title=\"Delete\"\r\n                                >\r\n                                    <span className=\"material-icons-round text-xl\">delete</span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n                    ))\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\NotificationDropdown.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\admin\\SuperadminAccountSettings.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\cart\\CartItem.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":25,"column":21,"nodeType":"JSXOpeningElement","endLine":29,"endColumn":23}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useCart, CartItem as CartItemType } from '@/context/CartContext';\r\nimport { formatPrice } from '@/lib/format';\r\nimport Link from 'next/link';\r\n\r\ninterface CartItemProps {\r\n    item: CartItemType;\r\n}\r\n\r\nexport function CartItem({ item }: CartItemProps) {\r\n    const { updateQuantity, removeItem } = useCart();\r\n\r\n    // Map category to color roughly matching the HTML example logic\r\n    const categoryColor =\r\n        item.category === 'Organic' ? 'text-primary' :\r\n            item.category === 'Dairy' ? 'text-blue-500' :\r\n                item.category === 'Bakery' ? 'text-orange-500' : 'text-gray-500';\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-xl p-5 shadow-[0_4px_20px_-2px_rgba(0,0,0,0.05)] border border-slate-100 dark:border-slate-700 flex items-center gap-6 group transition-all hover:border-primary/20\">\r\n            {/* Image */}\r\n            <div className=\"w-24 h-24 rounded-lg bg-slate-50 dark:bg-slate-700 overflow-hidden flex-shrink-0 border border-slate-100 dark:border-slate-600\">\r\n                <Link href={`/product/${item.id}`}>\r\n                    <img\r\n                        className=\"w-full h-full object-contain group-hover:scale-105 transition-transform duration-500\"\r\n                        alt={item.name}\r\n                        src={item.images && item.images.length > 0 ? item.images[0] : ''}\r\n                    />\r\n                </Link>\r\n            </div>\r\n\r\n            {/* Info */}\r\n            <div className=\"flex flex-1 flex-col gap-1\">\r\n                {item.category && (\r\n                    <span className={`text-xs font-bold ${categoryColor} uppercase tracking-wider`}>{item.category}</span>\r\n                )}\r\n                <Link href={`/product/${item.id}`}>\r\n                    <h3 className=\"text-lg font-bold text-slate-900 dark:text-white line-clamp-1 hover:text-primary transition-colors\">{item.name}</h3>\r\n                </Link>\r\n                {item.pack && <p className=\"text-sm text-slate-500 dark:text-slate-400\">{item.pack}</p>}\r\n\r\n                {/* Mobile Controls */}\r\n                <div className=\"mt-2 flex items-center lg:hidden gap-4\">\r\n                    <div className=\"flex items-center bg-slate-100 dark:bg-slate-900 rounded-lg p-1 border border-slate-200 dark:border-slate-700\">\r\n                        <button\r\n                            onClick={() => updateQuantity(item.id, -1)}\r\n                            className=\"w-8 h-8 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 transition-all text-slate-500 dark:text-slate-400\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">remove</span>\r\n                        </button>\r\n                        <span className=\"w-8 text-center font-bold text-slate-900 dark:text-white font-mono\">{item.quantity}</span>\r\n                        <button\r\n                            onClick={() => updateQuantity(item.id, 1)}\r\n                            className=\"w-8 h-8 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 transition-all text-primary\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">add</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Desktop Controls (Quantity) */}\r\n                <div className=\"mt-2 hidden lg:flex items-center gap-4\">\r\n                    <div className=\"flex items-center bg-slate-100 dark:bg-slate-900 rounded-lg p-1 border border-slate-200 dark:border-slate-700\">\r\n                        <button\r\n                            onClick={() => updateQuantity(item.id, -1)}\r\n                            className=\"w-8 h-8 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 transition-all text-slate-500 dark:text-slate-400\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">remove</span>\r\n                        </button>\r\n                        <span className=\"w-8 text-center font-bold text-slate-900 dark:text-white font-mono\">{item.quantity}</span>\r\n                        <button\r\n                            onClick={() => updateQuantity(item.id, 1)}\r\n                            className=\"w-8 h-8 flex items-center justify-center rounded-md hover:bg-white dark:hover:bg-slate-700 transition-all text-primary\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">add</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n\r\n            </div>\r\n\r\n            {/* Price & Remove (Desktop) */}\r\n            <div className=\"hidden lg:flex flex-col items-end gap-1 min-w-[100px]\">\r\n                <span className=\"text-xl font-bold text-slate-900 dark:text-white tracking-tight\">{formatPrice(item.price * item.quantity)}</span>\r\n                <button\r\n                    onClick={() => removeItem(item.id)}\r\n                    className=\"text-xs font-semibold text-slate-400 hover:text-red-500 transition-colors flex items-center gap-1 group/delete\"\r\n                >\r\n                    <span className=\"material-icons-round text-sm group-hover/delete:animate-bounce\">delete</span>\r\n                    Remove\r\n                </button>\r\n            </div>\r\n            {/* Price & Remove (Mobile) */}\r\n            <div className=\"flex lg:hidden flex-col items-end gap-1\">\r\n                <span className=\"text-lg font-bold text-slate-900 dark:text-white\">{formatPrice(item.price * item.quantity)}</span>\r\n                <button\r\n                    onClick={() => removeItem(item.id)}\r\n                    className=\"p-2 bg-red-50 text-red-500 rounded-full\"\r\n                >\r\n                    <span className=\"material-icons-round text-sm\">delete</span>\r\n                </button>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\cart\\OrderSummary.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'createOrder' is defined but never used.","line":5,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":21,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"createOrder"},"fix":{"range":[117,157],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'clearCart' is assigned a value but never used.","line":11,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":11,"endColumn":41},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'setIsCheckingOut' is assigned a value but never used.","line":14,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":14,"endColumn":43},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":89,"column":25,"nodeType":"JSXOpeningElement","endLine":89,"endColumn":387},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":90,"column":25,"nodeType":"JSXOpeningElement","endLine":90,"endColumn":393},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":91,"column":25,"nodeType":"JSXOpeningElement","endLine":91,"endColumn":389},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":92,"column":25,"nodeType":"JSXOpeningElement","endLine":92,"endColumn":392}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":7,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useCart } from '@/context/CartContext';\r\nimport { createOrder } from '@/lib/api';\r\nimport { formatPrice } from '@/lib/format';\r\nimport { useRouter } from 'next/navigation';\r\nimport { useState } from 'react';\r\n\r\nexport function OrderSummary() {\r\n    const { totalPrice, items, clearCart } = useCart();\r\n    const { user } = useAuth();\r\n    const router = useRouter();\r\n    const [isCheckingOut, setIsCheckingOut] = useState(false);\r\n\r\n    // Logic from HTML: Delivery Fee + Estimated Tax mocking\r\n    const deliveryFee = 4.99;\r\n    const estimatedTax = 1.25;\r\n    const finalTotal = totalPrice + deliveryFee + estimatedTax;\r\n\r\n    const handleCheckout = () => {\r\n        if (!user) {\r\n            router.push('/login?redirect=/checkout');\r\n            return;\r\n        }\r\n        if (items.length === 0) return;\r\n\r\n        router.push('/checkout');\r\n    };\r\n\r\n    return (\r\n        <div className=\"lg:w-[380px]\">\r\n            <div className=\"sticky top-28 bg-white dark:bg-slate-800 rounded-xl p-6 shadow-[0_4px_20px_-2px_rgba(0,0,0,0.05)] border border-slate-100 dark:border-slate-700\">\r\n                <h2 className=\"text-xl font-extrabold mb-6 tracking-tight text-slate-900 dark:text-white\">Order Summary</h2>\r\n\r\n                <div className=\"flex flex-col gap-4 mb-6\">\r\n                    <div className=\"flex justify-between items-center text-slate-500 dark:text-slate-400\">\r\n                        <span className=\"text-sm\">Subtotal</span>\r\n                        <span className=\"text-base font-bold text-slate-900 dark:text-white\">{formatPrice(totalPrice)}</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center text-slate-500 dark:text-slate-400\">\r\n                        <span className=\"text-sm\">Delivery Fee</span>\r\n                        <span className=\"text-base font-bold text-slate-900 dark:text-white\">{formatPrice(deliveryFee)}</span>\r\n                    </div>\r\n                    <div className=\"flex justify-between items-center text-slate-500 dark:text-slate-400\">\r\n                        <span className=\"text-sm\">Estimated Tax</span>\r\n                        <span className=\"text-base font-bold text-slate-900 dark:text-white\">{formatPrice(estimatedTax)}</span>\r\n                    </div>\r\n\r\n                    <div className=\"h-px bg-slate-100 dark:bg-slate-700 my-2\"></div>\r\n\r\n                    <div className=\"flex justify-between items-center text-slate-900 dark:text-white\">\r\n                        <span className=\"text-lg font-extrabold\">Total</span>\r\n                        <span className=\"text-2xl font-extrabold text-primary\">{formatPrice(finalTotal)}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"space-y-4\">\r\n                    <button\r\n                        onClick={handleCheckout}\r\n                        disabled={isCheckingOut || items.length === 0}\r\n                        className=\"w-full py-4 bg-primary text-white rounded-xl font-bold text-lg hover:shadow-lg hover:shadow-primary/20 transition-all flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                    >\r\n                        {isCheckingOut ? (\r\n                            <div className=\"w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin\" />\r\n                        ) : (\r\n                            <>\r\n                                Proceed to Checkout\r\n                                <span className=\"material-icons-round\">arrow_forward</span>\r\n                            </>\r\n                        )}\r\n                    </button>\r\n\r\n                    <div className=\"flex flex-col gap-4\">\r\n                        <div className=\"relative\">\r\n                            <input\r\n                                className=\"w-full h-11 pl-4 pr-16 rounded-lg border-slate-200 dark:border-slate-700 bg-transparent text-sm focus:ring-primary focus:border-primary outline-none border text-slate-900 dark:text-white\"\r\n                                placeholder=\"Promo code\"\r\n                                type=\"text\"\r\n                            />\r\n                            <button className=\"absolute right-2 top-1/2 -translate-y-1/2 text-primary font-bold text-sm px-2\">Apply</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-8 pt-6 border-t border-slate-100 dark:border-slate-700\">\r\n                    <p className=\"text-[10px] uppercase font-bold text-slate-400 tracking-widest text-center mb-4\">Secure Checkout</p>\r\n                    <div className=\"flex justify-center gap-4 opacity-50 grayscale hover:grayscale-0 transition-all\">\r\n                        <img className=\"h-4\" alt=\"Visa\" src=\"https://lh3.googleusercontent.com/aida-public/AB6AXuBtqruSyorBS-qgfx7ZoReMc3mmdTe-w9BBSbiVuhIwpUB7-q20ajX_tksDVLj-KKypcWJgQyglxZwoORA4te4uCIZnMnyVgImwozx4QoR0VzFNvjQeNVfWCFv2__ZAtt-y10I1MS6OZt1b5NFtaGGPYM7k6LVLrR6E0bAs2fWpAhzfP__ZqrxAOBOgQHnCc5D3ZNc2xAN7fNZMZfTV0dACWdLnW1n3dkIWPAvZ4hZvW9ToauEkgYO5AddPLzWkCHjrK08z-lqpCTU\" />\r\n                        <img className=\"h-6\" alt=\"Mastercard\" src=\"https://lh3.googleusercontent.com/aida-public/AB6AXuBLclIV06NUwPBe-33dwYFtkIXvujXO979UjeN5gkMvod7dLm1_-TD-jPdrtjrr1PUbLtd4M1r7SvAw71lPQfWEtqgo355P_0UenPPhLpZ8_7p6s6jBxyknPBLFFVz2TLTerdTjee4Y2uY4wHxNi1fsaNs7JjgpXPLdnzWSvuvfQ5UI62yePM6ZX5gJtzKQdJex2GA8Ofgjl-7EPpMOy6VumJbUUYfl17McVTokvgPBP20Bh__oqU4iLNn0h18Xkh_Qih_cR3wanUA\" />\r\n                        <img className=\"h-4\" alt=\"Paypal\" src=\"https://lh3.googleusercontent.com/aida-public/AB6AXuCYj4A4ze3Art3EWZBFpEtaRkbA4Ld_UV8wHrXTy7nbvaLII24da1tm1esO9pa80ODkjriF3L0kHgBOH1LVWPzd42qIOzWHm0jB0vkXHv8l44CBzSI6sg16YE6W8teC3jdMQqayLf-e1nsh0n-M3IRc9hCXfBVG0G8opKo3Jy7q0RKHwEtVVtA8EPkajrcqzjjAKJ8dxS59cKpEgp9GTixletgQ5V4DE4h2o0uZ4q0md5NyOx-w99CcwyyBrR8mUHhe2f7K1DhdaBQ\" />\r\n                        <img className=\"h-4\" alt=\"Apple Pay\" src=\"https://lh3.googleusercontent.com/aida-public/AB6AXuCWmswRRX9jYZCiUX5GmHzpqOsPo0S4sYAXpvEdhM3Npy_q4JPGPYGPup162KR-VM4cqRdIYO_1c6LeK5Fbvm0WOxdDLg2dE_AIFt5ySrrXkakBhqgymzla85Zw0YobgEJ2KZBucCcMCyUA1G9M8jnWL_u0AZdueXPKmtRitVQ8ydG6Gm9qwWymNgQuSrIZAtsEQGMerfw6Ie9ZDLFe6CfkOdm1ulJU3rq5sqSXhrz-nKYc_mEV_-muznZ81TvEKtSQ9I_GX4djFtM\" />\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\cart\\RecentlyViewed.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\CategoryHero.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\CategoryView.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":16,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":16,"endColumn":17}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\CategoryView.tsx:38:9\n  36 |     useEffect(() => {\n  37 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 38 |         setPriceRange({ min: globalMinPrice, max: globalMaxPrice });\n     |         ^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  39 |     }, [globalMinPrice, globalMaxPrice]);\n  40 |\n  41 |     // Loading State","line":38,"column":9,"nodeType":null,"endLine":38,"endColumn":22,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\CategoryView.tsx:113:9\n  111 |     useEffect(() => {\n  112 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 113 |         setCurrentPage(1);\n      |         ^^^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  114 |     }, [priceRange, currentSort, slug]);\n  115 |\n  116 |     const totalPages = Math.ceil(filteredAndSortedProducts.length / ITEMS_PER_PAGE);","line":113,"column":9,"nodeType":null,"endLine":113,"endColumn":23,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useState, useMemo, useEffect } from 'react';\r\nimport { useRouter, useSearchParams } from 'next/navigation';\r\nimport { Product, Category } from '@/lib/api';\r\nimport { SidebarFilters } from './SidebarFilters';\r\nimport { ProductListing } from './ProductListing';\r\n\r\ninterface CategoryViewProps {\r\n    products: Product[];\r\n    categoryData: Category;\r\n    slug: string;\r\n}\r\n\r\nexport function CategoryView({ products, categoryData, slug }: CategoryViewProps) {\r\n    const router = useRouter();\r\n    const searchParams = useSearchParams();\r\n\r\n    // -- Derived Initial State --\r\n    // Calculate global min/max price from the entire product list\r\n    const globalMinPrice = useMemo(() => {\r\n        if (products.length === 0) return 0;\r\n        return Math.floor(Math.min(...products.map(p => p.price)));\r\n    }, [products]);\r\n\r\n    const globalMaxPrice = useMemo(() => {\r\n        if (products.length === 0) return 1000;\r\n        return Math.ceil(Math.max(...products.map(p => p.price)));\r\n    }, [products]);\r\n\r\n    // -- State --\r\n    const [currentSort, setCurrentSort] = useState(searchParams.get('sort') || 'newest');\r\n    // Filter State\r\n    const [priceRange, setPriceRange] = useState({ min: globalMinPrice, max: globalMaxPrice });\r\n    // Reset price range if category changes\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setPriceRange({ min: globalMinPrice, max: globalMaxPrice });\r\n    }, [globalMinPrice, globalMaxPrice]);\r\n\r\n    // Loading State\r\n    const [isUpdating, setIsUpdating] = useState(false);\r\n\r\n    // -- Handlers --\r\n    const handleSortChange = (sort: string) => {\r\n        setIsUpdating(true);\r\n        setTimeout(() => {\r\n            setCurrentSort(sort);\r\n            updateUrl({ sort });\r\n            setIsUpdating(false);\r\n        }, 500);\r\n    };\r\n\r\n    const handlePriceChange = (min: number, max: number) => {\r\n        // Immediate UI update for the numbers/slider\r\n        setPriceRange({ min, max });\r\n    };\r\n\r\n    // Debounced URL/Filter update for Price to avoid crazy re-renders?\r\n    // Actually, user wants \"Instant Update\".\r\n    // \"Dragging the slider will filter products instantly\".\r\n    // So we don't delay the filtering list, but maybe we delay the URL update or heavy animations?\r\n    // Let's filter instantly. Effect is fast enough for <100 products.\r\n\r\n    // -- Filtering & Sorting Logic --\r\n    const filteredAndSortedProducts = useMemo(() => {\r\n        let result = [...products];\r\n\r\n        // 1. Filter by Subcategory (Client Side if needed, but usually Server handles it via URL?\r\n        // Wait, current implementation passes `subcategory` via props to `CategoryPage` which filters via API.\r\n        // But if we want instant switching, we should load ALL products for the category and filter locally?\r\n        // The API `getProductsByCategory` fetches products matching the subcategory if provided.\r\n        // If we want dynamic subcategory switching without reload, we need all products.\r\n        // BUT `CategoryPage` fetches based on `searchParams.subcategory`.\r\n        // If we change subcategory, we normally navigate.\r\n        // For Filter System, \"Attribute Filters\" (Organic etc) are client side.\r\n        // Subcategory is usually a navigation event.\r\n        // Let's respect the `products` prop as the \"Source of Truth\" (which might already be filtered by subcategory).\r\n\r\n        // 2. Filter by Price\r\n        result = result.filter(p => p.price >= priceRange.min && p.price <= priceRange.max);\r\n\r\n        // 3. Sort\r\n        switch (currentSort) {\r\n            case 'price-asc':\r\n                result.sort((a, b) => a.price - b.price);\r\n                break;\r\n            case 'price-desc':\r\n                result.sort((a, b) => b.price - a.price);\r\n                break;\r\n            case 'best-selling':\r\n                result.sort((a, b) => (b.sold_count || 0) - (a.sold_count || 0));\r\n                break;\r\n            case 'newest':\r\n                result.sort((a, b) => {\r\n                    if (!a.createdAt) return 1;\r\n                    if (!b.createdAt) return -1;\r\n                    return new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime();\r\n                });\r\n                break;\r\n        }\r\n\r\n        return result;\r\n    }, [products, currentSort, priceRange]);\r\n\r\n    // -- Pagination Logic --\r\n    const ITEMS_PER_PAGE = 12;\r\n    const [currentPage, setCurrentPage] = useState(1);\r\n\r\n    // Reset page when filters change\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        setCurrentPage(1);\r\n    }, [priceRange, currentSort, slug]);\r\n\r\n    const totalPages = Math.ceil(filteredAndSortedProducts.length / ITEMS_PER_PAGE);\r\n\r\n    const paginatedProducts = useMemo(() => {\r\n        const start = (currentPage - 1) * ITEMS_PER_PAGE;\r\n        const end = start + ITEMS_PER_PAGE;\r\n        return filteredAndSortedProducts.slice(start, end);\r\n    }, [filteredAndSortedProducts, currentPage]);\r\n\r\n    const handlePageChange = (page: number) => {\r\n        setIsUpdating(true);\r\n        // Simulate network delay for smooth feel or just instant\r\n        setTimeout(() => {\r\n            setCurrentPage(page);\r\n            window.scrollTo({ top: 0, behavior: 'smooth' });\r\n            setIsUpdating(false);\r\n        }, 300);\r\n    };\r\n\r\n    // Helper to update URL silently\r\n    const updateUrl = (updates: Record<string, string>) => {\r\n        const params = new URLSearchParams(searchParams.toString());\r\n        Object.entries(updates).forEach(([key, value]) => params.set(key, value));\r\n        window.history.pushState(null, '', `?${params.toString()}`);\r\n    };\r\n\r\n    return (\r\n        <div className=\"flex flex-col lg:flex-row gap-12\">\r\n            {/* Sidebar Filters */}\r\n            <SidebarFilters\r\n                subcategories={categoryData.subcategories}\r\n                currentCategory={slug}\r\n                minPrice={globalMinPrice}\r\n                maxPrice={globalMaxPrice}\r\n                currentMin={priceRange.min}\r\n                currentMax={priceRange.max}\r\n                onPriceChange={handlePriceChange}\r\n            />\r\n\r\n            {/* Product Grid Area */}\r\n            <ProductListing\r\n                title={categoryData.name}\r\n                products={paginatedProducts}\r\n                totalProducts={filteredAndSortedProducts.length}\r\n                currentPage={currentPage}\r\n                totalPages={totalPages}\r\n                onPageChange={handlePageChange}\r\n                currentSort={currentSort}\r\n                onSortChange={handleSortChange}\r\n                isUpdating={isUpdating}\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\ProductListing.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'title' is defined but never used.","line":20,"column":5,"nodeType":"Identifier","messageId":"unusedVar","endLine":20,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { ProductCard } from '@/components/product/ProductCard';\r\nimport { Product } from '@/lib/api';\r\nimport React from 'react';\r\n\r\ninterface ProductListingProps {\r\n    title: string;\r\n    products?: Product[];\r\n    totalProducts?: number;\r\n    currentPage?: number;\r\n    totalPages?: number;\r\n    onPageChange?: (page: number) => void;\r\n    currentSort: string;\r\n    onSortChange: (sort: string) => void;\r\n    isUpdating: boolean;\r\n}\r\n\r\nexport function ProductListing({\r\n    title,\r\n    products = [],\r\n    totalProducts = 0,\r\n    currentPage = 1,\r\n    totalPages = 1,\r\n    onPageChange,\r\n    currentSort,\r\n    onSortChange,\r\n    isUpdating\r\n}: ProductListingProps) {\r\n\r\n    const handleSortChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\r\n        onSortChange(e.target.value);\r\n    };\r\n\r\n    return (\r\n        <section className=\"flex-1 relative\">\r\n            <div className=\"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6\">\r\n                <p className=\"text-slate-500 font-medium\">\r\n                    Showing <span className=\"text-slate-900 dark:text-white font-bold\">\r\n                        {products.length > 0 ? (currentPage - 1) * 12 + 1 : 0} - {(currentPage - 1) * 12 + products.length}\r\n                    </span> of <span className=\"text-slate-900 dark:text-white font-bold\">{totalProducts}</span> results\r\n                </p>\r\n\r\n                <div className=\"flex items-center gap-2\">\r\n                    <span className=\"text-sm text-slate-500 hidden sm:block\">Sort by:</span>\r\n                    <select\r\n                        value={currentSort}\r\n                        onChange={handleSortChange}\r\n                        disabled={isUpdating}\r\n                        className=\"bg-white dark:bg-slate-800 border-none rounded-xl py-2 pl-4 pr-10 text-sm font-bold text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 outline-none cursor-pointer disabled:opacity-50\"\r\n                    >\r\n                        <option value=\"newest\">Newest</option>\r\n                        <option value=\"best-selling\">Best Selling</option>\r\n                        <option value=\"price-asc\">Price: Low to High</option>\r\n                        <option value=\"price-desc\">Price: High to Low</option>\r\n                    </select>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Grid */}\r\n            <div className=\"relative min-h-[400px]\">\r\n                {/* Loading State Overlay */}\r\n                {isUpdating && (\r\n                    <div className=\"absolute inset-0 z-10 bg-white/50 dark:bg-slate-900/50 backdrop-blur-sm flex items-center justify-center rounded-xl transition-all duration-300 animate-fade-in\">\r\n                        <div className=\"flex flex-col items-center gap-3\">\r\n                            <div className=\"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin\"></div>\r\n                            <span className=\"text-sm font-bold text-primary animate-pulse\">Updating...</span>\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                <div className={`grid grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 mb-12 transition-opacity duration-300 ${isUpdating ? 'opacity-40' : 'opacity-100'}`}>\r\n                    {products.map((product) => (\r\n                        <ProductCard key={product.id} product={{ ...product, id: product.id }} />\r\n                    ))}\r\n                </div>\r\n\r\n                {products.length === 0 && !isUpdating && (\r\n                    <div className=\"flex flex-col items-center justify-center py-20 text-center\">\r\n                        <span className=\"material-icons-round text-6xl text-slate-200 dark:text-slate-700 mb-4\">search_off</span>\r\n                        <h3 className=\"text-xl font-bold text-slate-900 dark:text-white mb-2\">No products found</h3>\r\n                        <p className=\"text-slate-500\">Try changing your filters.</p>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Pagination - Dynamic */}\r\n            {(totalPages > 0) && (\r\n                <div className=\"flex justify-center flex-wrap gap-2\">\r\n                    <button\r\n                        onClick={() => onPageChange?.(Math.max(1, currentPage - 1))}\r\n                        disabled={currentPage === 1}\r\n                        className=\"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_left</span>\r\n                    </button>\r\n\r\n                    {Array.from({ length: totalPages }, (_, i) => i + 1).map((page) => (\r\n                        <button\r\n                            key={page}\r\n                            onClick={() => onPageChange?.(page)}\r\n                            className={`w-10 h-10 rounded-xl font-bold flex items-center justify-center transition-all ${currentPage === page\r\n                                ? 'bg-primary text-white shadow-lg shadow-primary/30 scale-105'\r\n                                : 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700'\r\n                                }`}\r\n                        >\r\n                            {page}\r\n                        </button>\r\n                    ))}\r\n\r\n                    <button\r\n                        onClick={() => onPageChange?.(Math.min(totalPages, currentPage + 1))}\r\n                        disabled={currentPage === totalPages}\r\n                        className=\"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_right</span>\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\category\\SidebarFilters.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\checkout\\CheckoutStepper.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'index' is defined but never used.","line":28,"column":32,"nodeType":"Identifier","messageId":"unusedVar","endLine":28,"endColumn":37},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'isPending' is assigned a value but never used.","line":31,"column":27,"nodeType":"Identifier","messageId":"unusedVar","endLine":31,"endColumn":36}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\ntype CheckoutStepperProps = {\r\n    currentStep: 1 | 2 | 3;\r\n};\r\n\r\nexport function CheckoutStepper({ currentStep }: CheckoutStepperProps) {\r\n    const steps = [\r\n        { step: 1, label: 'Shopping Cart', icon: 'shopping_cart' },\r\n        { step: 2, label: 'Checkout Details', icon: 'credit_card' },\r\n        { step: 3, label: 'Order Complete', icon: 'check_circle' }\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto mb-10 px-4\">\r\n            <div className=\"relative flex items-center justify-between z-0\">\r\n                {/* Connecting Line - Background */}\r\n                <div className=\"absolute left-[10%] right-[10%] top-1/2 -translate-y-1/2 h-0.5 bg-slate-200 dark:bg-slate-700\" />\r\n\r\n                {/* Connecting Line - Progress */}\r\n                <div\r\n                    className=\"absolute left-[10%] top-1/2 -translate-y-1/2 h-0.5 bg-[#4c9a80] transition-all duration-700 ease-in-out\"\r\n                    style={{\r\n                        width: `${((currentStep - 1) / (steps.length - 1)) * 80}%`\r\n                    }}\r\n                />\r\n\r\n                {steps.map((s, index) => {\r\n                    const isCompleted = currentStep > s.step;\r\n                    const isActive = currentStep === s.step;\r\n                    const isPending = currentStep < s.step;\r\n\r\n                    return (\r\n                        <div key={s.step} className=\"flex flex-col items-center gap-3 relative group\">\r\n                            {/* Step Circle */}\r\n                            <div\r\n                                className={`\r\n                                    w-12 h-12 rounded-full flex items-center justify-center border-2 transition-all duration-500 ease-out z-10\r\n                                    ${isActive\r\n                                        ? 'bg-white dark:bg-[#0d1b17] border-[#4c9a80] text-[#4c9a80] shadow-[0_0_0_4px_rgba(76,154,128,0.15)] scale-110'\r\n                                        : isCompleted\r\n                                            ? 'bg-[#4c9a80] border-[#4c9a80] text-white shadow-md shadow-[#4c9a80]/20'\r\n                                            : 'bg-white dark:bg-[#0d1b17] border-slate-200 dark:border-slate-700 text-slate-300 dark:text-slate-600'\r\n                                    }\r\n                                `}\r\n                            >\r\n                                <span className={`material-icons-round text-xl transition-transform duration-300 ${isActive ? 'scale-110' : ''}`}>\r\n                                    {isCompleted ? 'check' : s.icon}\r\n                                </span>\r\n                            </div>\r\n\r\n                            {/* Label */}\r\n                            <div className=\"flex flex-col items-center gap-0.5\">\r\n                                <span\r\n                                    className={`\r\n                                        text-xs font-bold uppercase tracking-wider transition-colors duration-300\r\n                                        ${isActive\r\n                                            ? 'text-[#0d1b17] dark:text-white'\r\n                                            : isCompleted\r\n                                                ? 'text-[#4c9a80]'\r\n                                                : 'text-slate-400 dark:text-slate-600'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    Step {s.step}\r\n                                </span>\r\n                                <span\r\n                                    className={`\r\n                                        text-sm font-bold whitespace-nowrap transition-colors duration-300 hidden sm:block\r\n                                        ${isActive || isCompleted\r\n                                            ? 'text-[#0d1b17] dark:text-white'\r\n                                            : 'text-slate-400 dark:text-slate-600'\r\n                                        }\r\n                                    `}\r\n                                >\r\n                                    {s.label}\r\n                                </span>\r\n                            </div>\r\n                        </div>\r\n                    );\r\n                })}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\AdvertiseScroller.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":4,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":19,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useEffect"},"fix":{"range":[59,69],"text":""},"desc":"Remove unused variable \"useEffect\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useRef' is defined but never used.","line":4,"column":21,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"useRef"},"fix":{"range":[68,76],"text":""},"desc":"Remove unused variable \"useRef\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":4,"column":29,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":37,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"useState"},"fix":{"range":[50,102],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'ads' is assigned a value but never used.","line":6,"column":7,"nodeType":"Identifier","messageId":"unusedVar","endLine":6,"endColumn":10}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\"use client\";\r\n\r\nimport Image from \"next/image\";\r\nimport { useEffect, useRef, useState } from \"react\";\r\n\r\nconst ads = [\r\n    \"/legacy_assets/images/card1.png\",\r\n    \"/legacy_assets/images/card2.png\",\r\n    \"/legacy_assets/images/card3.png\",\r\n    \"/legacy_assets/images/card1.png\", // Duplicates for seamless looping if needed, or we just map twice\r\n    \"/legacy_assets/images/card2.png\",\r\n    \"/legacy_assets/images/card3.png\",\r\n];\r\n\r\nexport function AdvertiseScroller({ ads = [] }: { ads?: string[] }) {\r\n    // Fallback if no ads provided\r\n    const displayAds = ads.length > 0 ? ads : [\r\n        \"/legacy_assets/images/card1.png\",\r\n        \"/legacy_assets/images/card2.png\",\r\n        \"/legacy_assets/images/card3.png\",\r\n    ];\r\n\r\n    return (\r\n        <div className=\"w-full bg-white dark:bg-slate-900 py-4 overflow-hidden\">\r\n            <div className=\"flex gap-4 animate-scroll whitespace-nowrap w-max hover:[animation-play-state:paused]\">\r\n                {[...displayAds, ...displayAds, ...displayAds].map((src, index) => (\r\n                    <div\r\n                        key={index}\r\n                        className=\"relative w-[300px] h-[160px] md:w-[400px] md:h-[220px] bg-gray-100 dark:bg-slate-800 rounded-xl overflow-hidden shadow-sm flex-shrink-0\"\r\n                    >\r\n                        <Image\r\n                            src={src}\r\n                            alt={`Advertisement ${index + 1}`}\r\n                            fill\r\n                            className=\"object-cover hover:scale-105 transition-transform duration-500\"\r\n                        />\r\n                    </div>\r\n                ))}\r\n            </div>\r\n            <style jsx>{`\r\n                .animate-scroll {\r\n                    animation: scroll 40s linear infinite;\r\n                }\r\n                @keyframes scroll {\r\n                    0% {\r\n                        transform: translateX(0);\r\n                    }\r\n                    100% {\r\n                        transform: translateX(-50%);\r\n                    }\r\n                }\r\n            `}</style>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\CategoryScroller.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":64,"column":29,"nodeType":"JSXOpeningElement","endLine":64,"endColumn":102}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useRef } from 'react';\r\nimport Link from 'next/link';\r\nimport { Category } from '@/lib/api';\r\n\r\ninterface CategoryScrollerProps {\r\n    categories: Category[];\r\n}\r\n\r\nexport function CategoryScroller({ categories }: CategoryScrollerProps) {\r\n    const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    const scroll = (direction: 'left' | 'right') => {\r\n        if (scrollContainerRef.current) {\r\n            const scrollAmount = 300;\r\n            const newScrollLeft = scrollContainerRef.current.scrollLeft + (direction === 'right' ? scrollAmount : -scrollAmount);\r\n            scrollContainerRef.current.scrollTo({\r\n                left: newScrollLeft,\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <section className=\"group\">\r\n            <div className=\"flex items-center justify-between mb-6\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-extrabold flex items-center gap-2 text-slate-900 dark:text-white\">\r\n                        Categories <span className=\"text-3xl\">≡ƒôª</span>\r\n                    </h2>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">Browse our wide range of freshness</p>\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={() => scroll('left')}\r\n                        className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                        aria-label=\"Scroll left\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_left</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => scroll('right')}\r\n                        className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                        aria-label=\"Scroll right\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_right</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Scroll Container */}\r\n            <div\r\n                ref={scrollContainerRef}\r\n                className=\"flex gap-4 overflow-x-auto pb-4 hide-scrollbar scroll-smooth\"\r\n            >\r\n                {categories.map((cat) => (\r\n                    <Link\r\n                        key={cat.id}\r\n                        href={`/category/${cat.slug}`}\r\n                        className=\"flex-shrink-0 flex items-center gap-4 bg-white dark:bg-slate-800 p-3 pr-6 rounded-2xl border border-slate-100 dark:border-slate-700 cursor-pointer hover:border-primary transition-all group/item min-w-[220px]\"\r\n                    >\r\n                        <div className=\"w-16 h-16 bg-slate-100 dark:bg-slate-700 rounded-xl flex items-center justify-center group-hover/item:bg-primary/10 transition-colors shrink-0\">\r\n                            <img alt={cat.name} className=\"w-10 h-10 object-contain\" src={cat.img} />\r\n                        </div>\r\n                        <div className=\"flex flex-col\">\r\n                            <span className=\"font-bold text-sm text-slate-900 dark:text-white\">{cat.name}</span>\r\n                        </div>\r\n                    </Link>\r\n                ))}\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\FeaturesSection.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\HeroSection.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[0,29],"text":""},"desc":"Remove unused import declaration."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":29,"column":17,"nodeType":"JSXOpeningElement","endLine":33,"endColumn":19}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link';\r\n\r\nconst bannerGradient = \"bg-gradient-to-br from-[#DCFCE7] to-[#F0FDF4] dark:from-[#14532D] dark:to-[#064E3B]\";\r\n\r\nexport function HeroSection({ settings }: { settings?: any }) {\r\n    return (\r\n        <section className={`relative min-h-[480px] rounded-3xl overflow-hidden ${bannerGradient} flex items-center py-12`}>\r\n            <div className=\"relative z-10 pl-16 max-w-xl space-y-6\">\r\n                <span className=\"inline-block px-4 py-1.5 bg-primary/10 text-primary text-xs font-bold uppercase tracking-widest rounded-full\">\r\n                    {settings?.subtitle || 'New Season Freshness'}\r\n                </span>\r\n                <h1 className=\"text-5xl lg:text-6xl font-extrabold leading-tight text-slate-900 dark:text-white\">\r\n                    {settings?.title || \"Quality Food For Your\"} <span className=\"text-primary\">{settings?.title ? \"\" : \"Healthy Life\"}</span>\r\n                </h1>\r\n                <p className=\"text-lg text-slate-600 dark:text-slate-300\">\r\n                    {settings?.description || 'Get up to 50% OFF on your first order. Fresh produce delivered from farm to your doorstep.'}\r\n                </p>\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button className=\"px-8 py-4 bg-primary text-white font-bold rounded-2xl shadow-lg shadow-primary/30 hover:shadow-primary/50 hover:-translate-y-1 transition-all active:scale-95\">\r\n                        {settings?.button_text || 'Shop Now'}\r\n                    </button>\r\n                    <a href={settings?.button_link || \"#special-offers\"} className=\"px-8 py-4 bg-white dark:bg-slate-800 text-slate-900 dark:text-white font-bold rounded-2xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition-all text-center\">\r\n                        View Offers\r\n                    </a>\r\n                </div>\r\n            </div>\r\n\r\n            <div className=\"absolute right-0 top-0 bottom-0 w-1/2 overflow-hidden pointer-events-none\">\r\n                <img\r\n                    alt={settings?.title || \"Fresh Vegetables\"}\r\n                    className=\"w-full h-full object-cover opacity-90 mix-blend-multiply dark:mix-blend-overlay\"\r\n                    src={settings?.image_url || \"https://lh3.googleusercontent.com/aida-public/AB6AXuBX7x1HBOqMMI518qHW17jKGkryeaKonnXGEbdkBR4GvbEVZENLzYW_8cEKLeU3nLCoxfDxvRuzBWc2UMxkRlp8Qix2LgxHKpsToQHO10vMCHMKjOmg6ucwmqOZ7GIMiSBIxBw0qaqFeK63SiQ5EQ4C-LMvZy28P7MaNy4uzcV2DaK1H5zIykFWkZMYBE6Xh8ac9E1nba7cTZ14OBTrDW-wpN-j8lDq-VbvUaLl6OtViD2uWDMpEBWT1yXDZluirbsS6BEgrgXwzyI\"}\r\n                />\r\n            </div>\r\n\r\n\r\n\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\NoticeScroller.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\ProductGrid.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":4,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":4,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[57,86],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { useRef } from 'react';\r\nimport Link from 'next/link';\r\nimport { ProductCard } from '@/components/product/ProductCard';\r\nimport { Product } from '@/lib/api';\r\n\r\ninterface ProductGridProps {\r\n    products: Product[];\r\n    title?: string;\r\n    subtitle?: string;\r\n}\r\n\r\nexport function ProductGrid({ products, title = \"Best selling ≡ƒöÑ\", subtitle = \"Based on this week's most popular purchases\" }: ProductGridProps) {\r\n    const scrollRef = useRef<HTMLDivElement>(null);\r\n\r\n    const scroll = (direction: 'left' | 'right') => {\r\n        if (scrollRef.current) {\r\n            const { current } = scrollRef;\r\n            const scrollAmount = direction === 'left' ? -current.offsetWidth : current.offsetWidth;\r\n            current.scrollBy({ left: scrollAmount, behavior: 'smooth' });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <section>\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-extrabold flex items-center gap-2 text-slate-900 dark:text-white\">\r\n                        {title}\r\n                    </h2>\r\n                    {subtitle && <p className=\"text-slate-500 text-sm mt-1\">{subtitle}</p>}\r\n                </div>\r\n                <div className=\"flex gap-2\">\r\n                    <button\r\n                        onClick={() => scroll('left')}\r\n                        className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_left</span>\r\n                    </button>\r\n                    <button\r\n                        onClick={() => scroll('right')}\r\n                        className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                    >\r\n                        <span className=\"material-icons-round\">chevron_right</span>\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Slider Container */}\r\n            <div\r\n                ref={scrollRef}\r\n                className=\"flex gap-6 overflow-x-auto pb-4 custom-scrollbar snap-x\"\r\n            >\r\n                {products.map((product) => (\r\n                    <div key={product.id} className=\"min-w-[200px] w-[200px] md:min-w-[240px] md:w-[240px] snap-start\">\r\n                        <ProductCard product={{ ...product, id: product.id }} />\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\home\\PromotionalBanners.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":75,"column":25,"nodeType":"JSXOpeningElement","endLine":79,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useRef } from 'react';\r\nimport Link from 'next/link';\r\n\r\ninterface Offer {\r\n    id: number;\r\n    name: string;\r\n    description?: string;\r\n    image_url?: string;\r\n}\r\n\r\ninterface PromotionalBannersProps {\r\n    offers: Offer[];\r\n}\r\n\r\nexport function PromotionalBanners({ offers }: PromotionalBannersProps) {\r\n    const scrollContainerRef = useRef<HTMLDivElement>(null);\r\n\r\n    // Filter only offers with images to be safe\r\n    const activeOffers = offers.filter(o => o.image_url);\r\n\r\n    if (activeOffers.length === 0) return null;\r\n\r\n    const scroll = (direction: 'left' | 'right') => {\r\n        if (scrollContainerRef.current) {\r\n            const scrollAmount = 400; // Card width approx\r\n            const newScrollLeft = scrollContainerRef.current.scrollLeft + (direction === 'right' ? scrollAmount : -scrollAmount);\r\n            scrollContainerRef.current.scrollTo({\r\n                left: newScrollLeft,\r\n                behavior: 'smooth'\r\n            });\r\n        }\r\n    };\r\n\r\n    return (\r\n        <section id=\"special-offers\" className=\"relative group scroll-mt-24\">\r\n            <div className=\"flex items-center justify-between mb-8\">\r\n                <div>\r\n                    <h2 className=\"text-2xl font-extrabold flex items-center gap-2 text-slate-900 dark:text-white\">\r\n                        Special Offers <span className=\"text-3xl\">≡ƒÅ╖∩╕Å</span>\r\n                    </h2>\r\n                    <p className=\"text-slate-500 text-sm mt-1\">Grab them before they're gone</p>\r\n                </div>\r\n                {activeOffers.length > 2 && (\r\n                    <div className=\"flex gap-2\">\r\n                        <button\r\n                            onClick={() => scroll('left')}\r\n                            className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                            aria-label=\"Scroll left\"\r\n                        >\r\n                            <span className=\"material-icons-round\">chevron_left</span>\r\n                        </button>\r\n                        <button\r\n                            onClick={() => scroll('right')}\r\n                            className=\"w-10 h-10 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center hover:bg-primary hover:text-white transition-all text-slate-600 dark:text-slate-400\"\r\n                            aria-label=\"Scroll right\"\r\n                        >\r\n                            <span className=\"material-icons-round\">chevron_right</span>\r\n                        </button>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div\r\n                ref={scrollContainerRef}\r\n                className=\"flex gap-6 overflow-x-auto pb-4 hide-scrollbar scroll-smooth snap-x snap-mandatory\"\r\n            >\r\n                {activeOffers.map((offer) => (\r\n                    <div\r\n                        key={offer.id}\r\n                        className=\"relative min-w-[300px] md:min-w-[500px] h-[250px] rounded-3xl overflow-hidden group/card snap-center flex-shrink-0\"\r\n                    >\r\n                        {/* Image */}\r\n                        <img\r\n                            alt={offer.name}\r\n                            src={offer.image_url}\r\n                            className=\"absolute inset-0 w-full h-full object-cover group-hover/card:scale-105 transition-transform duration-700\"\r\n                        />\r\n\r\n                        {/* Overlay */}\r\n                        <div className=\"absolute inset-0 bg-gradient-to-r from-slate-900/90 via-slate-900/40 to-transparent flex flex-col justify-center p-8 md:p-12 space-y-4\">\r\n                            <span className=\"text-white/80 text-sm font-bold uppercase tracking-wider bg-primary/20 backdrop-blur w-fit px-3 py-1 rounded-full border border-primary/30\">\r\n                                Limited Time\r\n                            </span>\r\n                            <h3 className=\"text-2xl md:text-3xl font-extrabold text-white leading-tight\">\r\n                                {offer.name}\r\n                            </h3>\r\n                            {offer.description && (\r\n                                <p className=\"text-slate-200 text-sm md:text-base max-w-[80%] line-clamp-2\">\r\n                                    {offer.description}\r\n                                </p>\r\n                            )}\r\n                            <Link\r\n                                href={`/offers/${encodeURIComponent(offer.name)}`} // Assuming name is unique/slug-like or we add slug later\r\n                                className=\"w-fit px-6 py-2.5 bg-white text-slate-900 font-bold rounded-xl text-sm hover:bg-primary hover:text-white transition-all transform group-hover/card:translate-x-2\"\r\n                            >\r\n                                Claim Offer\r\n                            </Link>\r\n                        </div>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\layout\\Footer.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\layout\\MobileNav.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\layout\\NavBar.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":70,"column":29,"nodeType":"JSXOpeningElement","endLine":70,"endColumn":237},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":203,"column":41,"nodeType":"JSXOpeningElement","endLine":203,"endColumn":137}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport React from 'react';\r\nimport Link from 'next/link';\r\nimport { useCart } from '@/context/CartContext';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { Category, searchProducts, Product } from '@/lib/api';\r\nimport { useRouter } from 'next/navigation';\r\nimport { formatPrice } from '@/lib/format';\r\n\r\nfunction SearchBar() {\r\n    const router = useRouter();\r\n    const [query, setQuery] = React.useState('');\r\n    const [results, setResults] = React.useState<Product[]>([]);\r\n    const [isSearching, setIsSearching] = React.useState(false);\r\n    const [showDropdown, setShowDropdown] = React.useState(false);\r\n\r\n    // Debounce search\r\n    React.useEffect(() => {\r\n        const timer = setTimeout(async () => {\r\n            if (query.trim().length > 1) {\r\n                setIsSearching(true);\r\n                try {\r\n                    const data = await searchProducts(query);\r\n                    setResults(data);\r\n                    setShowDropdown(true);\r\n                } catch (error) {\r\n                    console.error(error);\r\n                } finally {\r\n                    setIsSearching(false);\r\n                }\r\n            } else {\r\n                setResults([]);\r\n                setShowDropdown(false);\r\n            }\r\n        }, 300);\r\n\r\n        return () => clearTimeout(timer);\r\n    }, [query]);\r\n\r\n    const handleSelect = (productId: number | string) => {\r\n        router.push(`/product/${productId}`);\r\n        setShowDropdown(false);\r\n        setQuery('');\r\n    };\r\n\r\n    return (\r\n        <div className=\"relative w-full group\">\r\n            <span className=\"material-icons-round absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 group-focus-within:text-primary transition-colors\">\r\n                search\r\n            </span>\r\n            <input\r\n                type=\"text\"\r\n                placeholder=\"Search products...\"\r\n                className=\"w-full bg-slate-100 dark:bg-slate-800 border-none rounded-2xl py-3 pl-12 pr-4 text-sm font-medium focus:ring-2 focus:ring-primary/20 transition-all outline-none text-slate-900 dark:text-white\"\r\n                value={query}\r\n                onChange={(e) => setQuery(e.target.value)}\r\n                onFocus={() => query.length > 1 && setShowDropdown(true)}\r\n                onBlur={() => setTimeout(() => setShowDropdown(false), 200)} // Delay to allow click\r\n            />\r\n\r\n            {/* Suggestions Dropdown */}\r\n            {showDropdown && results.length > 0 && (\r\n                <div className=\"absolute top-full left-0 w-full mt-2 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-2xl shadow-xl overflow-hidden z-[100]\">\r\n                    {results.map((product) => (\r\n                        <div\r\n                            key={product.id}\r\n                            className=\"flex items-center gap-4 p-3 hover:bg-slate-50 dark:hover:bg-slate-700 cursor-pointer transition-colors\"\r\n                            onClick={() => handleSelect(product.id)}\r\n                        >\r\n                            <img src={product.images && product.images.length > 0 ? product.images[0] : ''} alt={product.name} className=\"w-10 h-10 object-contain p-1 bg-white rounded-lg border border-slate-100 dark:border-slate-600\" />\r\n                            <div>\r\n                                <h4 className=\"font-bold text-sm text-slate-900 dark:text-white line-clamp-1\">{product.name}</h4>\r\n                                <div className=\"flex items-center gap-2 text-xs\">\r\n                                    <span className=\"text-primary font-bold\">{formatPrice(product.price)}</span>\r\n                                    {product.category && <span className=\"text-slate-400\">ΓÇó {product.category}</span>}\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ))}\r\n                </div>\r\n            )}\r\n            {showDropdown && query.length > 1 && results.length === 0 && !isSearching && (\r\n                <div className=\"absolute top-full left-0 w-full mt-2 bg-white dark:bg-slate-800 border border-slate-100 dark:border-slate-700 rounded-2xl shadow-xl p-4 text-center text-sm text-slate-500 z-[100]\">\r\n                    No products found.\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport function NavBar({ categories }: { categories: Category[] }) {\r\n    const { totalItems } = useCart();\r\n    const { user, signOut } = useAuth();\r\n    // const user = { user_metadata: { full_name: \"Test User\", avatar_url: null } }; const signOut = async () => { };\r\n\r\n    const [isScrolled, setIsScrolled] = React.useState(false);\r\n    const [isDark, setIsDark] = React.useState(false);\r\n\r\n    React.useEffect(() => {\r\n        setIsDark(document.documentElement.classList.contains('dark'));\r\n\r\n        const handleScroll = () => {\r\n            setIsScrolled(window.scrollY > 10);\r\n        };\r\n        window.addEventListener('scroll', handleScroll);\r\n        return () => window.removeEventListener('scroll', handleScroll);\r\n    }, []);\r\n\r\n    const toggleTheme = (e: React.MouseEvent<HTMLButtonElement>) => {\r\n        const x = e.clientX;\r\n        const y = e.clientY;\r\n        const endRadius = Math.hypot(\r\n            Math.max(x, innerWidth - x),\r\n            Math.max(y, innerHeight - y)\r\n        );\r\n\r\n        // @ts-ignore\r\n        if (!document.startViewTransition) {\r\n            document.documentElement.classList.toggle('dark');\r\n            setIsDark(!isDark);\r\n            return;\r\n        }\r\n\r\n        // @ts-ignore\r\n        const transition = document.startViewTransition(() => {\r\n            document.documentElement.classList.toggle('dark');\r\n            setIsDark(!isDark);\r\n        });\r\n\r\n        transition.ready.then(() => {\r\n            const clipPath = [\r\n                `circle(0px at ${x}px ${y}px)`,\r\n                `circle(${endRadius}px at ${x}px ${y}px)`,\r\n            ];\r\n\r\n            document.documentElement.animate(\r\n                {\r\n                    clipPath: isDark ? [...clipPath].reverse() : clipPath,\r\n                },\r\n                {\r\n                    duration: 500,\r\n                    easing: \"ease-in\",\r\n                    pseudoElement: isDark\r\n                        ? \"::view-transition-old(root)\"\r\n                        : \"::view-transition-new(root)\",\r\n                }\r\n            );\r\n        });\r\n    };\r\n\r\n    return (\r\n        <header className={`sticky top-0 z-50 bg-white/80 dark:bg-slate-800/80 backdrop-blur-md border-b border-slate-100 dark:border-slate-800 transition-all duration-300`}>\r\n            {/* Top Bar */}\r\n            <div className={`max-w-7xl mx-auto px-4 w-full flex items-center justify-between gap-4 transition-all duration-300 ${isScrolled ? 'h-14' : 'h-20'}`}>\r\n                {/* Logo */}\r\n                <Link href=\"/\" className={`flex items-center gap-2 shrink-0 cursor-pointer transition-all duration-500 origin-left ${isScrolled ? 'scale-75' : 'scale-100'}`}>\r\n                    <div className=\"w-10 h-10 bg-primary rounded-xl flex items-center justify-center shadow-lg shadow-primary/20\">\r\n                        <span className=\"material-icons-round text-white\">eco</span>\r\n                    </div>\r\n                    <span className=\"text-xl font-extrabold tracking-tight text-slate-900 dark:text-white\">\r\n                        Daily<span className=\"text-primary\">Fresh</span>\r\n                    </span>\r\n                </Link>\r\n\r\n                {/* Search Bar - Hidden on Mobile */}\r\n                <div className=\"hidden md:flex flex-1 max-w-lg mx-8 z-50\">\r\n                    <SearchBar />\r\n                </div>\r\n\r\n                {/* Actions */}\r\n                <div className=\"flex items-center gap-4\">\r\n                    <button\r\n                        className=\"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors\"\r\n                        onClick={toggleTheme}\r\n                    >\r\n                        <span className=\"material-icons-round text-xl\">\r\n                            {isDark ? 'light_mode' : 'dark_mode'}\r\n                        </span>\r\n                    </button>\r\n\r\n                    <Link href=\"/cart\" className=\"relative cursor-pointer\" id=\"cart-icon-container\">\r\n                        <div className=\"w-10 h-10 rounded-xl bg-slate-100 dark:bg-slate-800 flex items-center justify-center text-slate-600 dark:text-slate-400 hover:bg-primary hover:text-white transition-all group\">\r\n                            <span className=\"material-icons-round text-xl group-hover:scale-110 transition-transform\">shopping_cart</span>\r\n                        </div>\r\n                        {totalItems > 0 && (\r\n                            <span className=\"absolute -top-1 -right-1 bg-primary text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center border-2 border-white dark:border-slate-900\">\r\n                                {totalItems}\r\n                            </span>\r\n                        )}\r\n                    </Link>\r\n\r\n                    {user ? (\r\n                        <div className=\"flex items-center gap-3\">\r\n\r\n\r\n                            <div className=\"hidden lg:block text-right\">\r\n                                <p className=\"text-sm font-bold text-slate-900 dark:text-white\">{user.user_metadata?.full_name || 'User'}</p>\r\n                                <button onClick={signOut} className=\"text-xs text-slate-500 hover:text-red-500 font-medium\">Sign Out</button>\r\n                            </div>\r\n                            <Link href=\"/profile\" className=\"flex items-center gap-2 pl-1 pr-1 py-1 rounded-full border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors cursor-pointer\">\r\n                                <div className=\"w-8 h-8 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center overflow-hidden\">\r\n                                    {user.user_metadata?.avatar_url ? (\r\n                                        <img src={user.user_metadata.avatar_url} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                                    ) : (\r\n                                        <span className=\"material-icons-round text-slate-400 text-lg\">person</span>\r\n                                    )}\r\n                                </div>\r\n                            </Link>\r\n                        </div>\r\n                    ) : (\r\n                        <Link href=\"/login\" className=\"flex items-center gap-2 px-4 py-2 rounded-xl bg-primary/10 text-primary hover:bg-primary hover:text-white transition-all\">\r\n                            <span className=\"text-sm font-bold\">Login</span>\r\n                        </Link>\r\n                    )}\r\n                </div>\r\n            </div>\r\n\r\n            {/* Secondary Nav */}\r\n            <nav className=\"bg-white dark:bg-slate-900 border-b border-slate-100 dark:border-slate-800 hidden md:block\">\r\n                <div className=\"max-w-7xl mx-auto px-4 relative flex items-center justify-center\">\r\n                    {categories.map((category) => {\r\n                        const slug = category.name.toLowerCase().replace(/ & /g, '-').replace(/ /g, '-');\r\n                        return (\r\n                            <div key={category.name} className=\"group relative\">\r\n                                <Link\r\n                                    href={`/category/${slug}`}\r\n                                    className=\"px-6 py-3 block text-sm font-medium text-slate-600 dark:text-slate-400 hover:text-primary transition-colors border-b-2 border-transparent hover:border-primary\"\r\n                                >\r\n                                    {category.name}\r\n                                </Link>\r\n\r\n                                {/* Dropdown Menu */}\r\n                                <div className=\"absolute top-full left-0 w-64 bg-white dark:bg-slate-900 shadow-xl rounded-b-2xl border-x border-b border-slate-100 dark:border-slate-800 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 z-50\">\r\n                                    <div className=\"p-2 space-y-1\">\r\n                                        {category.subcategories.map((sub) => (\r\n                                            <Link\r\n                                                key={sub.name}\r\n                                                href={`/category/${slug}?subcategory=${encodeURIComponent(sub.name)}`}\r\n                                                className=\"block px-4 py-2.5 text-sm text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-800 hover:text-primary dark:hover:text-primary rounded-xl transition-colors\"\r\n                                            >\r\n                                                {sub.name}\r\n                                            </Link>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )\r\n                    })}\r\n                </div>\r\n            </nav>\r\n        </header>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\product\\ProductCard.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CartItem' is defined but never used.","line":5,"column":19,"nodeType":"Identifier","messageId":"unusedVar","endLine":5,"endColumn":27,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CartItem"},"fix":{"range":[92,102],"text":""},"desc":"Remove unused variable \"CartItem\"."}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":105,"column":25,"nodeType":"JSXOpeningElement","endLine":109,"endColumn":27}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React from 'react';\r\nimport Link from 'next/link';\r\nimport { useCart, CartItem } from '@/context/CartContext';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { useWishlist } from '@/context/WishlistContext';\r\nimport { formatPrice } from '@/lib/format';\r\n\r\nimport { useFlyToCart } from '@/context/FlyToCartContext';\r\n\r\nexport interface Product {\r\n    id: number | string;\r\n    name: string;\r\n    price: number;\r\n    images: string[];\r\n    category?: string;\r\n    quantity?: string; // Display quantity e.g. \"1kg\"\r\n    originalPrice?: number;\r\n    discountPercent?: number;\r\n    specialCategoryLabel?: string;\r\n    description?: string;\r\n}\r\n\r\ninterface ProductCardProps {\r\n    product: Product;\r\n    variant?: 'default' | 'wishlist';\r\n}\r\n\r\nexport function ProductCard({ product, variant = 'default' }: ProductCardProps) {\r\n    const { addItem } = useCart();\r\n    const { user } = useAuth();\r\n    const { addToWishlist, removeFromWishlist, isInWishlist } = useWishlist();\r\n    const { triggerFly } = useFlyToCart();\r\n\r\n    // Local state for quantity\r\n    const [quantity, setQuantity] = React.useState(1);\r\n\r\n    const isWishlisted = isInWishlist(Number(product.id));\r\n\r\n    const handleWishlistClick = async (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        if (!user) {\r\n            alert(\"Please sign in to add items to your wishlist.\");\r\n            return;\r\n        }\r\n\r\n        if (isWishlisted) {\r\n            await removeFromWishlist(Number(product.id));\r\n        } else {\r\n            await addToWishlist(Number(product.id));\r\n        }\r\n    };\r\n\r\n    const handleDeleteClick = async (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n\r\n        await removeFromWishlist(Number(product.id));\r\n    };\r\n\r\n    const handleIncrement = (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setQuantity(prev => prev + 1);\r\n    };\r\n\r\n    const handleDecrement = (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        setQuantity(prev => Math.max(1, prev - 1));\r\n    };\r\n\r\n    const handleAddToCart = (e: React.MouseEvent) => {\r\n        e.preventDefault(); // Prevent navigation to product detail\r\n        e.stopPropagation();\r\n\r\n        addItem({\r\n            id: String(product.id), // Ensure string ID for consistency\r\n            name: product.name,\r\n            price: product.price,\r\n            images: product.images || [],\r\n            quantity: quantity,\r\n            category: product.category,\r\n            pack: product.quantity,\r\n            color: '' // Handle undefined color explicitly\r\n        });\r\n\r\n        const imageSrc = product.images && product.images.length > 0 ? product.images[0] : '/placeholder-food.png';\r\n        triggerFly(e.currentTarget as HTMLElement, imageSrc, quantity);\r\n\r\n        // Optional: Reset quantity after adding? Or keep it? keeping it for now.\r\n        // setQuantity(1); \r\n    };\r\n\r\n    return (\r\n        <div className=\"bg-white dark:bg-slate-800 rounded-3xl p-4 border border-slate-100 dark:border-slate-700 hover:shadow-xl hover:shadow-slate-200/50 dark:hover:shadow-none transition-all group relative h-full flex flex-col\">\r\n            <Link href={`/product/${product.id}`} className=\"flex flex-col h-full\">\r\n                {/* Image & Badges */}\r\n                {/* Image & Badges */}\r\n                <div className=\"relative h-40 w-full mb-4 group-hover:scale-105 transition-transform duration-500 bg-gray-50 rounded-lg flex items-center justify-center overflow-hidden\">\r\n                    {product.images && product.images.length > 0 && product.images[0] ? (\r\n                        <img\r\n                            alt={product.name}\r\n                            className=\"w-full h-full object-contain\"\r\n                            src={product.images[0]}\r\n                        />\r\n                    ) : (\r\n                        <span className=\"material-symbols-outlined text-4xl text-gray-300\">image</span>\r\n                    )}\r\n\r\n                    {/* Discount Badge */}\r\n                    {product.discountPercent && product.discountPercent > 0 && (\r\n                        <div className=\"absolute top-0 left-0 bg-red-500/90 backdrop-blur-sm text-white text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10\">\r\n                            {product.discountPercent}% OFF\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Special Category Badge */}\r\n                    {product.specialCategoryLabel && (\r\n                        <div className=\"absolute top-0 left-0 mt-6 bg-yellow-400/90 backdrop-blur-sm text-slate-900 text-[10px] font-bold px-2 py-1 rounded-full shadow-sm z-10\">\r\n                            {product.specialCategoryLabel}\r\n                        </div>\r\n                    )}\r\n\r\n                    {variant === 'wishlist' ? (\r\n                        <button\r\n                            onClick={handleDeleteClick}\r\n                            className=\"absolute top-0 right-0 p-2 rounded-full transition-colors bg-red-50 text-red-500 hover:bg-red-100\"\r\n                            title=\"Remove from wishlist\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">delete_outline</span>\r\n                        </button>\r\n                    ) : (\r\n                        <button\r\n                            onClick={handleWishlistClick}\r\n                            className={`absolute top-0 right-0 p-2 rounded-full transition-colors ${isWishlisted ? 'bg-red-50 text-red-500' : 'bg-slate-100 dark:bg-slate-700 text-slate-400 hover:text-red-500'}`}\r\n                        >\r\n                            <span className={`material-icons-round text-sm ${isWishlisted ? 'material-icons' : 'material-icons-outlined'}`}>\r\n                                {isWishlisted ? 'favorite' : 'favorite_border'}\r\n                            </span>\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"space-y-2 flex-1 flex flex-col\">\r\n                    {product.category && (\r\n                        <p className=\"text-xs font-bold text-primary uppercase tracking-wider\">{product.category}</p>\r\n                    )}\r\n                    <h3 className=\"font-bold text-slate-900 dark:text-white line-clamp-1 group-hover:text-primary transition-colors\">\r\n                        {product.name}\r\n                    </h3>\r\n                    {product.quantity && <p className=\"text-xs text-slate-500 dark:text-slate-400\">{product.quantity}</p>}\r\n\r\n                    <div className=\"mt-auto pt-2 space-y-3\">\r\n                        {/* Price Area */}\r\n                        <div className=\"flex items-center justify-between\">\r\n                            <div className=\"flex flex-col\">\r\n                                <div className=\"flex items-baseline gap-2\">\r\n                                    <span className={`font-bold text-lg ${product.discountPercent ? 'text-red-500' : 'text-slate-900 dark:text-white'}`}>\r\n                                        {formatPrice(product.price)}\r\n                                    </span>\r\n                                    {product.originalPrice && (\r\n                                        <span className=\"text-xs text-slate-400 line-through decoration-slate-400/50\">\r\n                                            {formatPrice(product.originalPrice)}\r\n                                        </span>\r\n                                    )}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Quantity Selector */}\r\n                            <div className=\"flex items-center bg-slate-100 dark:bg-slate-700 rounded-lg p-1\">\r\n                                <button\r\n                                    onClick={handleDecrement}\r\n                                    className=\"w-6 h-6 flex items-center justify-center rounded-md bg-white dark:bg-slate-600 shadow-sm text-slate-600 dark:text-slate-200 hover:text-primary active:scale-95 transition-all\"\r\n                                >\r\n                                    <span className=\"material-icons-round text-xs\">remove</span>\r\n                                </button>\r\n                                <span className=\"w-8 text-center text-sm font-bold text-slate-900 dark:text-white\">{quantity}</span>\r\n                                <button\r\n                                    onClick={handleIncrement}\r\n                                    className=\"w-6 h-6 flex items-center justify-center rounded-md bg-white dark:bg-slate-600 shadow-sm text-slate-600 dark:text-slate-200 hover:text-primary active:scale-95 transition-all\"\r\n                                >\r\n                                    <span className=\"material-icons-round text-xs\">add</span>\r\n                                </button>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Add to Cart Button */}\r\n                        <button\r\n                            onClick={handleAddToCart}\r\n                            className=\"w-full py-2 bg-primary text-white font-bold rounded-xl shadow-lg shadow-primary/30 hover:shadow-primary/50 hover:-translate-y-0.5 active:translate-y-0 active:shadow-none transition-all flex items-center justify-center gap-2\"\r\n                        >\r\n                            <span className=\"material-icons-round text-sm\">shopping_cart</span>\r\n                            <span>Add to Cart</span>\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </Link>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\product\\ProductInfo.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":87,"column":21,"nodeType":"JSXOpeningElement","endLine":92,"endColumn":23},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":122,"column":33,"nodeType":"JSXOpeningElement","endLine":127,"endColumn":35}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport { useState } from 'react';\r\nimport { useCart } from '@/context/CartContext';\r\nimport { Product } from '@/lib/api';\r\nimport { formatPrice } from '@/lib/format';\r\n\r\nimport { useWishlist } from '@/context/WishlistContext';\r\n\r\nimport { useFlyToCart } from '@/context/FlyToCartContext';\r\n\r\nexport function ProductInfo({ product }: { product: Product }) {\r\n    const [quantity, setQuantity] = useState(1);\r\n    const [selectedColor, setSelectedColor] = useState<string | null>(product.colors && product.colors.length > 0 ? product.colors[0] : null);\r\n    const [selectedSize, setSelectedSize] = useState<string | null>(product.sizes && product.sizes.length > 0 ? product.sizes[0] : null);\r\n\r\n    // Wishlist\r\n    const { addToWishlist, removeFromWishlist, isInWishlist } = useWishlist();\r\n    const isWishlisted = isInWishlist(Number(product.id));\r\n\r\n    const handleWishlistClick = async (e: React.MouseEvent) => {\r\n        e.preventDefault();\r\n        e.stopPropagation();\r\n        if (isWishlisted) {\r\n            await removeFromWishlist(Number(product.id));\r\n        } else {\r\n            await addToWishlist(Number(product.id));\r\n        }\r\n    };\r\n\r\n    // Description Toggle\r\n    const [isExpanded, setIsExpanded] = useState(false);\r\n    const description = product.description || `Enjoy the finest ${product.name}, sourced with care to bring nature's best to your table. Perfect for your daily needs.`;\r\n\r\n    // Image Gallery State\r\n    const [selectedImage, setSelectedImage] = useState<string>(product.images && product.images.length > 0 ? product.images[0] : '');\r\n\r\n    const { addItem } = useCart();\r\n    const { triggerFly } = useFlyToCart();\r\n\r\n    const isOutOfStock = product.stockQuantity === 0;\r\n\r\n    const handleAddToCart = (e: React.MouseEvent<HTMLElement>) => {\r\n        addItem({\r\n            id: product.id,\r\n            name: product.name,\r\n            price: product.price,\r\n            images: product.images || [],\r\n            quantity: quantity,\r\n            category: product.category,\r\n            pack: product.quantity,\r\n            color: selectedColor || undefined,\r\n            size: selectedSize || undefined\r\n        });\r\n\r\n        triggerFly(e.currentTarget, selectedImage || '/placeholder-food.png', quantity);\r\n    };\r\n\r\n    return (\r\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-12\">\r\n            {/* Image Gallery Section */}\r\n            <div className=\"space-y-4\">\r\n                {/* Main Image */}\r\n                <div className=\"bg-white dark:bg-slate-800 rounded-3xl p-8 border border-slate-100 dark:border-slate-700 shadow-sm relative group overflow-hidden h-[500px] flex items-center justify-center\">\r\n                    {/* Discount Badge */}\r\n                    {product.discountPercent && product.discountPercent > 0 && (\r\n                        <div className=\"absolute top-4 left-4 bg-red-500 text-white text-xs font-bold px-3 py-1.5 rounded-full z-10 shadow-sm\">\r\n                            {product.discountPercent}% OFF\r\n                        </div>\r\n                    )}\r\n                    {/* Special Category Badge - Moved to ensure no overlap with Wishlist */}\r\n                    {product.specialCategoryLabel && (\r\n                        <div className={`absolute left-4 bg-yellow-400 text-slate-900 text-xs font-bold px-3 py-1.5 rounded-full z-10 shadow-sm ${product.discountPercent ? 'top-14' : 'top-4'}`}>\r\n                            {product.specialCategoryLabel}\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Wishlist Button */}\r\n                    <button\r\n                        onClick={handleWishlistClick}\r\n                        className=\"absolute top-4 right-4 bg-white/90 dark:bg-slate-700/90 p-2.5 rounded-full shadow-sm text-slate-400 dark:text-slate-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-slate-600 transition-all z-20 group/wishlist\"\r\n                    >\r\n                        <span className={`material-icons-round text-xl transform group-hover/wishlist:scale-110 transition-transform ${isWishlisted ? 'text-red-500' : ''}`}>\r\n                            {isWishlisted ? 'favorite' : 'favorite_border'}\r\n                        </span>\r\n                    </button>\r\n\r\n                    <img\r\n                        src={selectedImage || '/placeholder-food.png'}\r\n                        onError={(e) => { e.currentTarget.src = 'https://placehold.co/600x400?text=No+Image'; }}\r\n                        alt={product.name}\r\n                        className=\"w-full h-full object-contain group-hover:scale-105 transition-transform duration-500 animate-scale-up\"\r\n                    />\r\n\r\n                    {/* Image Dots Indicator */}\r\n                    {product.images && product.images.length > 1 && (\r\n                        <div className=\"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2 z-10 bg-black/20 backdrop-blur-sm px-3 py-1.5 rounded-full\">\r\n                            {product.images.filter(img => img).map((img, idx) => (\r\n                                <button\r\n                                    key={idx}\r\n                                    onClick={(e) => { e.stopPropagation(); setSelectedImage(img); }}\r\n                                    className={`w-2 h-2 rounded-full transition-all ${selectedImage === img ? 'bg-white scale-125' : 'bg-white/50 hover:bg-white/80'}`}\r\n                                    aria-label={`View image ${idx + 1}`}\r\n                                />\r\n                            ))}\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Thumbnails */}\r\n                {/* Ensure we only show thumbnails if we actually have > 1 VALID images */}\r\n                {product.images && product.images.length > 1 && (\r\n                    <div className=\"flex gap-4 overflow-x-auto pb-2 scrollbar-hide py-2 px-1\">\r\n                        {product.images.filter(img => img).map((img, idx) => (\r\n                            <button\r\n                                key={idx}\r\n                                onClick={() => setSelectedImage(img)}\r\n                                className={`relative w-20 h-20 rounded-xl border-2 p-1 flex-shrink-0 transition-all overflow-hidden bg-white dark:bg-slate-800 ${selectedImage === img\r\n                                    ? 'border-primary ring-2 ring-primary/20'\r\n                                    : 'border-slate-100 dark:border-slate-700 hover:border-slate-300 dark:hover:border-slate-600'\r\n                                    }`}\r\n                            >\r\n                                <img\r\n                                    src={img}\r\n                                    onError={(e) => { e.currentTarget.style.display = 'none'; }}\r\n                                    alt={`View ${idx + 1}`}\r\n                                    className=\"w-full h-full object-contain rounded-lg\"\r\n                                />\r\n                            </button>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            {/* Product Details */}\r\n            <div className=\"flex flex-col h-full\">\r\n                <div className=\"mb-2\">\r\n                    {isOutOfStock ? (\r\n                        <span className=\"px-2.5 py-1 bg-red-100 dark:bg-red-900/30 text-red-700 dark:text-red-400 text-xs font-bold rounded-full uppercase tracking-wider\">Out of Stock</span>\r\n                    ) : (\r\n                        <span className=\"px-2.5 py-1 bg-green-100 dark:bg-green-900/30 text-green-700 dark:text-green-400 text-xs font-bold rounded-full uppercase tracking-wider\">In Stock ({product.stockQuantity})</span>\r\n                    )}\r\n                </div>\r\n                <h1 className=\"text-4xl font-bold text-slate-900 dark:text-white mb-2\">{product.name}</h1>\r\n                <div className=\"flex items-baseline gap-2 mb-6\">\r\n                    <span className=\"text-3xl font-bold text-primary\">{formatPrice(product.price)}</span>\r\n                    <span className=\"text-slate-500 dark:text-slate-400 text-lg\">/ {product.quantity || 'unit'}</span>\r\n                </div>\r\n                <div className=\"mb-8\">\r\n                    <p className={`text-slate-600 dark:text-slate-300 leading-relaxed whitespace-pre-line inline`}>\r\n                        {isExpanded ? description : description.slice(0, 150) + (description.length > 150 ? '...' : '')}\r\n                    </p>\r\n                    {description.length > 150 && (\r\n                        <button\r\n                            onClick={() => setIsExpanded(!isExpanded)}\r\n                            className=\"ml-2 text-primary font-bold hover:underline text-sm inline-block\"\r\n                        >\r\n                            {isExpanded ? 'See Less' : 'See All'}\r\n                        </button>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Color Selection */}\r\n                {product.colors && product.colors.length > 0 && (\r\n                    <div className=\"mb-8\">\r\n                        <h3 className=\"text-sm font-bold text-slate-900 dark:text-white uppercase tracking-wider mb-3\">Available Colors</h3>\r\n                        <div className=\"flex flex-wrap gap-3\">\r\n                            {product.colors.map((color) => (\r\n                                <button\r\n                                    key={color}\r\n                                    onClick={() => setSelectedColor(color)}\r\n                                    className={`px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all ${selectedColor === color\r\n                                        ? 'border-primary bg-primary/10 text-primary'\r\n                                        : 'border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 hover:border-primary/50'\r\n                                        }`}\r\n                                >\r\n                                    {color}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Size Selection */}\r\n                {product.sizes && product.sizes.length > 0 && (\r\n                    <div className=\"mb-8\">\r\n                        <h3 className=\"text-sm font-bold text-slate-900 dark:text-white uppercase tracking-wider mb-3\">Available Sizes</h3>\r\n                        <div className=\"flex flex-wrap gap-3\">\r\n                            {product.sizes.map((size) => (\r\n                                <button\r\n                                    key={size}\r\n                                    onClick={() => setSelectedSize(size)}\r\n                                    className={`min-w-[3rem] px-4 py-2 rounded-xl text-sm font-bold border-2 transition-all ${selectedSize === size\r\n                                        ? 'border-primary bg-primary/10 text-primary'\r\n                                        : 'border-slate-200 dark:border-slate-700 text-slate-600 dark:text-slate-400 hover:border-primary/50'\r\n                                        }`}\r\n                                >\r\n                                    {size}\r\n                                </button>\r\n                            ))}\r\n                        </div>\r\n                    </div>\r\n                )}\r\n\r\n                {/* Dynamic Product Info */}\r\n                <div className=\"space-y-6 mb-8\">\r\n                    {/* Rating & Vendor Row */}\r\n                    <div className=\"flex items-start justify-between gap-4 flex-wrap\">\r\n                        {/* Rating */}\r\n                        <div className=\"flex items-center gap-3 p-3 bg-amber-50 dark:bg-amber-900/10 rounded-xl border border-amber-100 dark:border-amber-900/30\">\r\n                            <div className=\"w-10 h-10 bg-amber-100 dark:bg-amber-900/30 rounded-lg flex items-center justify-center text-amber-500\">\r\n                                <span className=\"material-icons-round\">star</span>\r\n                            </div>\r\n                            <div>\r\n                                <div className=\"flex items-baseline gap-1.5\">\r\n                                    <span className=\"text-xl font-black text-slate-900 dark:text-white\">{product.average_rating || 0}</span>\r\n                                    <span className=\"text-xs font-bold text-slate-400\">/ 5</span>\r\n                                </div>\r\n                                <p className=\"text-xs font-medium text-amber-600 dark:text-amber-400\">{product.reviews_count || 0} Verified Reviews</p>\r\n                            </div>\r\n                        </div>\r\n\r\n                        {/* Vendor */}\r\n                        <div className=\"flex items-center gap-3 p-3 bg-blue-50 dark:bg-blue-900/10 rounded-xl border border-blue-100 dark:border-blue-900/30\">\r\n                            <div className=\"w-10 h-10 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center text-blue-500\">\r\n                                <span className=\"material-icons-round\">storefront</span>\r\n                            </div>\r\n                            <div>\r\n                                <p className=\"text-xs font-bold text-slate-400 uppercase tracking-wide mb-0.5\">Sold By</p>\r\n                                <p className=\"text-sm font-black text-slate-900 dark:text-white\">{product.vendor_name || 'Daily Fresh'}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Shipping Info */}\r\n                    <div className=\"bg-slate-50 dark:bg-slate-800/50 rounded-2xl border border-slate-100 dark:border-slate-700 overflow-hidden\">\r\n                        <div className=\"flex items-center gap-2 px-4 py-3 border-b border-slate-100 dark:border-slate-700 bg-white dark:bg-slate-800\">\r\n                            <span className=\"material-icons-round text-slate-400 text-sm\">local_shipping</span>\r\n                            <h4 className=\"text-sm font-bold text-slate-900 dark:text-white\">Delivery Charges</h4>\r\n                        </div>\r\n                        <div className=\"flex divide-x divide-slate-100 dark:divide-slate-700\">\r\n                            <div className=\"flex-1 p-3 text-center\">\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 mb-1\">Inside Dhaka</p>\r\n                                <p className=\"font-bold text-slate-900 dark:text-white\">{formatPrice(product.shipping_inside_dhaka || 60)}</p>\r\n                            </div>\r\n                            <div className=\"flex-1 p-3 text-center\">\r\n                                <p className=\"text-xs text-slate-500 dark:text-slate-400 mb-1\">Outside Dhaka</p>\r\n                                <p className=\"font-bold text-slate-900 dark:text-white\">{formatPrice(product.shipping_outside_dhaka || 120)}</p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"mt-auto pt-8 border-t border-slate-200 dark:border-slate-800\">\r\n                    <div className=\"flex items-center gap-6\">\r\n                        <div className=\"flex items-center bg-slate-100 dark:bg-slate-800 rounded-full p-1 w-36 justify-between\">\r\n                            <button\r\n                                onClick={() => setQuantity(Math.max(1, quantity - 1))}\r\n                                disabled={isOutOfStock}\r\n                                className=\"w-10 h-10 flex items-center justify-center bg-white dark:bg-slate-700 rounded-full shadow-sm hover:bg-slate-50 dark:hover:bg-slate-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                <span className=\"material-icons-round text-sm\">remove</span>\r\n                            </button>\r\n                            <span className=\"font-bold text-lg px-2 text-slate-900 dark:text-white\">{quantity}</span>\r\n                            <button\r\n                                onClick={() => setQuantity(quantity + 1)}\r\n                                disabled={isOutOfStock || quantity >= product.stockQuantity}\r\n                                className=\"w-10 h-10 flex items-center justify-center bg-primary text-white rounded-full shadow-lg shadow-green-500/20 hover:opacity-90 transition-opacity disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                            >\r\n                                <span className=\"material-icons-round text-sm\">add</span>\r\n                            </button>\r\n                        </div>\r\n                        <button\r\n                            onClick={handleAddToCart}\r\n                            disabled={isOutOfStock}\r\n                            className=\"flex-1 bg-primary text-white font-bold py-4 px-8 rounded-full shadow-xl shadow-green-500/20 hover:scale-[1.02] active:scale-[0.98] transition-all flex items-center justify-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none\"\r\n                        >\r\n                            <span className=\"material-icons-round\">shopping_basket</span>\r\n                            {isOutOfStock ? 'Out of Stock' : 'Add to cart'}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\product\\RelatedProducts.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\product\\Reviews.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'checkEligibility' and 'fetchReviews'. Either include them or remove the dependency array.","line":36,"column":8,"nodeType":"ArrayExpression","endLine":36,"endColumn":25,"suggestions":[{"desc":"Update the dependencies array to be: [checkEligibility, fetchReviews, productId, user]","fix":{"range":[1082,1099],"text":"[checkEligibility, fetchReviews, productId, user]"}}]},{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":126,"column":41,"nodeType":"JSXOpeningElement","endLine":126,"endColumn":133}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { checkReviewEligibility } from '@/lib/api';\r\nimport Link from 'next/link';\r\n\r\ninterface Review {\r\n    id: number;\r\n    user_id: string;\r\n    rating: number;\r\n    comment: string;\r\n    created_at: string;\r\n    profiles?: {\r\n        full_name: string;\r\n        avatar_url: string;\r\n    };\r\n}\r\n\r\nexport function Reviews({ productId }: { productId: number | string }) {\r\n    const { user } = useAuth();\r\n    const [reviews, setReviews] = useState<Review[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [submitting, setSubmitting] = useState(false);\r\n    const [rating, setRating] = useState(5);\r\n    const [comment, setComment] = useState('');\r\n    const [canReview, setCanReview] = useState(false);\r\n    const [checkingEligibility, setCheckingEligibility] = useState(false);\r\n\r\n    useEffect(() => {\r\n        fetchReviews();\r\n        if (user) {\r\n            checkEligibility();\r\n        }\r\n    }, [productId, user]);\r\n\r\n    const checkEligibility = async () => {\r\n        if (!user) return;\r\n        setCheckingEligibility(true);\r\n        try {\r\n            const allowed = await checkReviewEligibility(user.id, productId);\r\n            setCanReview(allowed);\r\n        } catch (error) {\r\n            console.error('Error checking review eligibility:', error);\r\n        } finally {\r\n            setCheckingEligibility(false);\r\n        }\r\n    };\r\n\r\n    const fetchReviews = async () => {\r\n        try {\r\n            const { data, error } = await supabase\r\n                .from('reviews')\r\n                .select(`\r\n                    *,\r\n                    profiles (\r\n                        full_name,\r\n                        avatar_url\r\n                    )\r\n                `)\r\n                .eq('product_id', productId)\r\n                .eq('is_hidden', false)\r\n                .order('created_at', { ascending: false });\r\n\r\n            if (error) throw error;\r\n            setReviews(data || []);\r\n        } catch (error) {\r\n            console.error('Error fetching reviews:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!user) return;\r\n\r\n        setSubmitting(true);\r\n        try {\r\n            const { error } = await supabase\r\n                .from('reviews')\r\n                .insert({\r\n                    user_id: user.id,\r\n                    product_id: productId,\r\n                    rating,\r\n                    comment\r\n                });\r\n\r\n            if (error) throw error;\r\n\r\n            setComment('');\r\n            setRating(5);\r\n            fetchReviews(); // Refresh list\r\n            checkEligibility(); // Re-check (should disable form)\r\n        } catch (error) {\r\n            console.error('Error submitting review:', error);\r\n            alert('Failed to submit review');\r\n        } finally {\r\n            setSubmitting(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <section className=\"py-12 border-t border-slate-100 dark:border-slate-700\">\r\n            <h2 className=\"text-2xl font-bold mb-8 text-slate-900 dark:text-white\">Customer Reviews</h2>\r\n\r\n            <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-12\">\r\n                {/* Reviews List */}\r\n                <div className=\"lg:col-span-2 space-y-6\">\r\n                    {loading ? (\r\n                        <div className=\"flex gap-4 animate-pulse\">\r\n                            <div className=\"w-12 h-12 bg-slate-200 dark:bg-slate-700 rounded-full\"></div>\r\n                            <div className=\"flex-1 space-y-2\">\r\n                                <div className=\"h-4 bg-slate-200 dark:bg-slate-700 rounded w-1/4\"></div>\r\n                                <div className=\"h-4 bg-slate-200 dark:bg-slate-700 rounded w-full\"></div>\r\n                            </div>\r\n                        </div>\r\n                    ) : reviews.length === 0 ? (\r\n                        <p className=\"text-slate-500 italic\">No reviews yet. Be the first to review!</p>\r\n                    ) : (\r\n                        reviews.map((review) => (\r\n                            <div key={review.id} className=\"flex gap-4\">\r\n                                <div className=\"w-12 h-12 rounded-full bg-slate-100 dark:bg-slate-800 flex items-center justify-center overflow-hidden border border-slate-200 dark:border-slate-700 shrink-0\">\r\n                                    {review.profiles?.avatar_url ? (\r\n                                        <img src={review.profiles.avatar_url} alt=\"Avatar\" className=\"w-full h-full object-cover\" />\r\n                                    ) : (\r\n                                        <span className=\"material-icons-round text-slate-400\">person</span>\r\n                                    )}\r\n                                </div>\r\n                                <div>\r\n                                    <div className=\"flex items-center gap-2 mb-1\">\r\n                                        <h4 className=\"font-bold text-slate-900 dark:text-white\">{review.profiles?.full_name || 'Anonymous'}</h4>\r\n                                        <span className=\"text-xs text-slate-400\">ΓÇó {new Date(review.created_at).toLocaleDateString()}</span>\r\n                                    </div>\r\n                                    <div className=\"flex items-center gap-1 mb-2\">\r\n                                        {[...Array(5)].map((_, i) => (\r\n                                            <span key={i} className={`material-icons-round text-sm ${i < review.rating ? 'text-yellow-400' : 'text-slate-200 dark:text-slate-700'}`}>star</span>\r\n                                        ))}\r\n                                    </div>\r\n                                    <p className=\"text-slate-600 dark:text-slate-300 leading-relaxed\">{review.comment}</p>\r\n                                </div>\r\n                            </div>\r\n                        ))\r\n                    )}\r\n                </div>\r\n\r\n                {/* Write Review Form */}\r\n                <div className=\"bg-slate-50 dark:bg-slate-800/50 rounded-2xl p-6 h-fit border border-slate-100 dark:border-slate-700\">\r\n                    <h3 className=\"text-lg font-bold mb-4 text-slate-900 dark:text-white\">Write a Review</h3>\r\n                    {checkingEligibility ? (\r\n                        <div className=\"flex gap-2 items-center text-slate-500 text-sm\">\r\n                            <span className=\"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin\"></span>\r\n                            Checking eligibility...\r\n                        </div>\r\n                    ) : user ? (\r\n                        canReview ? (\r\n                            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n                                <div>\r\n                                    <label className=\"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300\">Rating</label>\r\n                                    <div className=\"flex items-center gap-1\">\r\n                                        {[1, 2, 3, 4, 5].map((star) => (\r\n                                            <button\r\n                                                key={star}\r\n                                                type=\"button\"\r\n                                                onClick={() => setRating(star)}\r\n                                                className={`w-8 h-8 rounded-lg flex items-center justify-center transition-all ${rating >= star ? 'text-yellow-400 bg-yellow-400/10' : 'text-slate-300 hover:text-yellow-400'}`}\r\n                                            >\r\n                                                <span className=\"material-icons-round\">star</span>\r\n                                            </button>\r\n                                        ))}\r\n                                    </div>\r\n                                </div>\r\n                                <div>\r\n                                    <label className=\"block text-sm font-semibold mb-2 text-slate-700 dark:text-slate-300\">Review</label>\r\n                                    <textarea\r\n                                        value={comment}\r\n                                        onChange={(e) => setComment(e.target.value)}\r\n                                        className=\"w-full rounded-xl bg-white dark:bg-slate-800 border-none p-4 text-slate-900 dark:text-white focus:ring-2 focus:ring-primary/20 placeholder:text-slate-400\"\r\n                                        rows={4}\r\n                                        placeholder=\"Share your thoughts...\"\r\n                                        required\r\n                                    ></textarea>\r\n                                </div>\r\n                                <button\r\n                                    type=\"submit\"\r\n                                    disabled={submitting}\r\n                                    className=\"w-full py-3 rounded-xl bg-primary text-white font-bold hover:bg-primary/90 transition-all disabled:opacity-70\"\r\n                                >\r\n                                    {submitting ? 'Submitting...' : 'Post Review'}\r\n                                </button>\r\n                            </form>\r\n                        ) : (\r\n                            <div className=\"text-center py-6 bg-white dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700\">\r\n                                <span className=\"material-icons-round text-3xl text-slate-300 mb-2\">lock</span>\r\n                                <p className=\"text-slate-500 dark:text-slate-400 text-sm mb-1 font-bold\">Verified Purchase Only</p>\r\n                                <p className=\"text-xs text-slate-400 px-4\">You can write a review after you have purchased and received this product.</p>\r\n                            </div>\r\n                        )\r\n                    ) : (\r\n                        <div className=\"text-center py-6\">\r\n                            <p className=\"text-slate-500 mb-4\">Please log in to write a review.</p>\r\n                            <Link href=\"/login\" className=\"inline-block px-6 py-2 rounded-xl bg-slate-900 dark:bg-white text-white dark:text-slate-900 font-bold\">\r\n                                Login\r\n                            </Link>\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </section>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\AddressCard.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAddress'. Either include it or remove the dependency array.","line":23,"column":8,"nodeType":"ArrayExpression","endLine":23,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchAddress, user]","fix":{"range":[816,822],"text":"[fetchAddress, user]"}}]}],"suppressedMessages":[{"ruleId":"react-hooks/set-state-in-effect","severity":2,"message":"Error: Calling setState synchronously within an effect can trigger cascading renders\n\nEffects are intended to synchronize state between React and external systems such as manually updating the DOM, state management libraries, or other platform APIs. In general, the body of an effect should do one or both of the following:\n* Update external systems with the latest state from React.\n* Subscribe for updates from some external system, calling setState in a callback function when external state changes.\n\nCalling setState synchronously within an effect body causes cascading renders that can hurt performance, and is not recommended. (https://react.dev/learn/you-might-not-need-an-effect).\n\nF:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\AddressCard.tsx:22:9\n  20 |     useEffect(() => {\n  21 |         // eslint-disable-next-line react-hooks/set-state-in-effect\n> 22 |         fetchAddress();\n     |         ^^^^^^^^^^^^ Avoid calling setState() directly within an effect\n  23 |     }, [user]);\n  24 |\n  25 |     return (","line":22,"column":9,"nodeType":null,"endLine":22,"endColumn":21,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { useAuth } from '@/context/AuthContext';\r\nimport { Address, getUserAddresses } from '@/lib/api';\r\nimport { AddressManagerModal } from './AddressManagerModal';\r\n\r\nexport function AddressCard() {\r\n    const { user } = useAuth();\r\n    const [defaultAddress, setDefaultAddress] = useState<Address | null>(null);\r\n    const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n    const fetchAddress = async () => {\r\n        if (!user) return;\r\n        const addresses = await getUserAddresses(user.id);\r\n        const def = addresses.find(a => a.isDefault) || addresses[0] || null;\r\n        setDefaultAddress(def);\r\n    };\r\n\r\n    useEffect(() => {\r\n        // eslint-disable-next-line react-hooks/set-state-in-effect\r\n        fetchAddress();\r\n    }, [user]);\r\n\r\n    return (\r\n        <>\r\n            <div className=\"p-6 rounded-2xl bg-white dark:bg-[#10221c] border border-[#cfe7df] dark:border-[#1e3a31] shadow-sm\">\r\n                <h3 className=\"font-bold text-[#0d1b17] dark:text-white mb-4 flex items-center gap-2\">\r\n                    <span className=\"material-icons-round text-primary\">home_pin</span>\r\n                    Default Address\r\n                </h3>\r\n\r\n                {defaultAddress ? (\r\n                    <>\r\n                        <p className=\"text-sm font-bold text-[#0d1b17] dark:text-white\">{defaultAddress.label}</p>\r\n                        <p className=\"text-sm text-[#4c9a80] mt-1 leading-relaxed\">\r\n                            {defaultAddress.street}<br />\r\n                            {defaultAddress.city}, {defaultAddress.state} {defaultAddress.postalCode}<br />\r\n                            {defaultAddress.country}\r\n                        </p>\r\n                    </>\r\n                ) : (\r\n                    <p className=\"text-sm text-slate-500 italic\">No address saved.</p>\r\n                )}\r\n\r\n                <button\r\n                    onClick={() => setIsModalOpen(true)}\r\n                    className=\"mt-4 text-xs font-bold text-primary hover:underline hover:cursor-pointer\"\r\n                >\r\n                    Manage Addresses\r\n                </button>\r\n            </div>\r\n\r\n            <AddressManagerModal\r\n                isOpen={isModalOpen}\r\n                onClose={() => setIsModalOpen(false)}\r\n                onUpdate={fetchAddress}\r\n            />\r\n        </>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\AddressList.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\AddressManagerModal.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchAddresses'. Either include it or remove the dependency array.","line":44,"column":8,"nodeType":"ArrayExpression","endLine":44,"endColumn":42,"suggestions":[{"desc":"Update the dependencies array to be: [isOpen, user, initialEditAddress, fetchAddresses]","fix":{"range":[1491,1525],"text":"[isOpen, user, initialEditAddress, fetchAddresses]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { useState, useEffect } from 'react';\r\nimport { Address, getUserAddresses, saveAddress, deleteAddress, setDefaultAddress } from '@/lib/api';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\ninterface AddressManagerModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    onUpdate: () => void;\r\n    initialEditAddress?: Address | null; // Pass address to edit immediately\r\n}\r\n\r\nexport function AddressManagerModal({ isOpen, onClose, onUpdate, initialEditAddress }: AddressManagerModalProps) {\r\n    const { user } = useAuth();\r\n    const [addresses, setAddresses] = useState<Address[]>([]);\r\n    const [view, setView] = useState<'list' | 'form'>('list');\r\n    const [loading, setLoading] = useState(false);\r\n    const [editingAddress, setEditingAddress] = useState<Partial<Address> | null>(null);\r\n\r\n    // Form State\r\n    const [formData, setFormData] = useState({\r\n        label: 'Home',\r\n        fullName: '',\r\n        phone: '',\r\n        street: '',\r\n        city: '',\r\n        state: '',\r\n        postalCode: '',\r\n        country: 'Bangladesh',\r\n        isDefault: false\r\n    });\r\n\r\n    useEffect(() => {\r\n        if (isOpen && user) {\r\n            // Decision: If initialEditAddress is provided, jump straight to form\r\n            if (initialEditAddress) {\r\n                handleEdit(initialEditAddress);\r\n            } else {\r\n                fetchAddresses();\r\n                setView('list'); // Default to list\r\n            }\r\n        }\r\n    }, [isOpen, user, initialEditAddress]);\r\n\r\n    const fetchAddresses = async () => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            const data = await getUserAddresses(user.id);\r\n            setAddresses(data);\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleEdit = (address: Address) => {\r\n        setEditingAddress(address);\r\n        setFormData({\r\n            label: address.label,\r\n            fullName: address.fullName,\r\n            phone: address.phone,\r\n            street: address.street,\r\n            city: address.city,\r\n            state: address.state,\r\n            postalCode: address.postalCode,\r\n            country: address.country,\r\n            isDefault: address.isDefault\r\n        });\r\n        setView('form');\r\n    };\r\n\r\n    const handleAddNew = () => {\r\n        setEditingAddress(null);\r\n        setFormData({\r\n            label: 'Home',\r\n            fullName: user?.user_metadata?.full_name || '',\r\n            phone: '',\r\n            street: '',\r\n            city: '',\r\n            state: '',\r\n            postalCode: '',\r\n            country: 'Bangladesh',\r\n            isDefault: addresses.length === 0\r\n        });\r\n        setView('form');\r\n    };\r\n\r\n    const handleSave = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!user) return;\r\n\r\n        setLoading(true);\r\n        try {\r\n            await saveAddress(user.id, {\r\n                ...formData,\r\n                id: editingAddress?.id\r\n            });\r\n\r\n            // If we came from external edit, close immediately\r\n            if (initialEditAddress) {\r\n                onUpdate();\r\n                onClose();\r\n            } else {\r\n                await fetchAddresses();\r\n                setView('list');\r\n                onUpdate();\r\n            }\r\n        } catch (error) {\r\n            alert('Failed to save address');\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleDelete = async (id: string) => {\r\n        if (!confirm('Are you sure you want to delete this address?')) return;\r\n        setLoading(true);\r\n        try {\r\n            await deleteAddress(id);\r\n            await fetchAddresses();\r\n            onUpdate();\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const handleSetDefault = async (id: string) => {\r\n        if (!user) return;\r\n        setLoading(true);\r\n        try {\r\n            await setDefaultAddress(user.id, id);\r\n            await fetchAddresses();\r\n            onUpdate();\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-[#10221c] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-100 dark:border-[#1e3a31] flex justify-between items-center\">\r\n                    <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">\r\n                        {view === 'list' && !initialEditAddress ? 'Manage Addresses' : (editingAddress ? 'Edit Address' : 'Add New Address')}\r\n                    </h2>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-slate-100 dark:hover:bg-[#1e3a31] rounded-full transition-colors\">\r\n                        <span className=\"material-icons-round text-slate-500\">close</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6\">\r\n                    {view === 'list' && !initialEditAddress ? (\r\n                        <div className=\"space-y-4\">\r\n                            <button\r\n                                onClick={handleAddNew}\r\n                                className=\"w-full py-4 border-2 border-dashed border-primary/30 rounded-xl flex items-center justify-center gap-2 text-primary font-bold hover:bg-primary/5 transition-colors\"\r\n                            >\r\n                                <span className=\"material-icons-round\">add</span>\r\n                                Add New Address\r\n                            </button>\r\n\r\n                            {loading && <div className=\"text-center py-4\">Loading...</div>}\r\n\r\n                            <div className=\"grid gap-4\">\r\n                                {addresses.map(addr => (\r\n                                    <div key={addr.id} className={`relative p-4 rounded-xl border ${addr.isDefault ? 'border-primary bg-primary/5' : 'border-slate-200 dark:border-[#1e3a31]'} transition-all`}>\r\n                                        <div className=\"flex justify-between items-start\">\r\n                                            <div>\r\n                                                <div className=\"flex items-center gap-2 mb-1\">\r\n                                                    <span className=\"font-bold text-slate-900 dark:text-white\">{addr.label}</span>\r\n                                                    {addr.isDefault && (\r\n                                                        <span className=\"px-2 py-0.5 text-xs font-bold bg-primary text-white rounded-full\">Default</span>\r\n                                                    )}\r\n                                                </div>\r\n                                                <p className=\"text-sm text-slate-600 dark:text-slate-400 font-medium\">{addr.fullName} <span className=\"text-slate-400\">ΓÇó</span> {addr.phone}</p>\r\n                                                <p className=\"text-sm text-slate-500 mt-1\">\r\n                                                    {addr.street}, {addr.city}, {addr.state} {addr.postalCode}\r\n                                                </p>\r\n                                            </div>\r\n                                            <div className=\"flex gap-2\">\r\n                                                <button onClick={() => handleEdit(addr)} className=\"p-2 text-slate-400 hover:text-primary transition-colors\">\r\n                                                    <span className=\"material-icons-round text-xl\">edit</span>\r\n                                                </button>\r\n                                                <button onClick={() => handleDelete(addr.id)} className=\"p-2 text-slate-400 hover:text-red-500 transition-colors\">\r\n                                                    <span className=\"material-icons-round text-xl\">delete</span>\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                        {!addr.isDefault && (\r\n                                            <button\r\n                                                onClick={() => handleSetDefault(addr.id)}\r\n                                                className=\"mt-3 text-sm font-bold text-slate-500 hover:text-primary transition-colors\"\r\n                                            >\r\n                                                Set as Default\r\n                                            </button>\r\n                                        )}\r\n                                    </div>\r\n                                ))}\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <form onSubmit={handleSave} className=\"space-y-4\">\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormInput label=\"Label (e.g. Home)\" value={formData.label} onChange={v => setFormData({ ...formData, label: v })} required />\r\n                                <FormInput label=\"Full Name\" value={formData.fullName} onChange={v => setFormData({ ...formData, fullName: v })} required />\r\n                            </div>\r\n                            <FormInput label=\"Phone Number\" value={formData.phone} onChange={v => setFormData({ ...formData, phone: v })} required />\r\n                            <FormInput label=\"Street Address\" value={formData.street} onChange={v => setFormData({ ...formData, street: v })} required />\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormInput label=\"City\" value={formData.city} onChange={v => setFormData({ ...formData, city: v })} required />\r\n                                <FormInput label=\"State / Region\" value={formData.state} onChange={v => setFormData({ ...formData, state: v })} />\r\n                            </div>\r\n                            <div className=\"grid grid-cols-2 gap-4\">\r\n                                <FormInput label=\"Postal Code\" value={formData.postalCode} onChange={v => setFormData({ ...formData, postalCode: v })} required />\r\n                                <FormInput label=\"Country\" value={formData.country} onChange={v => setFormData({ ...formData, country: v })} required />\r\n                            </div>\r\n\r\n                            <div className=\"flex items-center gap-3 pt-2\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    id=\"isDefault\"\r\n                                    checked={formData.isDefault}\r\n                                    onChange={e => setFormData({ ...formData, isDefault: e.target.checked })}\r\n                                    className=\"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary\"\r\n                                />\r\n                                <label htmlFor=\"isDefault\" className=\"text-sm font-medium text-slate-700 dark:text-slate-300\">\r\n                                    Set as default address\r\n                                </label>\r\n                            </div>\r\n\r\n                            <div className=\"flex gap-4 pt-4\">\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={() => {\r\n                                        if (initialEditAddress) {\r\n                                            onClose();\r\n                                        } else {\r\n                                            setView('list');\r\n                                        }\r\n                                    }}\r\n                                    className=\"flex-1 py-3 font-bold text-slate-600 dark:text-slate-300 bg-slate-100 dark:bg-slate-800 rounded-xl hover:bg-slate-200 dark:hover:bg-slate-700 transition-colors\"\r\n                                >\r\n                                    Cancel\r\n                                </button>\r\n                                <button type=\"submit\" disabled={loading} className=\"flex-1 py-3 font-bold text-white bg-primary rounded-xl hover:bg-primary/90 transition-colors shadow-lg shadow-primary/20\">\r\n                                    {loading ? 'Saving...' : 'Save Address'}\r\n                                </button>\r\n                            </div>\r\n                        </form>\r\n                    )}\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction FormInput({ label, value, onChange, required }: { label: string, value: string, onChange: (v: string) => void, required?: boolean }) {\r\n    return (\r\n        <div>\r\n            <label className=\"block text-xs font-bold text-slate-500 uppercase tracking-wider mb-1.5\">{label}</label>\r\n            <input\r\n                type=\"text\"\r\n                value={value}\r\n                onChange={e => onChange(e.target.value)}\r\n                required={required}\r\n                className=\"w-full px-4 py-3 bg-slate-50 dark:bg-slate-800/50 border border-slate-200 dark:border-slate-700 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary/50 text-slate-900 dark:text-white font-medium\"\r\n            />\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\MembershipCard.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\OrderDetailsModal.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":66,"column":53,"nodeType":"JSXOpeningElement","endLine":66,"endColumn":132}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { formatPrice } from '@/lib/format';\r\n\r\ninterface OrderDetailsModalProps {\r\n    isOpen: boolean;\r\n    onClose: () => void;\r\n    order: any;\r\n    loading?: boolean;\r\n}\r\n\r\nexport function OrderDetailsModal({ isOpen, onClose, order, loading }: OrderDetailsModalProps) {\r\n    if (!isOpen) return null;\r\n\r\n    return (\r\n        <div className=\"fixed inset-0 z-[100] flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm\">\r\n            <div className=\"bg-white dark:bg-[#10221c] w-full max-w-2xl rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] animate-in fade-in zoom-in duration-200\">\r\n                {/* Header */}\r\n                <div className=\"p-6 border-b border-slate-100 dark:border-[#1e3a31] flex justify-between items-center bg-slate-50/50 dark:bg-white/5\">\r\n                    <div>\r\n                        <h2 className=\"text-xl font-bold text-slate-900 dark:text-white\">\r\n                            Order Details\r\n                        </h2>\r\n                        {order && (\r\n                            <p className=\"text-sm text-slate-500 mt-1\">\r\n                                #{order.id.slice(0, 8).toUpperCase()} ΓÇó {new Date(order.created_at).toLocaleDateString()}\r\n                            </p>\r\n                        )}\r\n                    </div>\r\n                    <button onClick={onClose} className=\"p-2 hover:bg-slate-100 dark:hover:bg-[#1e3a31] rounded-full transition-colors\">\r\n                        <span className=\"material-icons-round text-slate-500\">close</span>\r\n                    </button>\r\n                </div>\r\n\r\n                {/* Content */}\r\n                <div className=\"flex-1 overflow-y-auto p-6\">\r\n                    {loading ? (\r\n                        <div className=\"flex flex-col items-center justify-center py-12\">\r\n                            <div className=\"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-primary mb-4\"></div>\r\n                            <p className=\"text-slate-500 font-medium\">Loading details...</p>\r\n                        </div>\r\n                    ) : order ? (\r\n                        <div className=\"space-y-6\">\r\n                            {/* Status Banner */}\r\n                            <div className={`p-4 rounded-xl flex items-center gap-3 ${order.status === 'delivered' ? 'bg-[#f1f5f9] text-[#64748b]' : 'bg-[#e7f3ef] text-[#07882e]'\r\n                                }`}>\r\n                                <span className=\"material-icons-round\">\r\n                                    {order.status === 'delivered' ? 'check_circle' : 'inventory_2'}\r\n                                </span>\r\n                                <div>\r\n                                    <p className=\"font-bold uppercase text-xs tracking-wider\">Order Status</p>\r\n                                    <p className=\"font-bold text-sm\">\r\n                                        {order.status === 'delivered' ? 'Delivered' : order.status.charAt(0).toUpperCase() + order.status.slice(1)}\r\n                                    </p>\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Items List */}\r\n                            <div>\r\n                                <h3 className=\"text-sm font-bold text-slate-500 uppercase tracking-wider mb-3\">Items</h3>\r\n                                <div className=\"space-y-3\">\r\n                                    {order.items?.map((item: any) => (\r\n                                        <div key={item.id} className=\"flex gap-4 p-3 rounded-xl border border-slate-100 dark:border-[#1e3a31] bg-slate-50/50 dark:bg-white/5\">\r\n                                            <div className=\"size-16 rounded-lg bg-white dark:bg-black/20 shrink-0 overflow-hidden\">\r\n                                                {item.image ? (\r\n                                                    <img src={item.image} alt={item.name} className=\"w-full h-full object-cover\" />\r\n                                                ) : (\r\n                                                    <div className=\"w-full h-full flex items-center justify-center bg-slate-100 dark:bg-slate-800\">\r\n                                                        <span className=\"material-icons-round text-slate-300\">image</span>\r\n                                                    </div>\r\n                                                )}\r\n                                            </div>\r\n                                            <div className=\"flex-1 min-w-0\">\r\n                                                <p className=\"font-bold text-slate-900 dark:text-white truncate\">{item.name}</p>\r\n                                                <p className=\"text-xs text-slate-500 mt-1\">Quantity: {item.quantity}</p>\r\n                                                <p className=\"text-sm font-bold text-primary mt-1\">{formatPrice(item.price)}</p>\r\n                                            </div>\r\n                                            <div className=\"text-right font-bold text-slate-900 dark:text-white\">\r\n                                                {formatPrice(item.price * item.quantity)}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            </div>\r\n\r\n                            {/* Summary */}\r\n                            <div className=\"border-t border-slate-100 dark:border-[#1e3a31] pt-4 mt-6\">\r\n                                <div className=\"flex justify-between items-center text-lg font-bold text-slate-900 dark:text-white\">\r\n                                    <span>Total Amount</span>\r\n                                    <span>{formatPrice(order.total_amount)}</span>\r\n                                </div>\r\n                            </div>\r\n                        </div>\r\n                    ) : (\r\n                        <div className=\"text-center py-12 text-slate-500\">\r\n                            Failed to load order details.\r\n                        </div>\r\n                    )}\r\n                </div>\r\n\r\n                {/* Footer */}\r\n                <div className=\"p-4 border-t border-slate-100 dark:border-[#1e3a31] bg-slate-50/50 dark:bg-white/5 flex justify-end\">\r\n                    <button\r\n                        onClick={onClose}\r\n                        className=\"px-6 py-2.5 bg-slate-200 dark:bg-slate-800 hover:bg-slate-300 dark:hover:bg-slate-700 text-slate-800 dark:text-white font-bold rounded-xl transition-colors\"\r\n                    >\r\n                        Close\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\ProfileSidebar.tsx","messages":[{"ruleId":"@next/next/no-img-element","severity":1,"message":"Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` or a custom image loader to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element","line":20,"column":33,"nodeType":"JSXOpeningElement","endLine":20,"endColumn":129}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\nimport Link from 'next/link';\r\nimport { useAuth } from '@/context/AuthContext';\r\n\r\nexport function ProfileSidebar({ activeTab = 'overview' }: { activeTab?: string }) {\r\n    const { user } = useAuth();\r\n\r\n    return (\r\n        <aside className=\"hidden lg:flex w-72 flex-col border-r border-[#cfe7df] dark:border-[#1e3a31] bg-white dark:bg-[#10221c] p-6 h-[calc(100vh-64px)] sticky top-16\">\r\n            <div className=\"flex flex-col h-full justify-between\">\r\n                <div className=\"flex flex-col gap-8\">\r\n                    <Link href=\"/\" className=\"flex items-center gap-2 text-slate-500 hover:text-primary transition-colors group\">\r\n                        <span className=\"material-icons-round text-xl group-hover:-translate-x-1 transition-transform\">arrow_back</span>\r\n                        <span className=\"font-semibold\">Back to Home</span>\r\n                    </Link>\r\n\r\n                    <div className=\"flex gap-3 items-center\">\r\n                        <div className=\"bg-center bg-no-repeat aspect-square bg-cover rounded-full size-12 border-2 border-primary overflow-hidden\">\r\n                            {user?.user_metadata?.avatar_url ? (\r\n                                <img src={user.user_metadata.avatar_url} alt=\"Profile\" className=\"w-full h-full object-cover\" />\r\n                            ) : (\r\n                                <div className=\"w-full h-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center\">\r\n                                    <span className=\"material-icons-round text-slate-400\">person</span>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                        <div className=\"flex flex-col\">\r\n                            <h1 className=\"text-[#0d1b17] dark:text-white text-base font-bold leading-none\">\r\n                                {user?.user_metadata?.full_name || 'User'}\r\n                            </h1>\r\n                            <p className=\"text-[#4c9a80] text-xs font-normal mt-1\">Prime Member</p>\r\n                        </div>\r\n                    </div>\r\n                    <nav className=\"flex flex-col gap-2\">\r\n                        <Link href=\"/profile\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${activeTab === 'overview' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">account_circle</span>\r\n                            <span className=\"text-sm font-semibold\">Profile Overview</span>\r\n                        </Link>\r\n                        <Link href=\"/profile/orders\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${activeTab === 'orders' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">shopping_bag</span>\r\n                            <span className=\"text-sm font-medium\">My Orders</span>\r\n                        </Link>\r\n                        <Link href=\"/profile/wishlist\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${activeTab === 'wishlist' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">favorite</span>\r\n                            <span className=\"text-sm font-medium\">Wishlist</span>\r\n                        </Link>\r\n                        <Link href=\"/profile/addresses\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${activeTab === 'addresses' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">location_on</span>\r\n                            <span className=\"text-sm font-medium\">Saved Addresses</span>\r\n                        </Link>\r\n                        <Link href=\"/profile/payment\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors ${activeTab === 'payment' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">credit_card</span>\r\n                            <span className=\"text-sm font-medium\">Payment Methods</span>\r\n                        </Link>\r\n                        <Link href=\"/profile/settings\" className={`flex items-center gap-3 px-3 py-3 rounded-xl transition-colors mt-4 border-t border-[#cfe7df] pt-6 ${activeTab === 'settings' ? 'bg-primary/10 text-primary' : 'hover:bg-[#e7f3ef] dark:hover:bg-[#1e3a31] text-[#0d1b17] dark:text-white'}`}>\r\n                            <span className=\"material-icons-round\">settings</span>\r\n                            <span className=\"text-sm font-medium\">Settings</span>\r\n                        </Link>\r\n                    </nav>\r\n                </div>\r\n                <button className=\"flex w-full cursor-pointer items-center justify-center rounded-xl h-12 bg-primary text-[#0d1b17] font-bold shadow-lg shadow-primary/20 hover:scale-[1.02] transition-transform\">\r\n                    <span className=\"material-icons-round mr-2\">edit</span>\r\n                    <span>Edit Profile</span>\r\n                </button>\r\n            </div>\r\n        </aside>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\ProfileStats.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'Link' is defined but never used.","line":1,"column":8,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":12,"suggestions":[{"messageId":"removeUnusedImportDeclaration","data":{"varName":"Link"},"fix":{"range":[0,29],"text":""},"desc":"Remove unused import declaration."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import Link from 'next/link';\r\nimport { formatPrice } from '@/lib/format';\r\n\r\nexport function ProfileStats({ stats }: { stats: any }) {\r\n    return (\r\n        <div className=\"grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-8\">\r\n            <div className=\"flex flex-col gap-2 rounded-2xl p-6 bg-white dark:bg-[#10221c] border border-[#cfe7df] dark:border-[#1e3a31] shadow-sm\">\r\n                <div className=\"flex justify-between items-start\">\r\n                    <p className=\"text-[#4c9a80] text-sm font-medium\">Active Orders</p>\r\n                    <span className=\"material-icons-round text-primary\">local_shipping</span>\r\n                </div>\r\n                <p className=\"text-[#0d1b17] dark:text-white text-3xl font-bold\">{stats.activeOrders}</p>\r\n                <div className=\"flex items-center gap-1 text-[#07882e] text-xs font-bold\">\r\n                    <span className=\"material-icons-round text-sm\">trending_up</span>\r\n                    <span>+1 from last week</span>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-2 rounded-2xl p-6 bg-white dark:bg-[#10221c] border border-[#cfe7df] dark:border-[#1e3a31] shadow-sm\">\r\n                <div className=\"flex justify-between items-start\">\r\n                    <p className=\"text-[#4c9a80] text-sm font-medium\">Pending Orders</p>\r\n                    <span className=\"material-icons-round text-[#facc15]\">inventory_2</span>\r\n                </div>\r\n                <p className=\"text-[#0d1b17] dark:text-white text-3xl font-bold\">{stats.pendingOrders}</p>\r\n                <div className=\"flex items-center gap-1 text-[#07882e] text-xs font-bold\">\r\n                    <span className=\"material-icons-round text-sm\">hourglass_empty</span>\r\n                    <span>Awaiting processing</span>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-2 rounded-2xl p-6 bg-white dark:bg-[#10221c] border border-[#cfe7df] dark:border-[#1e3a31] shadow-sm\">\r\n                <div className=\"flex justify-between items-start\">\r\n                    <p className=\"text-[#4c9a80] text-sm font-medium\">Saved Items</p>\r\n                    <span className=\"material-icons-round text-[#ef4444]\">favorite</span>\r\n                </div>\r\n                <p className=\"text-[#0d1b17] dark:text-white text-3xl font-bold\">{stats.savedItems}</p>\r\n                <div className=\"flex items-center gap-1 text-[#4c9a80] text-xs font-bold\">\r\n                    <span>No changes today</span>\r\n                </div>\r\n            </div>\r\n            <div className=\"flex flex-col gap-2 rounded-2xl p-6 bg-white dark:bg-[#10221c] border border-[#cfe7df] dark:border-[#1e3a31] shadow-sm\">\r\n                <div className=\"flex justify-between items-start\">\r\n                    <p className=\"text-[#4c9a80] text-sm font-medium\">Completed Orders</p>\r\n                    <span className=\"material-icons-round text-[#07882e]\">check_circle</span>\r\n                </div>\r\n                <p className=\"text-[#0d1b17] dark:text-white text-3xl font-bold\">{stats.completedOrders}</p>\r\n                <div className=\"flex items-center gap-1 text-[#07882e] text-xs font-bold\">\r\n                    <span className=\"material-icons-round text-sm\">payments</span>\r\n                    <span>Total Spent: {formatPrice(stats.totalSpent)}</span>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\QuickActions.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\components\\profile\\RecentOrders.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\AdminAuthContext.tsx","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'router' is assigned a value but never used.","line":37,"column":11,"nodeType":"Identifier","messageId":"unusedVar","endLine":37,"endColumn":17},{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has missing dependencies: 'adminLoading' and 'supabase'. Either include them or remove the dependency array.","line":110,"column":8,"nodeType":"ArrayExpression","endLine":110,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [adminLoading, supabase]","fix":{"range":[4021,4023],"text":"[adminLoading, supabase]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport { createContext, useContext, useEffect, useState } from 'react';\r\nimport { createClient } from '@/lib/supabase/client';\r\nimport { useRouter } from 'next/navigation';\r\n\r\nexport interface AdminUser {\r\n    id: string;\r\n    email?: string | null;\r\n    role: 'SUPERADMIN' | 'MERCHANT' | 'CUSTOMER'; // Updated to match schema\r\n    full_name?: string;\r\n    shop_name?: string;\r\n    phone?: string;\r\n    image?: string | null;\r\n}\r\n\r\ntype AdminAuthContextType = {\r\n    adminUser: AdminUser | null;\r\n    adminLoading: boolean;\r\n    signOutAdmin: () => Promise<void>;\r\n    setAdminUser: React.Dispatch<React.SetStateAction<AdminUser | null>>;\r\n};\r\n\r\nconst AdminAuthContext = createContext<AdminAuthContextType>({\r\n    adminUser: null,\r\n    adminLoading: true,\r\n    signOutAdmin: async () => { },\r\n    setAdminUser: () => { },\r\n});\r\n\r\nexport const useAdminAuth = () => useContext(AdminAuthContext);\r\n\r\n\r\nexport function AdminAuthProvider({ children }: { children: React.ReactNode }) {\r\n    const [adminUser, setAdminUser] = useState<AdminUser | null>(null);\r\n    const [adminLoading, setAdminLoading] = useState(true);\r\n    const router = useRouter();\r\n    const supabase = createClient();\r\n\r\n\r\n    useEffect(() => {\r\n        let mounted = true;\r\n\r\n        // Safety timeout to prevent infinite loading if Supabase hangs\r\n        const loadingTimer = setTimeout(() => {\r\n            if (mounted && adminLoading) {\r\n                console.warn(\"Admin Auth check timed out, forcing loading false\");\r\n                setAdminLoading(false);\r\n            }\r\n        }, 5000);\r\n\r\n        const {\r\n            data: { subscription },\r\n        } = supabase.auth.onAuthStateChange(async (event, session) => {\r\n            if (!mounted) return;\r\n\r\n            console.log(\"AdminAuth event:\", event, \"User:\", session?.user?.email);\r\n\r\n            if (session?.user) {\r\n                try {\r\n                    // Fetch role from public.User\r\n                    const { data: profile, error } = await supabase\r\n                        .from('User')\r\n                        .select('role, name, shopName, id, email')\r\n                        .eq('id', session.user.id)\r\n                        .single();\r\n\r\n                    if (error) {\r\n                        console.error(\"Error fetching admin profile:\", error);\r\n                        // Don't set adminUser if profile fetch fails\r\n                        setAdminUser(null);\r\n                    } else if (profile) {\r\n                        const role = profile.role as 'SUPERADMIN' | 'MERCHANT' | 'CUSTOMER';\r\n                        // Check permissions\r\n                        if (role !== 'SUPERADMIN' && role !== 'MERCHANT') {\r\n                            console.warn(\"User logged in but not admin/merchant:\", role);\r\n                            setAdminUser(null);\r\n                        } else {\r\n                            setAdminUser({\r\n                                id: session.user.id,\r\n                                email: session.user.email,\r\n                                role: role,\r\n                                full_name: profile.name,\r\n                                shop_name: profile.shopName,\r\n                                image: session.user.user_metadata?.avatar_url\r\n                            });\r\n                        }\r\n                    } else {\r\n                        console.warn(\"No profile found for user:\", session.user.id);\r\n                        setAdminUser(null);\r\n                    }\r\n                } catch (e) {\r\n                    console.error(\"Exception fetching admin profile:\", e);\r\n                    setAdminUser(null);\r\n                }\r\n            } else {\r\n                setAdminUser(null);\r\n            }\r\n\r\n            if (mounted) {\r\n                setAdminLoading(false);\r\n            }\r\n        });\r\n\r\n        return () => {\r\n            mounted = false;\r\n            clearTimeout(loadingTimer);\r\n            subscription.unsubscribe();\r\n        };\r\n    }, []);\r\n\r\n    const signOutAdmin = async () => {\r\n        await supabase.auth.signOut();\r\n        // Use window.location for hard redirect to clear all state\r\n        window.location.href = '/admin/login';\r\n    };\r\n\r\n    const value = {\r\n        adminUser,\r\n        adminLoading,\r\n        signOutAdmin,\r\n        setAdminUser,\r\n    };\r\n\r\n    return <AdminAuthContext.Provider value={value}>{children}</AdminAuthContext.Provider>;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\AdminNotificationContext.tsx","messages":[],"suppressedMessages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchNotifications'. Either include it or remove the dependency array.","line":88,"column":8,"nodeType":"ArrayExpression","endLine":88,"endColumn":10,"suggestions":[{"desc":"Update the dependencies array to be: [fetchNotifications]","fix":{"range":[11994,11996],"text":"[fetchNotifications]"}}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\AuthContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\CartContext.tsx","messages":[{"ruleId":"prefer-const","severity":1,"message":"'cartError' is never reassigned. Use 'const' instead.","line":59,"column":46,"nodeType":"Identifier","messageId":"useConst","endLine":59,"endColumn":55},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'searchError' is assigned a value but never used.","line":214,"column":55,"nodeType":"Identifier","messageId":"unusedVar","endLine":214,"endColumn":66}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { useAuth } from './AuthContext';\r\nimport { supabase } from '@/lib/supabase';\r\n\r\nexport interface CartItem {\r\n    id: number | string;\r\n    name: string;\r\n    price: number;\r\n    images: string[];\r\n    quantity: number;\r\n    category?: string;\r\n    pack?: string;\r\n    color?: string;\r\n    size?: string;\r\n}\r\n\r\ninterface CartContextType {\r\n    items: CartItem[];\r\n    addItem: (item: CartItem) => Promise<void>;\r\n    removeItem: (id: number | string, color?: string) => Promise<void>;\r\n    updateQuantity: (id: number | string, delta: number, color?: string) => Promise<void>;\r\n    clearCart: () => Promise<void>;\r\n    totalPrice: number;\r\n    totalItems: number;\r\n    loading: boolean;\r\n}\r\n\r\nconst defaultContext: CartContextType = {\r\n    items: [],\r\n    addItem: async () => { },\r\n    removeItem: async () => { },\r\n    updateQuantity: async () => { },\r\n    clearCart: async () => { },\r\n    totalPrice: 0,\r\n    totalItems: 0,\r\n    loading: true\r\n};\r\n\r\nconst CartContext = createContext<CartContextType>(defaultContext);\r\n\r\nexport function CartProvider({ children }: { children: ReactNode }) {\r\n    const { user, loading: authLoading } = useAuth();\r\n    const [items, setItems] = useState<CartItem[]>([]);\r\n    const [loading, setLoading] = useState(true);\r\n    const [isInitialized, setIsInitialized] = useState(false);\r\n\r\n    // Initial load\r\n    useEffect(() => {\r\n        if (authLoading) return;\r\n\r\n        const loadCart = async () => {\r\n            setLoading(true);\r\n            if (user) {\r\n                // Load from Supabase\r\n                try {\r\n                    // Get cart_id for user, or create if not exists\r\n                    let { data: cart, error: cartError } = await supabase\r\n                        .from('carts')\r\n                        .select('id')\r\n                        .eq('user_id', user.id)\r\n                        .single();\r\n\r\n                    if (cartError && cartError.code === 'PGRST116') {\r\n                        // Cart doesn't exist, create it\r\n                        const { data: newCart, error: createError } = await supabase\r\n                            .from('carts')\r\n                            .insert([{ user_id: user.id }])\r\n                            .select('id')\r\n                            .single();\r\n\r\n                        if (createError) {\r\n                            // If unique violation (23505), it means it was created concurrently or hidden\r\n                            if (createError.code === '23505') {\r\n                                const { data: existingCart, error: retryError } = await supabase\r\n                                    .from('carts')\r\n                                    .select('id')\r\n                                    .eq('user_id', user.id)\r\n                                    .single();\r\n\r\n                                if (retryError) throw retryError;\r\n                                cart = existingCart;\r\n                            } else {\r\n                                throw createError;\r\n                            }\r\n                        } else {\r\n                            cart = newCart;\r\n                        }\r\n                    } else if (cartError) {\r\n                        throw cartError;\r\n                    }\r\n\r\n                    if (cart) {\r\n                        const { data: cartItems, error: itemsError } = await supabase\r\n                            .from('cart_items')\r\n                            .select('*')\r\n                            .eq('cart_id', cart.id);\r\n\r\n                        if (itemsError) throw itemsError;\r\n\r\n                        if (cartItems) {\r\n                            const mappedItems: CartItem[] = cartItems.map(item => ({\r\n                                id: item.product_id,\r\n                                name: item.name,\r\n                                price: item.price,\r\n                                images: [item.image], // Map legacy stored image string to array\r\n                                quantity: item.quantity,\r\n                                category: item.category,\r\n                                pack: item.pack,\r\n                                color: item.color\r\n                            }));\r\n                            setItems(mappedItems);\r\n                        }\r\n                    }\r\n\r\n                } catch (error) {\r\n                    console.error(\"Error loading cart from Supabase:\", error);\r\n                }\r\n\r\n            } else {\r\n                // Load from LocalStorage\r\n                const storedCart = localStorage.getItem('cart');\r\n                if (storedCart) {\r\n                    try {\r\n                        setItems(JSON.parse(storedCart));\r\n                    } catch (error) {\r\n                        console.error('Failed to parse cart from local storage:', error);\r\n                        setItems([]);\r\n                    }\r\n                } else {\r\n                    // Explicitly clear items if no local cart found (e.g. after logout)\r\n                    setItems([]);\r\n                }\r\n            }\r\n            setLoading(false);\r\n            setIsInitialized(true);\r\n        };\r\n\r\n        loadCart();\r\n    }, [user, authLoading]);\r\n\r\n    // Save to LocalStorage (Always sync as backup/cache)\r\n    useEffect(() => {\r\n        if (!authLoading && isInitialized) {\r\n            localStorage.setItem('cart', JSON.stringify(items));\r\n        }\r\n    }, [items, authLoading, isInitialized]);\r\n\r\n\r\n    // Helper to sanitize optional fields for DB equality checks\r\n    const sanitizeAttr = (val: string | undefined): string | null => {\r\n        return val ? val : null;\r\n    };\r\n\r\n    const addItem = async (newItem: CartItem) => {\r\n        // Normalize new item attributes\r\n        const color = sanitizeAttr(newItem.color);\r\n        const size = sanitizeAttr(newItem.size);\r\n        const pack = sanitizeAttr(newItem.pack);\r\n\r\n        if (user) {\r\n            // Optimistic UI update\r\n            setItems(currentItems => {\r\n                const existingItem = currentItems.find(item =>\r\n                    String(item.id) === String(newItem.id) &&\r\n                    sanitizeAttr(item.color) === color &&\r\n                    sanitizeAttr(item.size) === size &&\r\n                    sanitizeAttr(item.pack) === pack\r\n                );\r\n\r\n                if (existingItem) {\r\n                    return currentItems.map(item =>\r\n                        (String(item.id) === String(newItem.id) &&\r\n                            sanitizeAttr(item.color) === color &&\r\n                            sanitizeAttr(item.size) === size &&\r\n                            sanitizeAttr(item.pack) === pack)\r\n                            ? { ...item, quantity: item.quantity + newItem.quantity }\r\n                            : item\r\n                    );\r\n                }\r\n                return [...currentItems, newItem];\r\n            });\r\n\r\n            try {\r\n                // Fetch cart ID or create if missing\r\n                let { data: cart } = await supabase.from('carts').select('id').eq('user_id', user.id).single();\r\n\r\n                if (!cart) {\r\n                    const { data: newCart, error: createError } = await supabase\r\n                        .from('carts')\r\n                        .insert([{ user_id: user.id }])\r\n                        .select('id')\r\n                        .single();\r\n                    if (createError) throw createError;\r\n                    cart = newCart;\r\n                }\r\n\r\n                if (!cart) return;\r\n\r\n                // Check dependencies using specific filters matching the sanitization\r\n                let query = supabase\r\n                    .from('cart_items')\r\n                    .select('*')\r\n                    .eq('cart_id', cart.id)\r\n                    .eq('product_id', newItem.id);\r\n\r\n                // Add explicit filters for optional attributes\r\n                if (color) query = query.eq('color', color);\r\n                else query = query.is('color', null);\r\n\r\n                // Note: unique constraint is (cart_id, product_id, color). \r\n                // We trust the constraint but need to find the specific row to update.\r\n                const { data: existingDbItems, error: searchError } = await query;\r\n\r\n                // Manual filtering if needed (to be extra safe against DB weirdness) or just take first\r\n                const existingDbItem = existingDbItems && existingDbItems.length > 0 ? existingDbItems[0] : null;\r\n\r\n                if (existingDbItem) {\r\n                    const { error: updateError } = await supabase\r\n                        .from('cart_items')\r\n                        .update({ quantity: existingDbItem.quantity + newItem.quantity })\r\n                        .eq('id', existingDbItem.id);\r\n\r\n                    if (updateError) console.error(\"CartContext: Update item error:\", updateError);\r\n                } else {\r\n                    const { error: insertError } = await supabase.from('cart_items').insert([{\r\n                        cart_id: cart.id,\r\n                        product_id: String(newItem.id), // Ensure string\r\n                        name: newItem.name,\r\n                        price: newItem.price,\r\n                        image: newItem.images[0] || '',\r\n                        quantity: newItem.quantity,\r\n                        category: newItem.category,\r\n                        pack: pack,\r\n                        color: color,\r\n                        size: size\r\n                    }]);\r\n\r\n                    if (insertError) console.error(\"CartContext: Insert item error:\", insertError);\r\n                }\r\n\r\n            } catch (error) {\r\n                console.error(\"Error adding item to Supabase cart:\", error);\r\n            }\r\n\r\n        } else {\r\n            // Guest Logic\r\n            setItems(currentItems => {\r\n                const existingItem = currentItems.find(item =>\r\n                    String(item.id) === String(newItem.id) &&\r\n                    item.color === newItem.color // Simple check for guest\r\n                );\r\n                if (existingItem) {\r\n                    return currentItems.map(item =>\r\n                        (String(item.id) === String(newItem.id) && item.color === newItem.color)\r\n                            ? { ...item, quantity: item.quantity + newItem.quantity }\r\n                            : item\r\n                    );\r\n                }\r\n                return [...currentItems, newItem];\r\n            });\r\n        }\r\n    };\r\n\r\n    const removeItem = async (id: number | string, color?: string) => {\r\n        const normColor = sanitizeAttr(color);\r\n\r\n        setItems(currentItems => currentItems.filter(item => {\r\n            const isSameId = String(item.id) === String(id);\r\n            const isSameColor = sanitizeAttr(item.color) === normColor;\r\n            return !(isSameId && isSameColor);\r\n        }));\r\n\r\n        if (user) {\r\n            try {\r\n                const { data: cart } = await supabase.from('carts').select('id').eq('user_id', user.id).single();\r\n                if (cart) {\r\n                    let query = supabase\r\n                        .from('cart_items')\r\n                        .delete()\r\n                        .eq('cart_id', cart.id)\r\n                        .eq('product_id', id);\r\n\r\n                    if (normColor) query = query.eq('color', normColor);\r\n                    else query = query.is('color', null);\r\n\r\n                    await query;\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error removing item from Supabase cart:\", error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const updateQuantity = async (id: number | string, delta: number, color?: string) => {\r\n        const normColor = sanitizeAttr(color);\r\n        let newQuantity = 0;\r\n\r\n        setItems(currentItems =>\r\n            currentItems.map(item => {\r\n                if (String(item.id) === String(id) && sanitizeAttr(item.color) === normColor) {\r\n                    newQuantity = Math.max(1, item.quantity + delta);\r\n                    return { ...item, quantity: newQuantity };\r\n                }\r\n                return item;\r\n            })\r\n        );\r\n\r\n        if (user) {\r\n            try {\r\n                const { data: cart } = await supabase.from('carts').select('id').eq('user_id', user.id).single();\r\n                if (cart) {\r\n                    let query = supabase\r\n                        .from('cart_items')\r\n                        .update({ quantity: newQuantity })\r\n                        .eq('cart_id', cart.id)\r\n                        .eq('product_id', id);\r\n\r\n                    if (normColor) query = query.eq('color', normColor);\r\n                    else query = query.is('color', null);\r\n\r\n                    await query;\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error updating item quantity in Supabase cart:\", error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const clearCart = async () => {\r\n        setItems([]);\r\n        if (user) {\r\n            try {\r\n                const { data: cart } = await supabase.from('carts').select('id').eq('user_id', user.id).single();\r\n                if (cart) {\r\n                    await supabase.from('cart_items').delete().eq('cart_id', cart.id);\r\n                }\r\n            } catch (error) {\r\n                console.error(\"Error clearing Supabase cart:\", error);\r\n            }\r\n        }\r\n    };\r\n\r\n    const totalPrice = items.reduce((total, item) => total + (item.price * item.quantity), 0);\r\n    const totalItems = items.reduce((total, item) => total + item.quantity, 0);\r\n\r\n    return (\r\n        <CartContext.Provider value={{ items, addItem, removeItem, updateQuantity, clearCart, totalPrice, totalItems, loading }}>\r\n            {children}\r\n        </CartContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useCart() {\r\n    return useContext(CartContext);\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\FlyToCartContext.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\ThemeProvider.tsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\context\\WishlistContext.tsx","messages":[{"ruleId":"react-hooks/exhaustive-deps","severity":1,"message":"React Hook useEffect has a missing dependency: 'fetchWishlistIds'. Either include it or remove the dependency array.","line":28,"column":8,"nodeType":"ArrayExpression","endLine":28,"endColumn":14,"suggestions":[{"desc":"Update the dependencies array to be: [fetchWishlistIds, user]","fix":{"range":[918,924],"text":"[fetchWishlistIds, user]"}}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use client';\r\n\r\nimport React, { createContext, useContext, useState, useEffect, ReactNode } from 'react';\r\nimport { supabase } from '@/lib/supabase';\r\nimport { useAuth } from './AuthContext';\r\n\r\ninterface WishlistContextType {\r\n    wishlistIds: number[];\r\n    addToWishlist: (productId: number) => Promise<void>;\r\n    removeFromWishlist: (productId: number) => Promise<void>;\r\n    isInWishlist: (productId: number) => boolean;\r\n    loading: boolean;\r\n}\r\n\r\nconst WishlistContext = createContext<WishlistContextType | undefined>(undefined);\r\n\r\nexport function WishlistProvider({ children }: { children: ReactNode }) {\r\n    const { user } = useAuth();\r\n    const [wishlistIds, setWishlistIds] = useState<number[]>([]);\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    useEffect(() => {\r\n        if (user) {\r\n            fetchWishlistIds();\r\n        } else {\r\n            setWishlistIds([]);\r\n        }\r\n    }, [user]);\r\n\r\n    const fetchWishlistIds = async () => {\r\n        try {\r\n            setLoading(true);\r\n            const { data, error } = await supabase\r\n                .from('wishlists')\r\n                .select('product_id')\r\n                .eq('user_id', user?.id);\r\n\r\n            if (error) throw error;\r\n            setWishlistIds(data.map((item: any) => item.product_id));\r\n        } catch (error) {\r\n            console.error('Error fetching wishlist:', error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    const addToWishlist = async (productId: number) => {\r\n        if (!user) return;\r\n        try {\r\n            // Optimistic update\r\n            setWishlistIds(prev => [...prev, productId]);\r\n\r\n            const { error } = await supabase\r\n                .from('wishlists')\r\n                .insert({ user_id: user.id, product_id: productId });\r\n\r\n            if (error) {\r\n                // Revert on error\r\n                setWishlistIds(prev => prev.filter(id => id !== productId));\r\n                throw error;\r\n            }\r\n        } catch (error) {\r\n            console.error('Error adding to wishlist:', error);\r\n            alert('Failed to add to wishlist');\r\n        }\r\n    };\r\n\r\n    const removeFromWishlist = async (productId: number) => {\r\n        if (!user) return;\r\n        try {\r\n            // Optimistic update\r\n            setWishlistIds(prev => prev.filter(id => id !== productId));\r\n\r\n            const { error } = await supabase\r\n                .from('wishlists')\r\n                .delete()\r\n                .eq('user_id', user.id)\r\n                .eq('product_id', productId);\r\n\r\n            if (error) {\r\n                // Revert\r\n                setWishlistIds(prev => [...prev, productId]);\r\n                throw error;\r\n            }\r\n        } catch (error) {\r\n            console.error('Error removing from wishlist:', error);\r\n        }\r\n    };\r\n\r\n    const isInWishlist = (productId: number) => wishlistIds.includes(productId);\r\n\r\n    return (\r\n        <WishlistContext.Provider value={{ wishlistIds, addToWishlist, removeFromWishlist, isInWishlist, loading }}>\r\n            {children}\r\n        </WishlistContext.Provider>\r\n    );\r\n}\r\n\r\nexport function useWishlist() {\r\n    const context = useContext(WishlistContext);\r\n    if (context === undefined) {\r\n        throw new Error('useWishlist must be used within a WishlistProvider');\r\n    }\r\n    return context;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\debug-low-stock.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\eslint.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\adminApi.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'reviewError' is assigned a value but never used.","line":313,"column":41,"nodeType":"Identifier","messageId":"unusedVar","endLine":313,"endColumn":52}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"'use server'\r\n\r\nimport { supabaseAdmin } from './supabaseAdmin';\r\n\r\nexport async function getAdminOrders(searchQuery?: string, merchantId?: string) {\r\n    let orderIds: string[] | null = null;\r\n\r\n    // 1. If Merchant, define scope first\r\n    if (merchantId) {\r\n        // Get Merchant Products\r\n        const { data: products } = await supabaseAdmin\r\n            .from('products')\r\n            .select('id')\r\n            .eq('merchant_id', merchantId);\r\n\r\n        const productIds = products ? products.map(p => p.id) : [];\r\n\r\n        if (productIds.length === 0) return [];\r\n\r\n        // Get Orders containing these products\r\n        const { data: items } = await supabaseAdmin\r\n            .from('order_items')\r\n            .select('order_id')\r\n            .in('product_id', productIds);\r\n\r\n        orderIds = items ? Array.from(new Set(items.map(i => i.order_id))) : [];\r\n        if (orderIds.length === 0) return [];\r\n    }\r\n\r\n    let query = supabaseAdmin\r\n        .from('orders')\r\n        .select(`\r\n            *,\r\n            order_items!order_items_order_id_fkey (\r\n                id, name, quantity, size, color, product_id, price, image\r\n            )\r\n        `)\r\n        .order('created_at', { ascending: false });\r\n\r\n    if (orderIds) {\r\n        query = query.in('id', orderIds);\r\n    }\r\n\r\n    if (searchQuery) {\r\n        query = query.or(`id.ilike.%${searchQuery}%,shipping_name.ilike.%${searchQuery}%`);\r\n    }\r\n\r\n    const { data: ordersData, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching admin orders:', error);\r\n        return [];\r\n    }\r\n\r\n    // 2. Additional Filter: For merchants, we must HIDE items that aren't theirs.\r\n    // We need to fetch the merchant's product list again (or cache it) to verify items.\r\n    // Or we can assume if we passed merchantId, we interpret 'order_items' differently.\r\n\r\n    // Optimisation: We already have productIds if merchantId is set, but it was local scope.\r\n    // Let's refetch or just filter properly? \r\n    // Actually, 'order_items' in the response contains ALL items for that order.\r\n    // We should filter this list before returning to frontend.\r\n\r\n    let processedOrders = ordersData || [];\r\n\r\n    if (merchantId) {\r\n        // We need to know which products are ours to filter the items list.\r\n        const { data: products } = await supabaseAdmin\r\n            .from('products')\r\n            .select('id')\r\n            .eq('merchant_id', merchantId);\r\n        const myProductIds = new Set(products?.map(p => p.id) || []);\r\n\r\n        processedOrders = processedOrders.map(order => ({\r\n            ...order,\r\n            order_items: order.order_items.filter((item: any) => myProductIds.has(item.product_id)),\r\n            // Optional: Recalculate total_amount for display? \r\n            // Only if we want to show \"Merchant Total\" instead of \"Order Total\"\r\n            // For now, let's keep Order Total but maybe add a 'merchant_total' field?\r\n            merchant_total: order.order_items\r\n                .filter((item: any) => myProductIds.has(item.product_id))\r\n                .reduce((sum: number, item: any) => sum + (item.price * item.quantity), 0)\r\n        }));\r\n    }\r\n\r\n    // Fetch profiles for these users to show dynamic names\r\n    const userIds = Array.from(new Set(processedOrders.map(o => o.user_id)));\r\n    const { data: profiles } = await supabaseAdmin\r\n        .from('User')\r\n        .select('id, name, phone, image')\r\n        .in('id', userIds);\r\n\r\n    return processedOrders.map(order => {\r\n        const profile = profiles?.find(p => p.id === order.user_id);\r\n        const customerName = profile?.name || order.shipping_name || 'Guest';\r\n        const customerPhone = profile?.phone || order.shipping_phone || '';\r\n\r\n        // If merchant, use merchant_total, else total_amount\r\n        const displayTotal = (order as any).merchant_total !== undefined ? (order as any).merchant_total : order.total_amount;\r\n\r\n        return {\r\n            ...order,\r\n            total_amount: displayTotal, // Override for display\r\n            item_count: order.order_items ? order.order_items.length : 0,\r\n            items_summary: order.order_items ? order.order_items.map((i: any) => `${i.quantity}x ${i.name}`).join(', ') : '',\r\n            customer: {\r\n                name: customerName,\r\n                phone: customerPhone,\r\n                avatar: profile?.image,\r\n                id: order.user_id\r\n            }\r\n        };\r\n    });\r\n}\r\n\r\nexport async function updateAdminOrderStatus(id: string, status: string) {\r\n    const { error } = await supabaseAdmin\r\n        .from('orders')\r\n        .update({ status })\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function getAdminOrder(id: string) {\r\n    const { data: order, error } = await supabaseAdmin\r\n        .from('orders')\r\n        .select(`\r\n            *,\r\n            items:order_items!order_items_order_id_fkey(*)\r\n        `)\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error fetching admin order:', error);\r\n        return null;\r\n    }\r\n\r\n    // Fetch profile for dynamic customer info\r\n    const { data: profile } = await supabaseAdmin\r\n        .from('User')\r\n        .select('name, phone, image')\r\n        .eq('id', order.user_id)\r\n        .single();\r\n\r\n    const customerName = profile?.name || order.shipping_name || 'Guest';\r\n    const customerPhone = profile?.phone || order.shipping_phone || '';\r\n\r\n    return {\r\n        ...order,\r\n        customer: {\r\n            name: customerName,\r\n            phone: customerPhone,\r\n            avatar: profile?.image,\r\n            id: order.user_id\r\n        }\r\n    };\r\n}\r\n\r\nexport async function getLowStockProducts() {\r\n    const { data, error } = await supabaseAdmin\r\n        .from('products')\r\n        .select('id, name, stock_quantity')\r\n        .lte('stock_quantity', 5)\r\n        .eq('is_deleted', false);\r\n\r\n    if (error) {\r\n        console.error('Error fetching low stock products:', error);\r\n        return [];\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function getBestSellingProducts(limit: number = 8) {\r\n    const { data, error } = await supabaseAdmin\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false)\r\n        .order('sold_count', { ascending: false })\r\n        .limit(limit);\r\n\r\n    if (error) {\r\n        console.error('Error fetching best selling products:', error);\r\n        return [];\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function getSalesAnalytics() {\r\n    const thirtyDaysAgo = new Date();\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n\r\n    const { data: orders, error } = await supabaseAdmin\r\n        .from('orders')\r\n        .select('created_at, total_amount, status')\r\n        .gte('created_at', thirtyDaysAgo.toISOString())\r\n        .order('created_at', { ascending: true });\r\n\r\n    if (error) {\r\n        console.error('Error fetching sales analytics:', error);\r\n        return [];\r\n    }\r\n\r\n    const salesMap = new Map<string, number>();\r\n    for (let i = 0; i < 30; i++) {\r\n        const d = new Date();\r\n        d.setDate(d.getDate() - i);\r\n        salesMap.set(d.toLocaleDateString('en-US'), 0);\r\n    }\r\n\r\n    orders.forEach(order => {\r\n        if (order.status?.toUpperCase() === 'DELIVERED') {\r\n            const date = new Date(order.created_at).toLocaleDateString('en-US');\r\n            const current = salesMap.get(date) || 0;\r\n            salesMap.set(date, current + Number(order.total_amount));\r\n        }\r\n    });\r\n\r\n    return Array.from(salesMap.entries())\r\n        .map(([date, sales]) => ({ name: date.split('/')[0] + '/' + date.split('/')[1], sales, fullDate: date }))\r\n        .sort((a, b) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime());\r\n}\r\n\r\nexport async function getCategoryStats() {\r\n    try {\r\n        const { data: viewData, error: viewError } = await supabaseAdmin\r\n            .from('category_stats')\r\n            .select('*')\r\n            .order('total_items_sold', { ascending: false });\r\n\r\n        if (!viewError && viewData) {\r\n            const total = viewData.reduce((sum, item) => sum + item.total_items_sold, 0);\r\n            return viewData.map((item: any) => ({\r\n                name: item.category,\r\n                count: item.total_items_sold,\r\n                percentage: total > 0 ? Math.round((item.total_items_sold / total) * 100) : 0\r\n            }));\r\n        }\r\n\r\n        const { data, error } = await supabaseAdmin\r\n            .from('order_items')\r\n            .select('category, quantity');\r\n\r\n        if (error) throw error;\r\n\r\n        const stats = new Map<string, number>();\r\n        let totalItems = 0;\r\n\r\n        data.forEach((item: any) => {\r\n            if (item.category) {\r\n                const current = stats.get(item.category) || 0;\r\n                stats.set(item.category, current + item.quantity);\r\n                totalItems += item.quantity;\r\n            }\r\n        });\r\n\r\n        return Array.from(stats.entries())\r\n            .map(([name, count]) => ({\r\n                name,\r\n                count,\r\n                percentage: totalItems > 0 ? Math.round((count / totalItems) * 100) : 0\r\n            }))\r\n            .sort((a, b) => b.count - a.count);\r\n\r\n    } catch (error) {\r\n        console.error('Error fetching category stats:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getMerchantStats(merchantId: string) {\r\n    // 1. Get Merchant Products\r\n    const { data: products, error: prodError } = await supabaseAdmin\r\n        .from('products')\r\n        .select('*')\r\n        .eq('merchant_id', merchantId)\r\n        .eq('is_deleted', false);\r\n\r\n    if (prodError) {\r\n        console.error('Error fetching merchant products:', prodError);\r\n        return { totalEarnings: 0, totalOrders: 0, totalProducts: 0, products: [], recentOrders: [] };\r\n    }\r\n\r\n    const productIds = products.map(p => p.id);\r\n\r\n    // 2. Get Order Items for these products\r\n    // Note: We need to filter order_items manually or via IN query\r\n    const { data: orderItems, error: itemsError } = await supabaseAdmin\r\n        .from('order_items')\r\n        .select(`\r\n            *,\r\n            orders!order_items_order_id_fkey (id, created_at, status, shipping_name)\r\n        `)\r\n        .in('product_id', productIds)\r\n        .order('created_at', { ascending: false });\r\n\r\n    if (itemsError) {\r\n        console.error('Error fetching merchant order items:', itemsError);\r\n        return { totalEarnings: 0, totalOrders: 0, totalProducts: products.length, products, recentOrders: [] };\r\n    }\r\n\r\n    // 3. Calculate Stats\r\n    const validItems = orderItems.filter((i: any) => i.orders?.status?.toLowerCase() !== 'cancelled');\r\n    const totalEarnings = validItems.reduce((sum: number, item: any) => sum + (item.price * item.quantity), 0);\r\n    const totalOrders = new Set(validItems.map((i: any) => i.order_id)).size;\r\n\r\n    // 4. Get Total Reviews for Merchant's Products\r\n    const { count: totalReviews, error: reviewError } = await supabaseAdmin\r\n        .from('reviews')\r\n        .select('id', { count: 'exact', head: true })\r\n        .in('product_id', productIds);\r\n\r\n    // 5. Recent Orders\r\n    const recentOrderIds = Array.from(new Set(orderItems.map((i: any) => i.order_id))).slice(0, 5);\r\n    const recentOrders = recentOrderIds.map(orderId => {\r\n        const item = orderItems.find((i: any) => i.order_id === orderId);\r\n        return {\r\n            id: orderId,\r\n            product_name: item.name + (orderItems.filter((i: any) => i.order_id === orderId).length > 1 ? ` (+${orderItems.filter((i: any) => i.order_id === orderId).length - 1} others)` : ''),\r\n            date: item.orders?.created_at,\r\n            price: item.price * item.quantity,\r\n            status: item.orders?.status\r\n        };\r\n    });\r\n\r\n    return {\r\n        totalEarnings,\r\n        totalOrders,\r\n        totalProducts: products.length,\r\n        totalReviews: totalReviews || 0,\r\n        products,\r\n        recentOrders\r\n    };\r\n}\r\n\r\nexport async function getTotalMerchantsCount() {\r\n    const { count, error } = await supabaseAdmin\r\n        .from('admins')\r\n        .select('id', { count: 'exact', head: true })\r\n        .eq('role', 'merchant');\r\n\r\n    if (error) {\r\n        console.error('Error fetching merchant count:', JSON.stringify(error, null, 2));\r\n        return 0;\r\n    }\r\n    return count || 0;\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\api.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":1522,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1522,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":1541,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1541,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":1562,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1562,"endColumn":17},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'data' is assigned a value but never used.","line":1583,"column":13,"nodeType":"Identifier","messageId":"unusedVar","endLine":1583,"endColumn":17},{"ruleId":"prefer-const","severity":1,"message":"'usersMap' is never reassigned. Use 'const' instead.","line":1647,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":1647,"endColumn":38,"fix":{"range":[52570,52609],"text":"const usersMap: Record<string, any> = {};"}},{"ruleId":"prefer-const","severity":1,"message":"'productsMap' is never reassigned. Use 'const' instead.","line":1657,"column":9,"nodeType":"Identifier","messageId":"useConst","endLine":1657,"endColumn":41,"fix":{"range":[52975,53017],"text":"const productsMap: Record<string, any> = {};"}}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":6,"fixableErrorCount":0,"fixableWarningCount":2,"source":"\r\n'use server'\r\n\r\nimport { supabaseAdmin as supabase } from './supabaseAdmin';\r\n\r\nexport interface Category {\r\n    id: string;\r\n    name: string;\r\n    slug: string;\r\n    img: string; // Icon/Slider Image\r\n    banner?: string; // Hero Banner Image\r\n    subcategories: { id?: string; name: string; count?: number }[];\r\n}\r\n\r\nexport interface Product {\r\n    id: number;\r\n    name: string;\r\n    category: string;\r\n    subcategory?: string; // Mapped from subcategories.name\r\n    price: number;\r\n    originalPrice?: number;\r\n    discountPercent?: number;\r\n    specialCategoryLabel?: string; // e.g. \"Flash Deal\"\r\n    images: string[];\r\n    description?: string;\r\n    quantity?: string; // Display quantity e.g. \"1kg\"\r\n    stockQuantity: number;\r\n    colors: string[];\r\n    sizes?: string[];\r\n    createdAt: string; // ISO date string\r\n    average_rating?: number;\r\n    reviews_count?: number;\r\n    shipping_inside_dhaka?: number;\r\n    shipping_outside_dhaka?: number;\r\n    vendor_name?: string;\r\n    sold_count?: number;\r\n    merchant_id?: string;\r\n    is_approved?: boolean;\r\n    shop_name?: string;\r\n    // SEO Fields\r\n    metaTitle?: string;\r\n    metaDescription?: string;\r\n    canonicalUrl?: string;\r\n    keywords?: string[];\r\n    ogImage?: string;\r\n    noIndex?: boolean;\r\n}\r\n\r\n// Helper to map DB result to app interface\r\nfunction mapCategory(row: any): Category {\r\n    try {\r\n        return {\r\n            id: row.id,\r\n            name: row.name || 'Untitled Category',\r\n            slug: row.slug || `category-${row.id}`,\r\n            img: row.image_url || '/placeholder.png',\r\n            banner: row.banner_url || row.image_url || '/placeholder.png', // Fallback to icon if banner missing\r\n            // Filter out hidden categories if necessary, but this mapper is usually for valid categories\r\n            subcategories: row.subcategories\r\n                ? row.subcategories.map((s: any) => ({\r\n                    name: s.name || 'Unknown',\r\n                    count: s.products ? s.products[0]?.count || 0 : 0\r\n                }))\r\n                : []\r\n        };\r\n    } catch (error) {\r\n        console.error('CRITICAL: Error mapping category row:', row, error);\r\n        return {\r\n            id: row.id || 'error',\r\n            name: 'Error Loading Category',\r\n            slug: 'error',\r\n            img: '',\r\n            subcategories: []\r\n        };\r\n    }\r\n}\r\n\r\nfunction mapProduct(row: any): Product {\r\n    // V2: Pricing is already persistent in the DB.\r\n    // 'price' is the current active price (discounted or regular).\r\n    // 'original_price' is the previous price (if any).\r\n    // 'discount_percent' is stored directly.\r\n\r\n    return {\r\n        id: row.id,\r\n        name: row.name,\r\n        category: row.categories?.name || 'Unknown',\r\n        subcategory: row.subcategories?.name,\r\n        price: row.price,\r\n        originalPrice: row.original_price,\r\n        discountPercent: row.discount_percent > 0 ? row.discount_percent : undefined,\r\n        specialCategoryLabel: row.special_categories?.name,\r\n        // Ensure images is an array and filter out empty strings/nulls\r\n        images: Array.isArray(row.images) ? row.images.filter((img: any) => img && typeof img === 'string' && img.trim() !== '') : [],\r\n        description: row.description,\r\n        quantity: row.quantity_label,\r\n        stockQuantity: row.stock_quantity || 0,\r\n        colors: row.colors || [],\r\n        sizes: row.sizes || [],\r\n        createdAt: row.created_at,\r\n        average_rating: row.average_rating,\r\n        reviews_count: row.reviews_count,\r\n        shipping_inside_dhaka: row.shipping_inside_dhaka,\r\n        shipping_outside_dhaka: row.shipping_outside_dhaka,\r\n        vendor_name: row.vendor_name,\r\n        sold_count: row.sold_count || 0,\r\n        merchant_id: row.merchant_id,\r\n        is_approved: row.is_approved,\r\n        shop_name: row.shop_name,\r\n        // Map SEO fields\r\n        metaTitle: row.meta_title,\r\n        metaDescription: row.meta_description,\r\n        canonicalUrl: row.canonical_url,\r\n        keywords: row.keywords || [],\r\n        ogImage: row.og_image,\r\n        noIndex: row.no_index || false\r\n    };\r\n}\r\n\r\nexport async function getCategories(): Promise<Category[]> {\r\n    const { data, error } = await supabase\r\n        .from('categories')\r\n        .select(`\r\n            id, name, slug, image_url, banner_url,\r\n            subcategories (\r\n                id, name\r\n            )\r\n        `)\r\n        .order('name', { ascending: true });\r\n\r\n    if (error) {\r\n        console.error('Error fetching categories:', error);\r\n        return [];\r\n    }\r\n\r\n    if (!data || data.length === 0) {\r\n        console.warn('No categories found in database');\r\n        return [];\r\n    }\r\n\r\n    return data.map((row: any) => ({\r\n        id: row.id,\r\n        name: row.name,\r\n        slug: row.slug,\r\n        img: row.image_url,\r\n        banner: row.banner_url || row.image_url,\r\n        subcategories: (row.subcategories || []).map((s: any) => ({\r\n            id: s.id,\r\n            name: s.name\r\n        }))\r\n    }));\r\n}\r\n/*\r\nexport async function getCategories(): Promise<Category[]> {\r\n    const { data, error } = await supabase\r\n        .from('categories')\r\n        .select(`\r\n            id, name, slug, image_url, banner_url,\r\n            subcategories (\r\n                name,\r\n                products:products(count)\r\n            )\r\n        `);\r\n\r\n    console.log('Fetching Categories Raw Data:', { dataLength: data?.length, error });\r\n\r\n    if (error) {\r\n        console.error('CRITICAL: Error fetching categories:', JSON.stringify(error, null, 2));\r\n        return [];\r\n    }\r\n\r\n    if (!data || data.length === 0) {\r\n        console.warn('CRITICAL: Categories fetch returned empty array. Attempting fallback query without joins.');\r\n        const { data: fallbackData, error: fallbackError } = await supabase\r\n            .from('categories')\r\n            .select('*');\r\n\r\n        if (fallbackError) {\r\n            console.error('CRITICAL: Fallback categories fetch failed:', JSON.stringify(fallbackError, null, 2));\r\n            return [];\r\n        }\r\n        console.log('Fallback Categories Data:', fallbackData);\r\n        // Map fallback data (won't have subcategories)\r\n        return fallbackData.map((row: any) => ({\r\n            id: row.id,\r\n            name: row.name,\r\n            slug: row.slug,\r\n            img: row.image_url,\r\n            banner: row.banner_url || row.image_url,\r\n            subcategories: []\r\n        }));\r\n    }\r\n\r\n    return data.map(mapCategory);\r\n}\r\n*/\r\n\r\nexport async function getCategory(slug: string): Promise<Category | null> {\r\n    const { data, error } = await supabase\r\n        .from('categories')\r\n        .select(`\r\n            id, name, slug, image_url, banner_url, is_hidden,\r\n            subcategories (\r\n                name,\r\n                products:products(count)\r\n            )\r\n        `)\r\n        .eq('slug', slug)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(`Error fetching category ${slug}:`, error);\r\n        return null;\r\n    }\r\n\r\n    return mapCategory(data);\r\n}\r\n\r\nexport async function getCategoryById(id: string): Promise<Category | null> {\r\n    const { data, error } = await supabase\r\n        .from('categories')\r\n        .select(`\r\n            id, name, slug, image_url, banner_url, is_hidden,\r\n            subcategories ( id, name )\r\n        `)\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(`Error fetching category ${id}:`, error);\r\n        return null;\r\n    }\r\n\r\n    return {\r\n        ...mapCategory(data),\r\n        subcategories: data.subcategories // Keep IDs for editing\r\n    };\r\n}\r\n\r\nexport async function createCategory(category: { name: string; slug: string; image_url: string; banner_url?: string; subcategories?: string[] }) {\r\n    // 1. Insert Category\r\n    const { data: newCat, error } = await supabase\r\n        .from('categories')\r\n        .insert({\r\n            name: category.name,\r\n            slug: category.slug,\r\n            image_url: category.image_url,\r\n            banner_url: category.banner_url\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n    if (error) throw error;\r\n\r\n    // 2. Insert Subcategories\r\n    if (category.subcategories && category.subcategories.length > 0) {\r\n        const subs = category.subcategories.map(name => ({\r\n            category_id: newCat.id,\r\n            name\r\n        }));\r\n        const { error: subError } = await supabase.from('subcategories').insert(subs);\r\n        if (subError) throw subError;\r\n    }\r\n}\r\n\r\nexport async function updateCategory(id: string, category: { name: string; slug: string; image_url: string; banner_url?: string; subcategories?: { id?: string; name: string }[] }) {\r\n    // 1. Update Category\r\n    const { error } = await supabase\r\n        .from('categories')\r\n        .update({\r\n            name: category.name,\r\n            slug: category.slug,\r\n            image_url: category.image_url,\r\n            banner_url: category.banner_url\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n\r\n    // 2. Manage Subcategories (Simple Replace or Diff?)\r\n    // Simple approach: Delete all and re-insert is risky for product FKs.\r\n    // Better: Upsert explicit IDs, insert new ones, delete missing?\r\n    // For this demo, we'll just insert new ones and update existing names. Deletion is tricky if products depend on them.\r\n    // Let's just Insert new ones for now and Update existing.\r\n    if (category.subcategories) {\r\n        for (const sub of category.subcategories) {\r\n            if (sub.id) {\r\n                await supabase.from('subcategories').update({ name: sub.name }).eq('id', sub.id);\r\n            } else {\r\n                await supabase.from('subcategories').insert({ category_id: id, name: sub.name });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nexport async function deleteCategory(id: string) {\r\n    // Check for products in this category first\r\n    const { count, error: countError } = await supabase\r\n        .from('products')\r\n        .select('*', { count: 'exact', head: true })\r\n        .eq('category_id', id);\r\n\r\n    if (countError) {\r\n        console.error('Error checking products:', countError);\r\n        throw new Error('Failed to verify category products.');\r\n    }\r\n\r\n    if (count !== null && count > 0) {\r\n        throw new Error(`Cannot delete category. It contains ${count} products. Please remove/move them first.`);\r\n    }\r\n\r\n    const { error } = await supabase.from('categories').delete().eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function getCategoryProducts(categoryId: string) {\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select('id, name, stock_quantity, image_url')\r\n        .eq('category_id', categoryId)\r\n        .eq('is_deleted', false);\r\n\r\n    if (error) {\r\n        console.error('Error fetching category products:', error);\r\n        return [];\r\n    }\r\n    return data.map(p => ({ ...p, image: p.image_url }));\r\n}\r\n\r\n\r\n\r\nexport async function deleteSubcategory(id: string) {\r\n    const { error } = await supabase.from('subcategories').delete().eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function getMerchants() {\r\n    const { data, error } = await supabase\r\n        .from('User')\r\n        .select('id, name, email, role, status, shopName, phone, createdAt') // camelCase\r\n        .in('role', ['MERCHANT', 'ADMIN', 'SUPERADMIN']) // temporary debug query to see ALL admins/merchants\r\n        .order('createdAt', { ascending: false }); // camelCase\r\n\r\n    if (error) {\r\n        console.error('CRITICAL: Error fetching merchants:', JSON.stringify(error, null, 2));\r\n        return [];\r\n    }\r\n\r\n    if (!data || data.length === 0) {\r\n        console.warn('CRITICAL: Merchants fetch returned empty array. Checking query params:', { role: ['MERCHANT', 'ADMIN', 'SUPERADMIN'] });\r\n    }\r\n\r\n    return data.map((user: any) => ({\r\n        id: user.id,\r\n        email: user.email,\r\n        full_name: user.name,\r\n        shop_name: user.shopName, // camelCase in DB\r\n        status: user.status || 'approved',\r\n        role: user.role,\r\n        created_at: user.createdAt, // camelCase in DB\r\n        phone: user.phone\r\n    }));\r\n}\r\n\r\nexport async function updateMerchantStatus(id: string, status: string) {\r\n    const { error } = await supabase\r\n        .from('User')\r\n        .update({ status, updatedAt: new Date().toISOString() })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        console.error('Error updating merchant status:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function getCustomers(phoneQuery?: string) {\r\n    let query = supabase\r\n        .from('User')\r\n        .select('*')\r\n        .eq('role', 'CUSTOMER')\r\n        .order('createdAt', { ascending: false });\r\n\r\n    if (phoneQuery) {\r\n        query = query.ilike('phone', `%${phoneQuery}%`);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching customers:', error);\r\n        return [];\r\n    }\r\n\r\n    // Map User table fields to profile-like structure if needed by UI\r\n    return data.map((user: any) => ({\r\n        id: user.id,\r\n        full_name: user.name,\r\n        avatar_url: user.image,\r\n        phone: user.phone,\r\n        email: user.email,\r\n        created_at: user.created_at\r\n    }));\r\n}\r\n\r\nexport async function getCustomerById(id: string) {\r\n    const { data, error } = await supabase\r\n        .from('profiles')\r\n        .select('*')\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(`Error fetching customer ${id}:`, error);\r\n        return null;\r\n    }\r\n    return data;\r\n}\r\n\r\n\r\n\r\nexport async function getSalesAnalytics() {\r\n    const thirtyDaysAgo = new Date();\r\n    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);\r\n\r\n    const { data: orders, error } = await supabase\r\n        .from('orders')\r\n        .select('created_at, total_amount')\r\n        .eq('status', 'delivered')\r\n        .gte('created_at', thirtyDaysAgo.toISOString())\r\n        .order('created_at', { ascending: true });\r\n\r\n    if (error) {\r\n        console.error('Error fetching sales analytics:', error);\r\n        return [];\r\n    }\r\n\r\n    // Group by Date\r\n    const salesMap = new Map<string, number>();\r\n\r\n    // Initialize last 30 days with 0\r\n    for (let i = 0; i < 30; i++) {\r\n        const d = new Date();\r\n        d.setDate(d.getDate() - i);\r\n        salesMap.set(d.toLocaleDateString('en-US'), 0);\r\n    }\r\n\r\n    orders.forEach(order => {\r\n        const date = new Date(order.created_at).toLocaleDateString('en-US');\r\n        const current = salesMap.get(date) || 0;\r\n        salesMap.set(date, current + order.total_amount);\r\n    });\r\n\r\n    return Array.from(salesMap.entries())\r\n        .map(([date, sales]) => ({ name: date.split('/')[0] + '/' + date.split('/')[1], sales, fullDate: date }))\r\n        .sort((a, b) => new Date(a.fullDate).getTime() - new Date(b.fullDate).getTime());\r\n}\r\n\r\nexport async function getCategoryStats() {\r\n    try {\r\n        // Try to fetch from view first (if user ran the SQL)\r\n        const { data: viewData, error: viewError } = await supabase\r\n            .from('category_stats')\r\n            .select('*')\r\n            .order('total_items_sold', { ascending: false });\r\n\r\n        if (!viewError && viewData) {\r\n            const total = viewData.reduce((sum, item) => sum + item.total_items_sold, 0);\r\n            return viewData.map((item: any) => ({\r\n                name: item.category,\r\n                count: item.total_items_sold,\r\n                percentage: total > 0 ? Math.round((item.total_items_sold / total) * 100) : 0\r\n            }));\r\n        }\r\n\r\n        // Fallback: Client-side aggregation\r\n        const { data, error } = await supabase\r\n            .from('order_items')\r\n            .select('category, quantity');\r\n\r\n        if (error) throw error;\r\n\r\n        const stats = new Map<string, number>();\r\n        let totalItems = 0;\r\n\r\n        data.forEach((item: any) => {\r\n            if (item.category) {\r\n                const current = stats.get(item.category) || 0;\r\n                stats.set(item.category, current + item.quantity);\r\n                totalItems += item.quantity;\r\n            }\r\n        });\r\n\r\n        return Array.from(stats.entries())\r\n            .map(([name, count]) => ({\r\n                name,\r\n                count,\r\n                percentage: totalItems > 0 ? Math.round((count / totalItems) * 100) : 0\r\n            }))\r\n            .sort((a, b) => b.count - a.count);\r\n\r\n    } catch (error) {\r\n        console.error('Error fetching category stats:', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport async function getSpecialCategories(): Promise<{ id: number; name: string; description?: string; image_url?: string }[]> {\r\n    const { data, error } = await supabase\r\n        .from('special_categories')\r\n        .select('id, name, description, image_url')\r\n        .eq('active', true);\r\n\r\n    if (error) {\r\n        console.error('Error fetching special categories:', error);\r\n        return [];\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function searchProducts(query: string): Promise<Product[]> {\r\n    if (!query) return [];\r\n\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false) // Soft delete filter\r\n        .ilike('name', `%${query}%`)\r\n        .limit(5);\r\n\r\n    if (error) {\r\n        console.error('Error searching products:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function createSpecialCategory(name: string, description?: string, imageUrl?: string) {\r\n    const { error } = await supabase\r\n        .from('special_categories')\r\n        .insert({ name, description, image_url: imageUrl });\r\n\r\n    if (error) {\r\n        console.error('Error creating special category:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function deleteSpecialCategory(id: number) {\r\n    const { error } = await supabase\r\n        .from('special_categories')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        console.error('Error deleting special category:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport interface ProductFilterOptions {\r\n    query?: string;\r\n    categoryId?: string;\r\n    sortBy?: 'price_asc' | 'price_desc' | 'stock_asc' | 'stock_desc' | 'newest';\r\n    minPrice?: number;\r\n    maxPrice?: number;\r\n    page?: number;\r\n    limit?: number;\r\n    merchantId?: string;\r\n}\r\n\r\nexport interface PaginatedProducts {\r\n    data: Product[];\r\n    count: number;\r\n    page: number;\r\n    pageSize: number;\r\n    totalPages: number;\r\n}\r\n\r\nexport async function getProducts(options?: ProductFilterOptions | string): Promise<Product[]> {\r\n    const filter = typeof options === 'string' ? { query: options } : (options || {});\r\n\r\n    let query = supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false);\r\n\r\n    if (filter.query) {\r\n        query = query.ilike('name', `%${filter.query}%`);\r\n    }\r\n\r\n    if (filter.categoryId) {\r\n        query = query.eq('category_id', filter.categoryId);\r\n    }\r\n\r\n    if (filter.merchantId) {\r\n        query = query.eq('merchant_id', filter.merchantId);\r\n    }\r\n\r\n    if (filter.minPrice !== undefined) {\r\n        query = query.gte('price', filter.minPrice);\r\n    }\r\n\r\n    if (filter.maxPrice !== undefined) {\r\n        query = query.lte('price', filter.maxPrice);\r\n    }\r\n\r\n    if (filter.sortBy) {\r\n        switch (filter.sortBy) {\r\n            case 'price_asc': query = query.order('price', { ascending: true }); break;\r\n            case 'price_desc': query = query.order('price', { ascending: false }); break;\r\n            case 'stock_asc': query = query.order('stock_quantity', { ascending: true }); break;\r\n            case 'stock_desc': query = query.order('stock_quantity', { ascending: false }); break;\r\n            case 'newest': query = query.order('created_at', { ascending: false }); break;\r\n            default: query = query.order('id', { ascending: true });\r\n        }\r\n    } else {\r\n        query = query.order('id', { ascending: true });\r\n    }\r\n\r\n    // No pagination here to maintain backward compatibility\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching products:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function getProductsPaginated(options: ProductFilterOptions): Promise<PaginatedProducts> {\r\n    const page = options.page || 1;\r\n    const limit = options.limit || 10;\r\n    const from = (page - 1) * limit;\r\n    const to = from + limit - 1;\r\n\r\n    let query = supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `, { count: 'exact' })\r\n        .eq('is_deleted', false);\r\n\r\n    if (options.query) {\r\n        query = query.ilike('name', `%${options.query}%`);\r\n    }\r\n\r\n    if (options.categoryId) {\r\n        query = query.eq('category_id', options.categoryId);\r\n    }\r\n\r\n    if (options.merchantId) {\r\n        query = query.eq('merchant_id', options.merchantId);\r\n    }\r\n\r\n    if (options.minPrice !== undefined) {\r\n        query = query.gte('price', options.minPrice);\r\n    }\r\n\r\n    if (options.maxPrice !== undefined) {\r\n        query = query.lte('price', options.maxPrice);\r\n    }\r\n\r\n    // Apply Sorting\r\n    if (options.sortBy) {\r\n        switch (options.sortBy) {\r\n            case 'price_asc': query = query.order('price', { ascending: true }); break;\r\n            case 'price_desc': query = query.order('price', { ascending: false }); break;\r\n            case 'stock_asc': query = query.order('stock_quantity', { ascending: true }); break;\r\n            case 'stock_desc': query = query.order('stock_quantity', { ascending: false }); break;\r\n            case 'newest': query = query.order('created_at', { ascending: false }); break;\r\n            default: query = query.order('id', { ascending: true });\r\n        }\r\n    } else {\r\n        query = query.order('id', { ascending: true });\r\n    }\r\n\r\n    // Apply Pagination\r\n    query = query.range(from, to);\r\n\r\n    const { data, count, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching paginated products:', error);\r\n        return { data: [], count: 0, page, pageSize: limit, totalPages: 0 };\r\n    }\r\n\r\n    return {\r\n        data: (data || []).map(mapProduct),\r\n        count: count || 0,\r\n        page,\r\n        pageSize: limit,\r\n        totalPages: count ? Math.ceil(count / limit) : 0\r\n    };\r\n}\r\n\r\nexport async function getProduct(id: string): Promise<Product | null> {\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            subcategories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error(`Error fetching product ${id}:`, error);\r\n        return null;\r\n    }\r\n\r\n    return mapProduct(data);\r\n}\r\n\r\n// Sort options type (removed popularity)\r\nexport type SortOption = 'price-asc' | 'price-desc' | 'newest';\r\n\r\n// Debug mode: Simplified query\r\nexport async function getProductsByCategory(slug: string, subcategory?: string, sort?: any): Promise<Product[]> {\r\n    let query = supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories!inner (name, slug),\r\n            subcategories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false) // Soft delete filter\r\n        .eq('categories.slug', slug);\r\n\r\n    if (subcategory) {\r\n        query = supabase\r\n            .from('products')\r\n            .select(`\r\n                *,\r\n                categories!inner (name, slug),\r\n                subcategories!inner (name),\r\n                special_categories (name)\r\n            `)\r\n            .eq('is_deleted', false) // Soft delete filter\r\n            .eq('categories.slug', slug)\r\n            .eq('subcategories.name', subcategory);\r\n    }\r\n\r\n    // Sorting\r\n    if (sort) {\r\n        switch (sort) {\r\n            case 'price-asc':\r\n                query = query.order('price', { ascending: true });\r\n                break;\r\n            case 'price-desc':\r\n                query = query.order('price', { ascending: false });\r\n                break;\r\n            case 'newest':\r\n                query = query.order('created_at', { ascending: false });\r\n                break;\r\n            default:\r\n                // Default to id\r\n                query = query.order('id', { ascending: true });\r\n        }\r\n    } else {\r\n        // Default sort\r\n        query = query.order('id', { ascending: true });\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error(`Error fetching products for category ${slug}:`, error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\n// Fetch products by Special Category Name\r\nexport async function getProductsBySpecialCategory(specialCategoryName: string, sort?: string): Promise<Product[]> {\r\n    const { data: specialCat } = await supabase.from('special_categories').select('id').eq('name', specialCategoryName).single();\r\n    if (!specialCat) return [];\r\n\r\n    let query = supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name, slug),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false)\r\n        .eq('special_category_id', specialCat.id);\r\n\r\n    // Reuse sort logic\r\n    if (sort) {\r\n        switch (sort) {\r\n            case 'price-asc': query = query.order('price', { ascending: true }); break;\r\n            case 'price-desc': query = query.order('price', { ascending: false }); break;\r\n            case 'newest': query = query.order('created_at', { ascending: false }); break;\r\n            default: query = query.order('id', { ascending: true });\r\n        }\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error(`Error fetching products for offer ${specialCategoryName}:`, error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function getFeaturedProducts(): Promise<Product[]> {\r\n    // Just return some products for now\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false)\r\n        .limit(8);\r\n\r\n    if (error) {\r\n        console.error('Error fetching featured products:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function getBestSellingProducts(limit: number = 8): Promise<Product[]> {\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false)\r\n        .order('sold_count', { ascending: false })\r\n        .limit(limit);\r\n\r\n    if (error) {\r\n        console.error('Error fetching best selling products:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function getRelatedProducts(productId: string | number, limit: number = 4): Promise<Product[]> {\r\n    // 1. Get current product's category to find related items\r\n    const { data: currentProduct, error: fetchError } = await supabase\r\n        .from('products')\r\n        .select('category_id, subcategory_id')\r\n        .eq('id', productId)\r\n        .single();\r\n\r\n    if (fetchError || !currentProduct) {\r\n        return [];\r\n    }\r\n\r\n    // 2. Fetch products in same category, preferably same subcategory\r\n    let query = supabase\r\n        .from('products')\r\n        .select(`\r\n            *,\r\n            categories (name),\r\n            special_categories (name)\r\n        `)\r\n        .eq('is_deleted', false)\r\n        .eq('category_id', currentProduct.category_id)\r\n        .neq('id', productId) // Exclude self\r\n        .limit(limit);\r\n\r\n    // Optional: Sort by sold_count or random? keeping it simple for now (default ID sort or random?)\r\n    // To make it slightly dynamic/interesting, maybe sort by random if possible? \r\n    // Supabase random sort is tricky. Let's just sort by sold_count desc to show best related items.\r\n    query = query.order('sold_count', { ascending: false });\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching related products:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapProduct);\r\n}\r\n\r\nexport async function createProduct(product: Partial<Product> & { specialCategoryId?: number; merchantId?: string; shopName?: string }) {\r\n    // 1. Get Category ID\r\n    const { data: category } = await supabase\r\n        .from('categories')\r\n        .select('id')\r\n        .eq('name', product.category)\r\n        .single();\r\n\r\n    if (!category) throw new Error(`Category ${product.category} not found`);\r\n\r\n    // 2. Get Subcategory ID (if applicable)\r\n    let subcategoryId = null;\r\n    if (product.subcategory) {\r\n        const { data: sub } = await supabase\r\n            .from('subcategories')\r\n            .select('id')\r\n            .eq('name', product.subcategory)\r\n            .eq('category_id', category.id)\r\n            .single();\r\n        if (sub) subcategoryId = sub.id;\r\n    }\r\n\r\n    // 3. Prepare Data\r\n    // Use provided ID or generate\r\n    const newId = product.id || Math.floor(Math.random() * 90000000) + 10000000;\r\n\r\n    const productData: any = {\r\n        id: newId,\r\n        name: product.name,\r\n        price: product.price,\r\n        original_price: product.originalPrice,\r\n        discount_percent: product.discountPercent || 0,\r\n        description: product.description,\r\n        category_id: category.id,\r\n        subcategory_id: subcategoryId,\r\n        quantity_label: product.quantity,\r\n        stock_quantity: product.stockQuantity,\r\n        images: product.images || [], // Use images array\r\n        colors: product.colors,\r\n        sizes: product.sizes,\r\n        special_category_id: product.specialCategoryId,\r\n        merchant_id: product.merchantId,\r\n        shop_name: product.shopName,\r\n        is_approved: product.merchantId ? false : true, // SuperAdmin (no merchantId passed by default?) -> true, Merchant -> false\r\n\r\n        // SEO Fields\r\n        meta_title: product.metaTitle,\r\n        meta_description: product.metaDescription,\r\n        canonical_url: product.canonicalUrl,\r\n        keywords: product.keywords,\r\n        no_index: product.noIndex,\r\n        og_image: product.ogImage\r\n    };\r\n\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .insert(productData)\r\n        .select()\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error creating product:', error);\r\n        throw error;\r\n    }\r\n    return mapProduct(data);\r\n}\r\n\r\nexport async function updateProduct(id: number, product: Partial<Product> & { specialCategoryId?: number; merchantId?: string; shopName?: string; isApproved?: boolean }) {\r\n    // 1. Resolve Category/Subcategory IDs if names generated\r\n    let categoryId = undefined;\r\n    if (product.category) {\r\n        const { data: cat } = await supabase.from('categories').select('id').eq('name', product.category).single();\r\n        if (cat) categoryId = cat.id;\r\n    }\r\n\r\n    let subcategoryId = undefined;\r\n    if (product.subcategory && categoryId) {\r\n        const { data: sub } = await supabase.from('subcategories').select('id').eq('name', product.subcategory).eq('category_id', categoryId).single();\r\n        if (sub) subcategoryId = sub.id;\r\n    }\r\n\r\n    // 2. Prepare Payload\r\n    const updates: any = {};\r\n    if (product.name) updates.name = product.name;\r\n    if (product.price !== undefined) updates.price = product.price;\r\n    if (product.originalPrice !== undefined) updates.original_price = product.originalPrice;\r\n    if (product.discountPercent !== undefined) updates.discount_percent = product.discountPercent;\r\n    if (product.description) updates.description = product.description;\r\n\r\n    // Category updates\r\n    if (categoryId) updates.category_id = categoryId;\r\n    if (subcategoryId !== undefined) updates.subcategory_id = subcategoryId;\r\n\r\n    if (product.quantity) updates.quantity_label = product.quantity;\r\n    if (product.stockQuantity !== undefined) updates.stock_quantity = product.stockQuantity;\r\n    if (product.images) updates.images = product.images;\r\n    if (product.colors) updates.colors = product.colors;\r\n    if (product.sizes) updates.sizes = product.sizes;\r\n    if (product.specialCategoryId !== undefined) updates.special_category_id = product.specialCategoryId;\r\n\r\n    // SEO updates\r\n    if (product.metaTitle !== undefined) updates.meta_title = product.metaTitle;\r\n    if (product.metaDescription !== undefined) updates.meta_description = product.metaDescription;\r\n    if (product.canonicalUrl !== undefined) updates.canonical_url = product.canonicalUrl;\r\n    if (product.keywords !== undefined) updates.keywords = product.keywords;\r\n    if (product.noIndex !== undefined) updates.no_index = product.noIndex;\r\n    if (product.ogImage !== undefined) updates.og_image = product.ogImage;\r\n\r\n    // Merchant fields\r\n    if (product.merchantId !== undefined) updates.merchant_id = product.merchantId;\r\n    if (product.shopName !== undefined) updates.shop_name = product.shopName;\r\n    if (product.isApproved !== undefined) updates.is_approved = product.isApproved;\r\n\r\n    const { data: updatedData, error } = await supabase\r\n        .from('products')\r\n        .update(updates)\r\n        .eq('id', id)\r\n        .select()\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error updating product:', error);\r\n        throw error;\r\n    }\r\n    return mapProduct(updatedData);\r\n}\r\n\r\n// Soft Delete Product\r\nexport async function deleteProduct(id: number | string) {\r\n    const { error } = await supabase\r\n        .from('products')\r\n        .update({\r\n            is_deleted: true,\r\n            deleted_at: new Date()\r\n        })\r\n        .eq('id', id);\r\n\r\n    if (error) {\r\n        console.error('Error deleting product:', error);\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport async function createOrder(\r\n    userId: string,\r\n    totalAmount: number,\r\n    items: any[],\r\n    shippingDetails: {\r\n        name: string;\r\n        phone: string;\r\n        address: string;\r\n    },\r\n    paymentMethod: string = 'cod'\r\n) {\r\n    // 1. Create Order\r\n    const { data: order, error: orderError } = await supabase\r\n        .from('orders')\r\n        .insert({\r\n            user_id: userId,\r\n            total_amount: totalAmount,\r\n            status: 'pending',\r\n            shipping_name: shippingDetails.name,\r\n            shipping_phone: shippingDetails.phone,\r\n            shipping_address: shippingDetails.address,\r\n\r\n            payment_method: paymentMethod,\r\n            payment_status: 'pending'\r\n        })\r\n        .select()\r\n        .single();\r\n\r\n    if (orderError) throw orderError;\r\n\r\n    // 2. Create Order Items\r\n    const orderItems = items.map(item => ({\r\n        order_id: order.id,\r\n        product_id: item.id,\r\n        name: item.name,\r\n        price: item.price,\r\n        quantity: item.quantity,\r\n        image: item.images && item.images.length > 0 ? item.images[0] : (item.image || ''),\r\n        category: item.category,\r\n        size: item.size,\r\n        color: item.color\r\n    }));\r\n\r\n    const { error: itemsError } = await supabase\r\n        .from('order_items')\r\n        .insert(orderItems);\r\n\r\n    if (itemsError) throw itemsError;\r\n\r\n    // 3. Clear Cart (Backend side)\r\n    const { data: cart } = await supabase.from('carts').select('id').eq('user_id', userId).single();\r\n    if (cart) {\r\n        await supabase.from('cart_items').delete().eq('cart_id', cart.id);\r\n    }\r\n\r\n    // 4. Update Stock Logic\r\n    try {\r\n        for (const item of items) {\r\n            // Fetch latest stock to ensure accuracy\r\n            const { data: product, error: fetchError } = await supabase\r\n                .from('products')\r\n                .select('stock_quantity')\r\n                .eq('id', item.id)\r\n                .single();\r\n\r\n            if (product && !fetchError) {\r\n                const newStock = Math.max(0, product.stock_quantity - item.quantity);\r\n                await supabase\r\n                    .from('products')\r\n                    .update({ stock_quantity: newStock })\r\n                    .eq('id', item.id);\r\n            }\r\n        }\r\n    } catch (error) {\r\n        console.error('Error updating stock:', error);\r\n        // We don't throw here to avoid failing the order if stock update fails,\r\n        // but in a production app you might want to handle this differently.\r\n    }\r\n\r\n    return order;\r\n}\r\n\r\nexport async function getOrder(id: string) {\r\n    const { data: order, error } = await supabase\r\n        .from('orders')\r\n        .select(`\r\n            *,\r\n            items:order_items(\r\n                *,\r\n                products (images)\r\n            )\r\n        `)\r\n        .eq('id', id)\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error fetching order:', error);\r\n        return null;\r\n    }\r\n\r\n    // Fetch profile for dynamic customer info\r\n    const { data: profile } = await supabase\r\n        .from('profiles')\r\n        .select('full_name, phone, avatar_url')\r\n        .eq('id', order.user_id)\r\n        .single();\r\n\r\n    const customerName = profile?.full_name || order.shipping_name || 'Guest';\r\n    const customerPhone = profile?.phone || order.shipping_phone || '';\r\n\r\n    return {\r\n        ...order,\r\n        customer: {\r\n            name: customerName,\r\n            phone: customerPhone,\r\n            avatar: profile?.avatar_url,\r\n            id: order.user_id\r\n        }\r\n    };\r\n}\r\n\r\nexport async function getUserOrders(userId: string) {\r\n    const { data, error } = await supabase\r\n        .from('orders')\r\n        .select(`\r\n            *,\r\n            order_items (id)\r\n        `)\r\n        .eq('user_id', userId)\r\n        .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n        console.error('Error fetching user orders:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(order => ({\r\n        ...order,\r\n        item_count: order.order_items.length\r\n    }));\r\n}\r\n\r\nexport async function getAllOrders(searchQuery?: string) {\r\n    let query = supabase\r\n        .from('orders')\r\n        .select(`\r\n            *,\r\n            order_items (id, name, quantity, size, color)\r\n        `)\r\n        .order('created_at', { ascending: false });\r\n\r\n    if (searchQuery) {\r\n        query = query.or(`id.ilike.%${searchQuery}%,shipping_name.ilike.%${searchQuery}%`);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching all orders:', error);\r\n        return [];\r\n    }\r\n\r\n    // Fetch profiles for these users to show dynamic names\r\n    const userIds = Array.from(new Set((data || []).map(o => o.user_id)));\r\n    const { data: profiles } = await supabase\r\n        .from('profiles')\r\n        .select('id, full_name, phone, avatar_url')\r\n        .in('id', userIds);\r\n\r\n    return (data || []).map(order => {\r\n        const profile = profiles?.find(p => p.id === order.user_id);\r\n        const customerName = profile?.full_name || order.shipping_name || 'Guest';\r\n        const customerPhone = profile?.phone || order.shipping_phone || '';\r\n\r\n        return {\r\n            ...order,\r\n            item_count: order.order_items ? order.order_items.length : 0,\r\n            items_summary: order.order_items ? order.order_items.map((i: any) => `${i.quantity}x ${i.name}`).join(', ') : '',\r\n            customer: {\r\n                name: customerName,\r\n                phone: customerPhone,\r\n                avatar: profile?.avatar_url,\r\n                id: order.user_id\r\n            }\r\n        };\r\n    });\r\n}\r\n\r\nexport async function getLowStockProducts() {\r\n    const { data, error } = await supabase\r\n        .from('products')\r\n        .select(`\r\n            id, name, stock_quantity, price, images,\r\n            categories (name)\r\n        `)\r\n        .lt('stock_quantity', 10);\r\n\r\n    if (error) {\r\n        console.error('Error fetching low stock products:', error);\r\n        return [];\r\n    }\r\n    // Map to consistently use 'image' if needed\r\n    return data.map((p: any) => ({\r\n        ...p,\r\n        image: p.images && p.images.length > 0 ? p.images[0] : '',\r\n        category: p.categories?.name || (Array.isArray(p.categories) ? p.categories[0]?.name : 'Unknown')\r\n    }));\r\n}\r\n\r\nexport async function updateOrderStatus(id: string, status: string) {\r\n    const { error } = await supabase\r\n        .from('orders')\r\n        .update({ status })\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\n// Address Management\r\n\r\nexport interface Address {\r\n    id: string;\r\n    label: string;\r\n    fullName: string;\r\n    phone: string;\r\n    street: string;\r\n    city: string;\r\n    state: string;\r\n    postalCode: string;\r\n    country: string;\r\n    isDefault: boolean;\r\n}\r\n\r\nfunction mapAddress(row: any): Address {\r\n    return {\r\n        id: row.id,\r\n        label: row.label,\r\n        fullName: row.full_name,\r\n        phone: row.phone,\r\n        street: row.street,\r\n        city: row.city,\r\n        state: row.state,\r\n        postalCode: row.postal_code,\r\n        country: row.country,\r\n        isDefault: row.is_default\r\n    };\r\n}\r\n\r\nexport async function getUserAddresses(userId: string): Promise<Address[]> {\r\n    const { data, error } = await supabase\r\n        .from('addresses')\r\n        .select('*')\r\n        .eq('user_id', userId)\r\n        .order('is_default', { ascending: false }) // Default first\r\n        .order('created_at', { ascending: false });\r\n\r\n    if (error) {\r\n        console.error('Error fetching addresses:', error);\r\n        return [];\r\n    }\r\n\r\n    return data.map(mapAddress);\r\n}\r\n\r\nexport async function saveAddress(userId: string, address: Partial<Address>) {\r\n    // If editing, address should have ID\r\n    if (address.id) {\r\n        const { error } = await supabase\r\n            .from('addresses')\r\n            .update({\r\n                label: address.label,\r\n                full_name: address.fullName,\r\n                phone: address.phone,\r\n                street: address.street,\r\n                city: address.city,\r\n                state: address.state,\r\n                postal_code: address.postalCode,\r\n                country: address.country,\r\n                is_default: address.isDefault\r\n            })\r\n            .eq('id', address.id)\r\n            .eq('user_id', userId); // Security check\r\n\r\n        if (error) throw error;\r\n    } else {\r\n        // Creating new\r\n        const { error } = await supabase\r\n            .from('addresses')\r\n            .insert({\r\n                user_id: userId,\r\n                label: address.label,\r\n                full_name: address.fullName,\r\n                phone: address.phone,\r\n                street: address.street,\r\n                city: address.city,\r\n                state: address.state,\r\n                postal_code: address.postalCode,\r\n                country: address.country,\r\n                is_default: address.isDefault\r\n            });\r\n\r\n        if (error) throw error;\r\n    }\r\n}\r\n\r\n// Review Eligibility\r\nexport async function checkReviewEligibility(userId: string, productId: string | number): Promise<boolean> {\r\n    // 1. Check if user ordered the product and it's delivered\r\n    const { data: eligibleOrders, error } = await supabase\r\n        .from('orders')\r\n        .select(`\r\n            id,\r\n            status,\r\n            order_items!inner(product_id)\r\n        `)\r\n        .eq('user_id', userId)\r\n        .eq('status', 'delivered')\r\n        .eq('order_items.product_id', productId)\r\n        .limit(1);\r\n\r\n    if (error) {\r\n        console.error('Error checking eligibility:', error);\r\n        return false;\r\n    }\r\n\r\n    // 2. Check if user ALREADY reviewed it\r\n    const { data: existingReview, error: reviewError } = await supabase\r\n        .from('reviews')\r\n        .select('id')\r\n        .eq('user_id', userId)\r\n        .eq('product_id', productId)\r\n        .maybeSingle();\r\n\r\n    if (reviewError) {\r\n        console.error('Error checking existing reviews:', reviewError);\r\n    }\r\n\r\n    const hasPurchased = eligibleOrders && eligibleOrders.length > 0;\r\n    const hasReviewed = !!existingReview;\r\n\r\n    return hasPurchased && !hasReviewed;\r\n}\r\n\r\nexport async function deleteAddress(id: string) {\r\n    const { error } = await supabase\r\n        .from('addresses')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function setDefaultAddress(userId: string, id: string) {\r\n    // We can rely on the DB trigger to unset others\r\n    const { error } = await supabase\r\n        .from('addresses')\r\n        .update({ is_default: true })\r\n        .eq('id', id)\r\n        .eq('user_id', userId);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\n\r\nexport async function getHeroSettings() {\r\n    const { data, error } = await supabase\r\n        .from('hero_settings')\r\n        .select('*')\r\n        .single();\r\n\r\n    if (error) {\r\n        console.error('Error fetching hero settings:', error);\r\n        // Fallback default\r\n        return {\r\n            title: 'Quality Food For Your Healthy Life',\r\n            subtitle: 'New Season Freshness',\r\n            description: 'Get up to 50% OFF on your first order. Fresh produce delivered from farm to your doorstep.',\r\n            image_url: 'https://lh3.googleusercontent.com/aida-public/AB6AXuBX7x1HBOqMMI518qHW17jKGkryeaKonnXGEbdkBR4GvbEVZENLzYW_8cEKLeU3nLCoxfDxvRuzBWc2UMxkRlp8Qix2LgxHKpsToQHO10vMCHMKjOmg6ucwmqOZ7GIMiSBIxBw0qaqFeK63SiQ5EQ4C-LMvZy28P7MaNy4uzcV2DaK1H5zIykFWkZMYBE6Xh8ac9E1nba7cTZ14OBTrDW-wpN-j8lDq-VbvUaLl6OtViD2uWDMpEBWT1yXDZluirbsS6BEgrgXwzyI',\r\n            button_text: 'Shop Now',\r\n            button_link: '/shop'\r\n        };\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function updateHeroSettings(settings: any) {\r\n    const { error } = await supabase\r\n        .from('hero_settings')\r\n        .update(settings)\r\n        .eq('id', 1);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\n// -- Notices --\r\nexport interface Notice {\r\n    id: number;\r\n    text: string;\r\n    active: boolean;\r\n}\r\n\r\nexport async function getNotices(onlyActive = true): Promise<Notice[]> {\r\n    let query = supabase.from('notices').select('*').order('created_at', { ascending: false });\r\n\r\n    if (onlyActive) {\r\n        query = query.eq('active', true);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching notices:', error);\r\n        return [];\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function createNotice(text: string) {\r\n    const { error } = await supabase.from('notices').insert({ text });\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function updateNotice(id: number, updates: Partial<Notice>) {\r\n    const { error } = await supabase.from('notices').update(updates).eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function deleteNotice(id: number) {\r\n    const { error } = await supabase.from('notices').delete().eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\n// -- Ad Scroller --\r\nexport interface AdScroll {\r\n    id: number;\r\n    image_url: string;\r\n    active: boolean;\r\n}\r\n\r\nexport async function getAds(onlyActive = true): Promise<AdScroll[]> {\r\n    let query = supabase.from('ad_scrolls').select('*').order('created_at', { ascending: false });\r\n\r\n    if (onlyActive) {\r\n        query = query.eq('active', true);\r\n    }\r\n\r\n    const { data, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('Error fetching ads:', error);\r\n        return [];\r\n    }\r\n    return data;\r\n}\r\n\r\nexport async function createAd(imageUrl: string) {\r\n    const { error } = await supabase.from('ad_scrolls').insert({ image_url: imageUrl });\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function updateAd(id: number, updates: Partial<AdScroll>) {\r\n    const { error } = await supabase.from('ad_scrolls').update(updates).eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function deleteAd(id: number) {\r\n    const { error } = await supabase.from('ad_scrolls').delete().eq('id', id);\r\n    if (error) throw error;\r\n}\r\n\r\n// -- Storage --\r\nexport async function uploadHeroImage(file: File): Promise<string> {\r\n    const fileName = `${Date.now()}-${file.name}`;\r\n    const { data, error } = await supabase.storage\r\n        .from('hero-images')\r\n        .upload(fileName, file, {\r\n            cacheControl: '3600',\r\n            upsert: false\r\n        });\r\n\r\n    if (error) throw error;\r\n\r\n    // Get public URL\r\n    const { data: { publicUrl } } = supabase.storage\r\n        .from('hero-images')\r\n        .getPublicUrl(fileName);\r\n\r\n    return publicUrl;\r\n}\r\n\r\nexport async function uploadAdImage(file: File): Promise<string> {\r\n    const fileName = `${Date.now()}-${file.name}`;\r\n    const { data, error } = await supabase.storage\r\n        .from('ad-images')\r\n        .upload(fileName, file, {\r\n            cacheControl: '3600',\r\n            upsert: false\r\n        });\r\n\r\n    if (error) throw error;\r\n\r\n    // Get public URL\r\n    const { data: { publicUrl } } = supabase.storage\r\n        .from('ad-images')\r\n        .getPublicUrl(fileName);\r\n\r\n    return publicUrl;\r\n}\r\n\r\nexport async function uploadCategoryImage(file: File, categorySlug: string, type: 'icon' | 'banner'): Promise<string> {\r\n    const fileExt = file.name.split('.').pop();\r\n    const fileName = `${categorySlug}/${type}.${fileExt}`;\r\n\r\n    const { data, error } = await supabase.storage\r\n        .from('category-images')\r\n        .upload(fileName, file, {\r\n            cacheControl: '3600',\r\n            upsert: true\r\n        });\r\n\r\n    if (error) throw error;\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n        .from('category-images')\r\n        .getPublicUrl(fileName);\r\n\r\n    return `${publicUrl}?t=${Date.now()}`;\r\n}\r\n\r\nexport async function uploadSpecialOfferImage(file: File, name: string): Promise<string> {\r\n    const fileExt = file.name.split('.').pop();\r\n    const sanitizedName = name.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');\r\n    const fileName = `${sanitizedName}/${Date.now()}.${fileExt}`;\r\n\r\n    const { data, error } = await supabase.storage\r\n        .from('special-offer-images')\r\n        .upload(fileName, file, {\r\n            cacheControl: '3600',\r\n            upsert: false // Don't overwrite, unique filename\r\n        });\r\n\r\n    if (error) throw error;\r\n\r\n    const { data: { publicUrl } } = supabase.storage\r\n        .from('special-offer-images')\r\n        .getPublicUrl(fileName);\r\n\r\n    return publicUrl;\r\n}\r\n\r\nexport async function updateSpecialCategory(id: number, name: string, description?: string, imageUrl?: string) {\r\n    const { error } = await supabase.from('special_categories').update({\r\n        name,\r\n        description,\r\n        image_url: imageUrl\r\n    }).eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\n// Admin Reviews Management\r\n// Admin Reviews Management\r\nexport async function getAdminReviews(filters?: { rating?: number | 'all', visibility?: 'all' | 'visible' | 'hidden' }) {\r\n    let query = supabase\r\n        .from('reviews')\r\n        .select('*')\r\n        .order('created_at', { ascending: false });\r\n\r\n    // Apply filters\r\n    if (filters?.rating && filters.rating !== 'all') {\r\n        query = query.eq('rating', filters.rating);\r\n    }\r\n\r\n    if (filters?.visibility) {\r\n        if (filters.visibility === 'visible') {\r\n            query = query.eq('is_hidden', false);\r\n        } else if (filters.visibility === 'hidden') {\r\n            query = query.eq('is_hidden', true);\r\n        }\r\n    }\r\n\r\n    const { data: reviews, error } = await query;\r\n\r\n    if (error) {\r\n        console.error('CRITICAL: Error fetching admin reviews:', JSON.stringify(error, null, 2));\r\n        throw error;\r\n    }\r\n\r\n    if (!reviews || reviews.length === 0) {\r\n        console.warn('CRITICAL: Admin reviews fetch returned empty array.');\r\n        return [];\r\n    }\r\n\r\n    // Manually fetch related data (Safer than joins if relationships are missing)\r\n    const validReviews = reviews;\r\n\r\n    // Fetch Users\r\n    const userIds = [...new Set(validReviews.map((r: any) => r.user_id).filter(Boolean))];\r\n    let usersMap: Record<string, any> = {};\r\n    if (userIds.length > 0) {\r\n        const { data: users } = await supabase.from('User').select('id, name, image').in('id', userIds);\r\n        if (users) {\r\n            users.forEach((u: any) => usersMap[u.id] = u);\r\n        }\r\n    }\r\n\r\n    // Fetch Products\r\n    const productIds = [...new Set(validReviews.map((r: any) => r.product_id).filter(Boolean))];\r\n    let productsMap: Record<string, any> = {};\r\n    if (productIds.length > 0) {\r\n        const { data: products } = await supabase.from('products').select('id, name, images').in('id', productIds);\r\n        if (products) {\r\n            products.forEach((p: any) => productsMap[p.id] = p);\r\n        }\r\n    }\r\n\r\n    // Map data\r\n    return validReviews.map((r: any) => ({\r\n        ...r,\r\n        User: usersMap[r.user_id] || { name: 'Unknown', image: null },\r\n        products: {\r\n            name: productsMap[r.product_id]?.name || 'Unknown Product',\r\n            image_url: productsMap[r.product_id]?.images?.[0] || null\r\n        }\r\n    }));\r\n}\r\n\r\nexport async function toggleReviewVisibility(id: number | string, isHidden: boolean) {\r\n    const { error } = await supabase\r\n        .from('reviews')\r\n        .update({ is_hidden: isHidden })\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\nexport async function deleteReview(id: number | string) {\r\n    const { error } = await supabase\r\n        .from('reviews')\r\n        .delete()\r\n        .eq('id', id);\r\n\r\n    if (error) throw error;\r\n}\r\n\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\data.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\format.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabase.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabaseAdmin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabaseClient.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabaseService.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabase\\admin.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabase\\client.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabase\\middleware.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CookieOptions' is defined but never used.","line":1,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":1,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CookieOptions"},"fix":{"range":[27,47],"text":""},"desc":"Remove unused variable \"CookieOptions\"."}]},{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'options' is defined but never used.","line":23,"column":58,"nodeType":"Identifier","messageId":"unusedVar","endLine":23,"endColumn":65}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":2,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { NextResponse, type NextRequest } from 'next/server'\r\n\r\nexport async function updateSession(request: NextRequest) {\r\n    let response = NextResponse.next({\r\n        request: {\r\n            headers: request.headers,\r\n        },\r\n    })\r\n\r\n    const supabase = createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookieOptions: {\r\n                name: 'admin-auth-token',\r\n            },\r\n            cookies: {\r\n                getAll() {\r\n                    return request.cookies.getAll()\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    cookiesToSet.forEach(({ name, value, options }) => request.cookies.set(name, value))\r\n                    response = NextResponse.next({\r\n                        request,\r\n                    })\r\n                    cookiesToSet.forEach(({ name, value, options }) =>\r\n                        response.cookies.set(name, value, options)\r\n                    )\r\n                },\r\n            },\r\n        }\r\n    )\r\n\r\n    // Refresh session if expired\r\n    const { data: { user } } = await supabase.auth.getUser()\r\n\r\n    // Protected routes check\r\n    const isAdminRoute = request.nextUrl.pathname.startsWith('/admin')\r\n    const isPublicAdminRoute = request.nextUrl.pathname === '/admin/login' ||\r\n        request.nextUrl.pathname === '/admin/register'\r\n\r\n    if (isAdminRoute && !isPublicAdminRoute && !user) {\r\n        return NextResponse.redirect(new URL('/admin/login', request.url))\r\n    }\r\n\r\n    if (isPublicAdminRoute && user) {\r\n        return NextResponse.redirect(new URL('/admin', request.url))\r\n    }\r\n\r\n    return response\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\lib\\supabase\\server.ts","messages":[{"ruleId":"@typescript-eslint/no-unused-vars","severity":1,"message":"'CookieOptions' is defined but never used.","line":2,"column":35,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":48,"suggestions":[{"messageId":"removeUnusedVar","data":{"varName":"CookieOptions"},"fix":{"range":[29,49],"text":""},"desc":"Remove unused variable \"CookieOptions\"."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"\r\nimport { createServerClient, type CookieOptions } from '@supabase/ssr'\r\nimport { cookies } from 'next/headers'\r\n\r\nexport async function createClient() {\r\n    const cookieStore = await cookies()\r\n\r\n    return createServerClient(\r\n        process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n        process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\r\n        {\r\n            cookieOptions: {\r\n                name: 'admin-auth-token',\r\n            },\r\n            cookies: {\r\n                getAll() {\r\n                    return cookieStore.getAll()\r\n                },\r\n                setAll(cookiesToSet) {\r\n                    try {\r\n                        cookiesToSet.forEach(({ name, value, options }) =>\r\n                            cookieStore.set(name, value, options)\r\n                        )\r\n                    } catch {\r\n                        // The `setAll` method was called from a Server Component.\r\n                        // This can be ignored if you have middleware refreshing\r\n                        // user sessions.\r\n                    }\r\n                },\r\n            },\r\n        }\r\n    )\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\middleware.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\next.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\postcss.config.mjs","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\schemas\\index.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\tailwind.config.ts","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\test-supabase.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"F:\\Ecommerce\\Flutter-ecommerce-app-with-getx-master\\grocery\\apps\\admin\\test_query.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
